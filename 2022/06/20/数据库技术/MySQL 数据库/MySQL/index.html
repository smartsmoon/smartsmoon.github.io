<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>MySQL 底层初探 | 月の子豚小屋</title><meta name="keywords" content="MySQL"><meta name="author" content="moon"><meta name="copyright" content="moon"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="初识 MySQLMySQL 是一个数据库管理系统 ( DataBase Management System ) ，DB才是数据库。  数据库管理软件：科学组织和存储数据 , 高效地获取和维护数据。  MySQL 数据库：数据存储。（关系型数据库），免费开源。 [问题]  变种 MySQL 有哪些呢？ ​	1）Drizzle：真正的 Mysql 分支出来的，但是和 MySQL 高度不兼容，充分解决数">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL 底层初探">
<meta property="og:url" content="http://localhost:4000/2022/06/20/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8A%80%E6%9C%AF/MySQL%20%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/index.html">
<meta property="og:site_name" content="月の子豚小屋">
<meta property="og:description" content="初识 MySQLMySQL 是一个数据库管理系统 ( DataBase Management System ) ，DB才是数据库。  数据库管理软件：科学组织和存储数据 , 高效地获取和维护数据。  MySQL 数据库：数据存储。（关系型数据库），免费开源。 [问题]  变种 MySQL 有哪些呢？ ​	1）Drizzle：真正的 Mysql 分支出来的，但是和 MySQL 高度不兼容，充分解决数">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://w.wallhaven.cc/full/k7/wallhaven-k7m65d.png">
<meta property="article:published_time" content="2022-06-19T16:00:00.000Z">
<meta property="article:modified_time" content="2022-10-17T14:04:50.933Z">
<meta property="article:author" content="moon">
<meta property="article:tag" content="数据库">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://w.wallhaven.cc/full/k7/wallhaven-k7m65d.png"><link rel="shortcut icon" href="https://w.wallhaven.cc/full/8o/wallhaven-8o2v82.jpg"><link rel="canonical" href="http://localhost:4000/2022/06/20/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8A%80%E6%9C%AF/MySQL%20%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"top-right"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL 底层初探',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-10-17 22:04:50'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://pic1.imgdb.cn/item/6337ca6e16f2c2beb17d8731.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">36</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">16</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://w.wallhaven.cc/full/k7/wallhaven-k7m65d.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">月の子豚小屋</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MySQL 底层初探</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-06-19T16:00:00.000Z" title="发表于 2022-06-20 00:00:00">2022-06-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-10-17T14:04:50.933Z" title="更新于 2022-10-17 22:04:50">2022-10-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8A%80%E6%9C%AF/">数据库技术</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8A%80%E6%9C%AF/MySQL-%E6%95%B0%E6%8D%AE%E5%BA%93/">MySQL 数据库</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">19.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>68分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MySQL 底层初探"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="初识-MySQL"><a href="#初识-MySQL" class="headerlink" title="初识 MySQL"></a>初识 MySQL</h1><p>MySQL 是一个数据库管理系统 ( <code>D</code>ata<code>B</code>ase <code>M</code>anagement <code>S</code>ystem ) ，DB才是数据库。</p>
<blockquote>
<p>数据库管理软件：科学组织和存储数据 , 高效地获取和维护数据。</p>
</blockquote>
<p><code>MySQL 数据库</code>：数据存储。（关系型数据库），免费开源。</p>
<p><code>[问题]</code>  变种 MySQL 有哪些呢？</p>
<p>​	1）Drizzle：真正的 Mysql 分支出来的，但是和 MySQL 高度不兼容，充分解决数据库的可用性问题。</p>
<p>​	2）MariaDB：MySQL 创始人创建，MySQL 现有功能基础上的加强版。</p>
<p>​	3）Percona Server：《高性能MySQL》作者创建，和 MySQL 兼容，为性能改进版本，MySQL 的尝鲜版。</p>
<p>​	4）Postgre SQL（PG）：MySQL 的替换产品，稳定性极强，高并发场景下性能指标非常良好，数据类型丰富，但约束比较多，学术化强。</p>
<p>​	5）SQLite：世界上部署最广泛的数据库。</p>
<p><code>[MySQL 的体系架构]</code> 上层连接池，底层文件系统。</p>
<p><img src="https://pic1.imgdb.cn/item/633e76ba16f2c2beb193df24.png" alt="MySQL 体系结构"></p>
<p>​	1）连接池 Connection Pool：提供各种方式的连接池。</p>
<p>​	2）管理工具和服务 Services &amp; Utilies：启动、集群、复制、恢复功能的实现方案等等。</p>
<p>​	3）SQL 接口 SQL interface：负责对外沟通，接收 SQL 命令。</p>
<p>​	4）解析器 Parser ：词法语法解析，分解语句，判断正确性。</p>
<p>​	5）优化器 Optiimizer：分析和优化、改写 SQL 命令。</p>
<p>​	6）缓存器 Caches：5.7 版本之前还有数据库内部缓存，包括结果缓存、表缓存、key 缓存等。（缓存找不到才往下找）</p>
<p>​	7）插件式引擎 Pluggable Storage Engines：引擎丰富多彩，支持自由选择。</p>
<p>​	8）文件与日志系统 File System &amp; Logs：最终存储 和 日志的文件。</p>
<p><code>[分析]</code>  描述 MySQL 的逻辑架构。（BIO 通信模型）</p>
<p>​	1）连接层：建立连接，进行鉴权，身份验证。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查询最大连接数,一般会往小改，根据并发原理，一般是 CPU 核数的两倍</span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%max_connections%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>​	2）Server 层：SQL 解析优化处理，如果开启缓存则还需要查询缓存（MySQL 8 已经抛弃：弊大于利）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查询缓存机制是否开启（MySQL 缓存是多线程安全的：也就意味会加锁）</span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%query_cache_type%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>​	3）存储引擎层：提供了很多存储引擎接口，支持切换。（存储引擎内部有缓存）</p>
<p>​		<code>InnoDB</code>：适合短事务。（目前使用）</p>
<p>​		<code>MyISAM</code>：不需要支持事务，数据可能错乱。（5.1 版本之前默认）</p>
<p>​		其他的还有：Blackhole（复制思想良好）、CSV、Ferderated、NDB集群引擎、TokuDB 存储引擎（使用分型树优化写操作）、Infobridge（列存储）等。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 查询 MySQL 支持的存储引擎</span><br><span class="line"><span class="keyword">show</span> engines</span><br><span class="line"># 查询默认存储引擎</span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%storage_engine%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>​	存储引擎针对表，不同的表可以混用多个存储引擎，但是不推荐混用，可能无法优化。</p>
<p><code>[面试题]</code>  MyISAM 和 InnoDB 存储引擎比较：主要区别在于事务和行表锁两方面。</p>
<table>
<thead>
<tr>
<th></th>
<th align="center">MyISAM</th>
<th align="center">InnoDB</th>
</tr>
</thead>
<tbody><tr>
<td>主外键</td>
<td align="center">不支持</td>
<td align="center">支持</td>
</tr>
<tr>
<td>事务</td>
<td align="center"><code> 不支持</code></td>
<td align="center"><code>支持  </code></td>
</tr>
<tr>
<td>行表锁</td>
<td align="center"><code>表锁</code>，操作一条记录也会锁住整个表 ，不适合高并发的操作</td>
<td align="center"><code>行锁</code>，操作时只锁某一行，不对其它行有影响  适合高并发的操作</td>
</tr>
<tr>
<td>缓存</td>
<td align="center">只缓存索引，不缓存真实数据</td>
<td align="center">缓存索引并缓存真实数据，对内存要求较高，内存大小对性能有决定性的影响</td>
</tr>
<tr>
<td>表空间</td>
<td align="center">小</td>
<td align="center">大</td>
</tr>
<tr>
<td>关注点</td>
<td align="center">性能</td>
<td align="center">事务</td>
</tr>
<tr>
<td>默认安装</td>
<td align="center">Y</td>
<td align="center">Y</td>
</tr>
</tbody></table>
<p>​		MySQL 数据以文件方式存放磁盘，包括表文件，数据文件，以及数据库的选项文件，位置位于 <code>Mysql 安装目录 \data\ 下存放数据表</code> ，目录名对应数据库名，该目录下文件名对应数据表 。<code>InnoDB</code> 引擎数据表只有一个 <code>*.frm</code> 文件， 以及上一级目录的 <code>ibdata1</code> 文件。但 MyISAM 引擎数据表对应三个文件<code>*.frm</code> 表示表结构定义文件，<code>*.MYD</code> 表示数据文件(data)，<code>*. MYI</code> 表示索引文件 (index)。</p>
<p>​		MyISAM 适用于节约空间及提高相应速度，<code>InnoDB</code> 适用于安全性 , 事务处理及多用户操作数据表，默认使用 InnoDB 存储引擎。</p>
<blockquote>
<p>数据目录查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%datadir%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>当创建一个数据库时，就会在 datadir 目录下创建一个新文件夹，该文件夹下，<code>frm 文件</code>描述表结构，而表数据放在 InnoDB 独立的表空间（<code>ibd 文件</code>）。</p>
<p>日志文件查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;log_error&#x27;</span>;	# 错误日志文件</span><br><span class="line"># 还有慢查询日志 host_slow.log</span><br><span class="line"># 查询日志 host.log</span><br><span class="line"># 二进制文件 bin.<span class="built_in">log</span>(执行更改的操作)：可用于转存数据到第三方数据库，需要开启</span><br></pre></td></tr></table></figure>
</blockquote>
<p><code>[分析]</code>  MySQL 的系统库（管理维护是 DBA 的操作）。</p>
<p>1）performance_schema：<code>性能监控</code>数据库，将运行时的性能信息通过 performance_schema 存储引擎写到此库。</p>
<p>2）sys：系统库，为 DBA 服务。数据来源于 performance 和 information 库。</p>
<p>3）information_schema：保存 MySQL 的信息（列信息、索引信息等），元数据。</p>
<p>4）mysql：数据库核心，存储 MySQL 的用户账户和权限信息，一些存储过程、事件的定义信息，一些运行过程中产生的日志信息（默认不开启，耗费性能），一些帮助信息以及时区信息等。</p>
<p>5）复制信息表：记录主从复制信息。</p>
<h1 id="数据库事务"><a href="#数据库事务" class="headerlink" title="数据库事务"></a>数据库事务</h1><p>​	数据库事务：数据库管理系统（DBMS）执行过程中的一个逻辑单位（<code>不可再进行分割</code>），由一个有限的数据库操作序列构成（多个DML语句，select 语句不包含事务），<code>要么全部成功，要么全部不成功</code>。（多条 SQL 语句一起执行的场景）</p>
<blockquote>
<p>事务的 ACID 原则（特性）：原子性、一致性、隔离性、持久性。</p>
</blockquote>
<p>1、原子性 (Atomicity)：不可分割，要么都成功，要么都失败。</p>
<p>2、一致性 (Consist)：事务前后的数据完整性要保持一致。</p>
<p>3、隔离性(Isolated)：事物的隔离性是多个用户并发访问数据库时，数据库为每一个用户开启的事务，不能被其他事务的操作数据所干扰，事务之间要相互隔离。</p>
<blockquote>
<p>隔离性不能保证时会导致的一些问题：（可通过串行化执行解决，但性能不好）</p>
<p>1）<code>脏读</code>：指一个事务读取了另外一个事务已经修改但未提交的数据。</p>
<p>2）<code>不可重复读</code>：在一个事务内读取表中的某一行数据，多次读取<code>结果</code>不同。（这个不一定是错误，只是某些场合不对）</p>
<p>3）<code>虚读（幻读）</code>：是指在一个事务内读取到了别的事务插入的数据记录，导致前后读取记录<code>条数</code>不一致。（读取到之前没读取到的新记录）</p>
</blockquote>
<p>4、持久性 (Durable) ：事务一旦提交则不可逆，被持久到数据库中。</p>
<p><code>[问题]</code> 如果说在事务1 过程中，事务2 删掉了原来的数据记录，导致事务1 再一次读取时没有数据，这是属于什么情况？</p>
<p>​		按照 SQL 92 标准，这是属于幻读，但是按照 SQL 本身规定而言属于不可重复读情况。（幻读强调的是记录数变多）</p>
<blockquote>
<p>SQL 92 标准中规定允许牺牲一定的隔离性来换取性能：（MySQL 基本遵循这套标准）</p>
<p>1）未提交读：可能脏读、可能不可重复读、可能幻读。</p>
<p>2）已提交读：可能不可重复读，可能幻读。</p>
<p>3）可重复读：只可能产生幻读。（<code>MySQL 标准在此种情况下基本已经解决了幻读问题 &lt;==== 锁定读 LBCC 也叫当前读</code>） &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; <code>默认的隔离级别</code></p>
<p>4）串行化：都不会产生，但会影响性能。</p>
<p>查询当前隔离级别：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;transaction_isolation&#x27;</span>;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><code>[理论]</code> <code>隐式提交</code>：例如在使用 DDL 语句或者使用 MySQL 系统的数据库时，之前的事务都会被提交（没有写 commit 也会提交）</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用set语句来改变自动提交模式</span></span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>;   <span class="comment">/*关闭*/</span></span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">1</span>;   <span class="comment">/*开启*/</span></span><br><span class="line"></span><br><span class="line"># 注意:</span><br><span class="line"># <span class="number">1.</span>MySQL 中默认是开启事务自动提交！！！</span><br><span class="line"># <span class="number">2.</span>使用事务时应先关闭自动提交！！！</span><br><span class="line"></span><br><span class="line"># 整个流程：</span><br><span class="line"># <span class="number">1</span>、关闭自动提交</span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"># <span class="number">2</span>、开始一个事务,标记事务的起始点，从这个之后的<span class="keyword">sql</span>都在同一个事务内</span><br><span class="line"><span class="keyword">START</span> TRANSACTION  </span><br><span class="line"># <span class="number">3</span>、提交一个事务给数据库：持久化（成功！）</span><br><span class="line"><span class="keyword">COMMIT</span></span><br><span class="line"># <span class="number">3</span>、将事务回滚,数据回到本次事务的初始状态（失败！）</span><br><span class="line"><span class="keyword">ROLLBACK</span></span><br><span class="line"># <span class="number">4</span>、事务结束：还原 MySQL 数据库的自动提交</span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"># 保存点（相当于是存档：可以回滚到具体的保存点位置，避免重复执行） <span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">&gt;</span> 基本不用</span><br><span class="line"><span class="keyword">SAVEPOINT</span> 保存点名称 # 设置一个事务保存点</span><br><span class="line"><span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> <span class="keyword">SAVEPOINT</span> 保存点名称 # 回滚到保存点</span><br><span class="line"><span class="keyword">RELEASE</span> <span class="keyword">SAVEPOINT</span> 保存点名称 # 撤销删除保存点</span><br></pre></td></tr></table></figure>

<p>模拟场景：转账的实现。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># A 在线买一款价格为<span class="number">500</span>元商品,网上银行转账.A的银行卡余额为<span class="number">2000</span>,然后给商家B支付<span class="number">500.</span>商家B一开始的银行卡余额为<span class="number">10000</span></span><br><span class="line"># 创建数据库 shop 和创建表 account 并插入<span class="number">2</span>条数据</span><br><span class="line"></span><br><span class="line"># 创建数据库 shop</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE shop <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci;</span><br><span class="line"># 使用数据库</span><br><span class="line">USE `shop`;</span><br><span class="line"># 创建表 account</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `account` (</span><br><span class="line">`id` <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`name` <span class="type">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`money` <span class="type">DECIMAL</span>(<span class="number">9</span>,<span class="number">2</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8</span><br><span class="line"># 插入数据</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> account (`name`,`money`) <span class="keyword">VALUES</span>(<span class="string">&#x27;A&#x27;</span>,<span class="number">2000.00</span>),(<span class="string">&#x27;B&#x27;</span>,<span class="number">10000.00</span>)</span><br><span class="line"></span><br><span class="line"># 模拟转账实现</span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>; # 关闭自动提交</span><br><span class="line"><span class="keyword">START</span> TRANSACTION;  # 开始一个事务,标记事务的起始点。</span><br><span class="line"><span class="keyword">UPDATE</span> account <span class="keyword">SET</span> money<span class="operator">=</span>money<span class="number">-500</span> <span class="keyword">WHERE</span> `name`<span class="operator">=</span><span class="string">&#x27;A&#x27;</span>;	# A 减<span class="number">500</span></span><br><span class="line"><span class="keyword">UPDATE</span> account <span class="keyword">SET</span> money<span class="operator">=</span>money<span class="operator">+</span><span class="number">500</span> <span class="keyword">WHERE</span> `name`<span class="operator">=</span><span class="string">&#x27;B&#x27;</span>;	# B 加<span class="number">500</span></span><br><span class="line"><span class="keyword">COMMIT</span>; 	# 提交事务，就被持久化了</span><br><span class="line"><span class="keyword">rollback</span>;	# 回滚事务</span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">1</span>; 	# 恢复默认值：自动提交。</span><br></pre></td></tr></table></figure>

<h1 id="数据库设计"><a href="#数据库设计" class="headerlink" title="数据库设计"></a>数据库设计</h1><p>​		数据库设计必须使关系满足一定的约束条件，此约束已经形成了<code>规范（Normal Form）</code>，分成几个等级，满足这些规范的数据库是简洁的、结构明晰的。</p>
<p><code>第一范式 (1NF)</code>：确保列的<code>原子性：保证每列属性都是不可再分</code>，单一属性的列为基本数据类型构成，设计出的表都是简单的二维表。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 某个字段家庭信息存放：家庭人口数和家庭地理位置</span><br><span class="line"># 不满足 <span class="number">1</span>NF ，应该修改为两个属性列：家庭人口数、户籍</span><br></pre></td></tr></table></figure>

<p><code>第二范式 (2NF)</code>：满足第一范式（1NF）的基础，要求实体的属性完全依赖于主关键字。所谓完全依赖是指不能存在仅依赖主关键字一部分的属性，如果存在，那么这个属性和主关键字的这一部分应该分离出来形成一个新的实体，新实体与原实体之间是一对多的关系。（<code>每个表只描述一件事情</code>）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 某个订单表同一个订单号有多个产品信息（联合主键：主键由多个字段组成）</span><br><span class="line"># 原订单表：订单号、产品号、产品数量、产品价格、订单金额、订单时间（联合主键：订单号和产品号）</span><br><span class="line"># 发现：产品数量、产品价格和联合主键都有关系，但是订单金额和订单时间仅仅与订单号有关</span><br><span class="line"># 需要拆分两张表：表<span class="number">1</span>（订单号、产品号、产品数量、产品价格）、表<span class="number">2</span>（订单号、订单金额、订单时间）</span><br></pre></td></tr></table></figure>

<p><code>第三范式 (3NF)</code>：满足第二范式（2NF）的基础，要求一个数据库表中不包含已在其它表中包含的非主关键字信息，即数据不能存在传递关系，即每个属性都跟主键有直接关系而不是间接关系。（一般是多了臃肿的列属性）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 如果学生表中存在班主任的信息（性别、年龄等）就应该剔除实现一张单独的表</span><br></pre></td></tr></table></figure>

<p><code>[总结]</code> 完全按照范式设计，会产生一些大量的中间表，会导致后面查询时需要联表查询，影响数据库的查询性能。 &#x3D;&#x3D;&#x3D;&#x3D;&gt; <code>反范式设计</code>（牺牲规范换取性能）</p>
<p> <code>反范式设计</code>：违背范式设计，但是对查询性能有所提高的数据库设计方式。</p>
<p>1）为了性能和读取效率而适当违反对数据库设计范式的要求。</p>
<p>2）为了查询的性能，允许存在部分（少量）冗余数据。（也就是<code>使用空间换时间</code>）</p>
<p><code>[案例]</code>  例如商品信息表：ID、商品名称、商品价格、商品描述。分类表：分类名称和分类描述。商品分类对应关系表：商品名称和分类名称。那么便可以直接将分类名称添加到商品信息表中，这时分类名称便是冗余的，但是不用联表查询。</p>
<p><code>[总结]</code>  范式化设计和反范式化设计的对比。</p>
<p>1）范式化设计的<code>更新操作更快</code>，只用修改一张表，而反范式化设计需要改变多张表，维护成本更大。</p>
<p>2）范式设计的表比反范式化更小，操作更快。</p>
<p>3）范式设计的关联的表太多了，查询不方便，但范式化设计减少了表的关联。</p>
<p>4）反范式化设计可以更好地进行索引优化。</p>
<p>设计表时应该尽量遵循范式设计，但发现问题时要及时更改为反范式化设计（权衡利弊），主要还是<code>根据实际的情况</code>。</p>
<p><code>[理论]</code> 字段数据类型的选择和优化。</p>
<p>表数据字段类型基本遵循几个基本原则：</p>
<p>1）<code>更小的通常更好</code>，数据类型需要在业务允许的范围内选择尽量小的字段。</p>
<p>2）<code>简单的通常更好</code>，例如可以用整数和字符串存放某个字段，那么就应该选择简单的整数。</p>
<p>3）<code>尽量避免允许 Null</code>，定义字段时尽量让此列 not Null，比较难以优化，MySQL 里面存放 Null 值实际所占用空间反而可能更高。（可以<code>定义特殊值代表 Null</code>）</p>
<blockquote>
<p>Null 表示不确定的值（每个 null 值都是不一样的，但是<code>在索引扫描的时候都是同一个值</code>）或是空值，用 NULL 进行算术运算 ，结果仍为 Null。</p>
</blockquote>
<p>数值类型：一般使用 tinyint（1byte）、 int（4byte） 、bigint（8byte）。</p>
<blockquote>
<p>需要注意的是位数的设定并没有特别大的作用，只是对输出到客户端(Java)的数据的位数限制，实际数据库仍然能够存更多位数。</p>
</blockquote>
<p>浮点类型：float（4byte）、double（8byte）、decimal（存储 56 个数字）</p>
<blockquote>
<p>decimal 实际是以<code>字符串形式</code>存储的，输出时需要转化，因此速度也会低于 float 和 double。（<code>数据要求精确的选择项</code>）</p>
<p>如果对操作速度有要求，可以考虑将具体的金额进行转化存储到 bigint 中，这样就能提高操作速度。</p>
</blockquote>
<p>字符串类型：一般使用 varchar（变长）、char（定长）、text、tinytext、blob（二进制）、枚举。</p>
<blockquote>
<p>1）varchar 会有 1~2 个字节存放长度，因此过小的数据不适宜使用 varchar。</p>
<p>2）varchar 存储数据时，长度不应该超过最大长度限制的一半，可能会有性能问题。</p>
<p>3）blob 和 text 内存占用大，可能会产生性能问题，使用时尽量分离拆成单独的表。（尽量不用）</p>
<p>4）必要时，固定的几个字符串时，使用枚举代替字符串存储。枚举在实际保存的时候保存的是<code>数字</code>，因此更节省空间。</p>
</blockquote>
<p>日期和事件类型：datetime（时间范围大，8byte）、timestamp（4byte，和时区有关）。（精度都只到秒）</p>
<blockquote>
<p>一定需要存储更小的精度时，可以使用 bigint 来存储时间戳。</p>
</blockquote>
<p><code>[理论]</code>  数据库表和字段的命名规范：</p>
<p>1）遵循可读性原则，命名应该能描述所表达的对象，库名和表名一般有一定关联。</p>
<p>2）必须使用小写字母和数字（不以数字开头），不使用复数名词，禁用保留字来命名。</p>
<blockquote>
<p>MySQL 在 window 下不区分大小写，但是在 linux 下默认区分大小写。</p>
</blockquote>
<p>3）索引命名要一般体现索引的性质，例如 pk、uk、idx等，索引后面尽量跟上索引字段名称。</p>
<p>4）表示概念是与否的字段一般使用 is_xxx 来命名。</p>
<h1 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h1><h2 id="库表基本操作"><a href="#库表基本操作" class="headerlink" title="库表基本操作"></a>库表基本操作</h2><p><code>[案例]</code>  数据库相关操作。</p>
<p>1、创建数据库。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database [if <span class="keyword">not</span> <span class="keyword">exists</span>] 数据库名;</span><br></pre></td></tr></table></figure>

<p>2、删除数据库 （不建议删除数据库）。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> database [if <span class="keyword">exists</span>] 数据库名;</span><br></pre></td></tr></table></figure>

<p>3、查看数据库 。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> databases;</span><br></pre></td></tr></table></figure>

<p>4、使用数据库 ，进行表操作前需要选择数据库。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use 数据库名;</span><br></pre></td></tr></table></figure>

<p>注意：使用 Navicat 创建数据库时，将数据库排序规则设置成：<code>utf8_general_ci</code> 表示校对时不区分大小写。</p>
<p><code>[案例]</code>  数据表相关操作。</p>
<p>1）创建数据表（DDL）。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> [if <span class="keyword">not</span> <span class="keyword">exists</span>] `表名`(</span><br><span class="line">   <span class="string">&#x27;字段名1&#x27;</span> 列类型 [属性][索引][注释],</span><br><span class="line">   <span class="string">&#x27;字段名2&#x27;</span> 列类型 [属性][索引][注释],</span><br><span class="line">   #...</span><br><span class="line">   <span class="string">&#x27;字段名n&#x27;</span> 列类型 [属性][索引][注释]</span><br><span class="line">)[表类型][表字符集][注释];</span><br></pre></td></tr></table></figure>

<p><code>说明</code> ：反引号用于区别 MySQL 保留字与普通字符而引入的 (键盘esc下面的键)。</p>
<p>2）修改表名操作。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 旧表名 RENAME <span class="keyword">AS</span> 新表名;</span><br></pre></td></tr></table></figure>

<p>3）添加字段操作。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">ADD</span>字段名 列属性[属性];</span><br></pre></td></tr></table></figure>

<p>4）修改字段(重命名，修改约束)。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 修改约束</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 MODIFY 字段名 列类型[属性]</span><br><span class="line"># 字段重命名</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 CHANGE 旧字段名 新字段名 列属性[属性]</span><br><span class="line"># 删除字段</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">DROP</span> 字段名</span><br></pre></td></tr></table></figure>

<p>5）删除数据表操作。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> [IF <span class="keyword">EXISTS</span>] 表名</span><br></pre></td></tr></table></figure>

<p>​	<code>注意</code>：所有的操作尽量加上 if 判断，避免报错。</p>
<p><code>[理论]</code>  数据表的字段上的属性选项。</p>
<p>1）<code>UnSigned</code> 设定为无符号数，可以增大正数可使用的范围。</p>
<p>2）<code>ZEROFILL</code> 零填充，表示 <code>不足位数的用 0 来填充</code> , 例如 int(3)，5 则为 005。</p>
<p>3）<code>Auto_InCrement</code> 自增属性，表示该字段在添加记录时会自动加 step（可设定的步长），<code>通常用于设置主键 index , 且为整数类型</code>。</p>
<blockquote>
<p>可定义初始值和步长，同时可以设置全局的自增属性：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> @<span class="variable">@auto</span>_increment_increment<span class="operator">=</span><span class="number">5</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>4）Null 和 not Null 非空，<code>如果设置为 NOT NULL , 则该列必须有值</code>。</p>
<p>5）DEFAULT 默认，用于<code>设置该字段的默认值</code>。</p>
<p><code>[规定]</code>  Alibaba 规定：每个表必须存在五个基本字段：id 主键、version 版本号、is_delete 伪删除、gmt_create 创建时间 和 gmt_update 修改时间。</p>
<p><code>[案例]</code> 创建一个 school 数据库，并创建学生表，表字段为学号、登陆密码、姓名、性别、出生日期、家庭住址、邮箱。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database `school`;</span><br><span class="line">use `school`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> `student` (</span><br><span class="line">`id` <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;学号&#x27;</span>,</span><br><span class="line">`name` <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;匿名&#x27;</span> COMMENT <span class="string">&#x27;姓名&#x27;</span>,		# 设置默认值</span><br><span class="line">`pwd` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;123456&#x27;</span> COMMENT <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">`sex` <span class="type">varchar</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;男&#x27;</span> COMMENT <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line">`birthday` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;生日&#x27;</span>,</span><br><span class="line">`address` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;地址&#x27;</span>,</span><br><span class="line">`email` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;邮箱&#x27;</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看数据库的定义</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> DATABASE school;</span><br><span class="line"><span class="comment">-- 查看数据表的定义</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student;</span><br><span class="line"><span class="comment">-- 显示表结构</span></span><br><span class="line"><span class="keyword">DESC</span> student;  </span><br><span class="line"><span class="comment">-- 设置严格检查模式(不能容错)</span></span><br><span class="line"><span class="keyword">SET</span> sql_mode<span class="operator">=</span><span class="string">&#x27;STRICT_TRANS_TABLES&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><code>[理论]</code>  可以为数据库，数据表，数据列设定不同的字符集。</p>
<p>1）创建时通过命令来设置，不设置的话，<code>默认不支持中文</code>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名()CHARSET <span class="operator">=</span> utf8。</span><br></pre></td></tr></table></figure>

<p>2）根据 MySQL 数据库配置文件 <code>my.ini</code> 中的参数设定。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">character</span><span class="operator">-</span><span class="keyword">set</span><span class="operator">-</span>server<span class="operator">=</span>utf8</span><br></pre></td></tr></table></figure>

<p><code>[理论]</code>  其他常见一般操作。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 可用反引号（``）为标识符（库名、表名、字段名、索引、别名）包裹，以避免与关键字重名！中文也可以作为标识符！</span><br><span class="line"><span class="number">2.</span> 每个库目录存在一个保存当前数据库的选项文件 db.opt。</span><br><span class="line"><span class="number">3.</span> 注释：</span><br><span class="line">  单行注释 # 注释内容</span><br><span class="line">  多行注释 <span class="comment">/* 注释内容 */</span></span><br><span class="line">  单行注释 <span class="comment">-- 注释内容       (标准SQL注释风格，要求双破折号后加一空格符（空格、TAB、换行等）)</span></span><br><span class="line"><span class="number">4.</span> 模式通配符：</span><br><span class="line">  _   任意单个字符</span><br><span class="line">  <span class="operator">%</span>   任意多个字符，甚至包括零字符</span><br><span class="line">  单引号需要进行转义 \<span class="string">&#x27; </span></span><br><span class="line"><span class="string">5. CMD 命令行内的语句结束符可以为 &quot;;&quot;, &quot;\G&quot;, &quot;\g&quot;，仅影响显示结果。其他地方还是用分号结束。delimiter 可修改当前对话的语句结束符。</span></span><br><span class="line"><span class="string">6. SQL对大小写不敏感 （关键字）</span></span><br><span class="line"><span class="string">7. 清除已有语句：\c</span></span><br></pre></td></tr></table></figure>

<h2 id="DML基本操作"><a href="#DML基本操作" class="headerlink" title="DML基本操作"></a>DML基本操作</h2><p>​		数据库管理一般使用 <code>DML语句</code>管理数据库数据（还可以使用可视化工具），主要包括 <code>添加 、更新 、删除  </code>操作。</p>
<p><code>[理论操作]</code>  添加数据操作：需要注意如果不指明插入字段，则添加的值务必与表结构，数据列，顺序相对应，且数量一致，同时此操作 <code>返回插入数据条数</code>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 基本语法</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名[(字段<span class="number">1</span>,字段<span class="number">2</span>,字段<span class="number">3</span>,...)] <span class="keyword">VALUES</span>(<span class="string">&#x27;值1&#x27;</span>,<span class="string">&#x27;值2&#x27;</span>,<span class="string">&#x27;值3&#x27;</span>)</span><br><span class="line"></span><br><span class="line"># 基本使用案例和细节说明：</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> grade(gradename) <span class="keyword">VALUES</span> (<span class="string">&#x27;大一&#x27;</span>);</span><br><span class="line"><span class="comment">-- 主键自增,那能否省略呢? 可以省略</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> grade <span class="keyword">VALUES</span> (<span class="string">&#x27;大二&#x27;</span>);</span><br><span class="line"><span class="comment">-- 查询:INSERT INTO grade VALUE (&#x27;大二&#x27;) 错误代码：1136</span></span><br><span class="line"><span class="keyword">Column</span> count doesn`t <span class="keyword">match</span> <span class="keyword">value</span> count <span class="keyword">at</span> <span class="type">row</span> <span class="number">1</span></span><br><span class="line"><span class="comment">-- 结论:&#x27;字段1,字段2...&#x27;该部分可省略 , 但添加的值务必与表结构,数据列,顺序相对应,且数量一致.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 批量插入多条数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> grade(gradename) <span class="keyword">VALUES</span> (<span class="string">&#x27;大三&#x27;</span>),(<span class="string">&#x27;大四&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><code>[理论操作]</code>  修改数据操作：需要注意如果 condition 筛选条件不指定具体数据记录则修改该表的所有列数据，同时此操作<code>返回受影响的行数</code> 。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> 表名 <span class="keyword">SET</span> column_name<span class="operator">=</span><span class="keyword">value</span> [,column_name2<span class="operator">=</span>value2,...] [<span class="keyword">WHERE</span> <span class="keyword">condition</span>];</span><br><span class="line"></span><br><span class="line"># 修改年级信息</span><br><span class="line"><span class="keyword">UPDATE</span> grade <span class="keyword">SET</span> gradename <span class="operator">=</span> <span class="string">&#x27;高中&#x27;</span> <span class="keyword">WHERE</span> gradeid <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><code>[理论操作]</code>  删除数据操作：需要注意如果 condition 筛选条件不指定具体数据记录则删除该表的所有列数据，同时此操作<code>返回受影响的行数</code> 。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 避免这样，会删除表中全部数据</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> 表名</span><br><span class="line"></span><br><span class="line"># 删除指定数据</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> 表名 [<span class="keyword">WHERE</span> <span class="keyword">condition</span>];</span><br><span class="line"></span><br><span class="line"># 删除 gradeid <span class="operator">=</span> <span class="number">5</span> 的数据记录</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> grade <span class="keyword">WHERE</span> gradeid <span class="operator">=</span> <span class="number">5</span></span><br></pre></td></tr></table></figure>

<p><code>[理论操作]</code>  清空数据表操作：使用 <code>TRUNCATE</code> 将<code>完全清空表数据</code>，但表结构，索引，约束等不变 。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">TRUNCATE</span> [<span class="keyword">TABLE</span>] table_name;</span><br></pre></td></tr></table></figure>

<p>​		truncate 和 delete 操作都能删除数据，都不删除表结构 , 但 truncate 删除速度更快，且 truncate 会重新设置自增属性的计数器，但 delete 并不会重置，同时还不会对事务影响。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 创建一个测试表</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `test` (</span><br><span class="line">`id` <span class="type">INT</span>(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`coll` <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8</span><br><span class="line"></span><br><span class="line"># 插入几个测试数据</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test(`coll`) <span class="keyword">VALUES</span>(<span class="string">&#x27;row1&#x27;</span>),(<span class="string">&#x27;row2&#x27;</span>),(<span class="string">&#x27;row3&#x27;</span>);</span><br><span class="line"></span><br><span class="line"># 删除表数据，如不指定 <span class="keyword">Where</span> 则删除该表的所有列数据，自增当前值依然从原来基础上进行,会记录日志。</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> test;</span><br><span class="line"></span><br><span class="line"># 清空表数据(<span class="keyword">truncate</span>)，<span class="keyword">truncate</span> 清空数据,自增当前值会恢复到初始值重新开始，不会记录日志。</span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> test;</span><br><span class="line"></span><br><span class="line"># 同样使用 <span class="keyword">DELETE</span> 清空不同引擎的数据库表数据，重启数据库服务后</span><br><span class="line"># InnoDB : 自增列从初始值重新开始 (因为是存储在内存中，断电即失)（但 MySQL <span class="number">8.0</span> 已经修复了）</span><br><span class="line"># MyISAM : 自增列依然从上一个自增数据基础上开始 (存在文件中，不会丢失)</span><br></pre></td></tr></table></figure>

<h2 id="DQL基本操作"><a href="#DQL基本操作" class="headerlink" title="DQL基本操作"></a>DQL基本操作</h2><p>​		DQL 就是<code>数据查询语言</code>，是数据库语言中最核心，最重要的语句，是使用频率最高的语句，使用 <code>select</code> 关键字。</p>
<p>SQL 的完整语法：（ [ ] 括号代表可选， { } 括号代表必选）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> [<span class="keyword">ALL</span> <span class="operator">|</span> <span class="keyword">DISTINCT</span>]		# 去重</span><br><span class="line">&#123;<span class="operator">*</span> <span class="operator">|</span> table.<span class="operator">*</span> <span class="operator">|</span> [table.field1[<span class="keyword">as</span> alias1][,table.field2[<span class="keyword">as</span> alias2]][,...]]&#125;	# 查询字段以及别名</span><br><span class="line"><span class="keyword">FROM</span> table_name [<span class="keyword">as</span> table_alias]</span><br><span class="line">  [<span class="keyword">left</span> <span class="operator">|</span> <span class="keyword">right</span> <span class="operator">|</span> <span class="keyword">inner</span> <span class="keyword">join</span> table_name2]  	# 联合查询</span><br><span class="line">  [<span class="keyword">WHERE</span> ...]  	# 指定结果需满足的条件</span><br><span class="line">  [<span class="keyword">GROUP</span> <span class="keyword">BY</span> ...]  	# 指定结果按照哪几个字段来分组</span><br><span class="line">  [<span class="keyword">HAVING</span>]  	# 过滤分组的记录必须满足的次要条件，条件和 <span class="keyword">where</span> 一样，但位置不同</span><br><span class="line">  [<span class="keyword">ORDER</span> <span class="keyword">BY</span> ...]  	# 指定查询记录按一个或多个条件排序</span><br><span class="line">  [LIMIT &#123;[<span class="keyword">offset</span>,]row_count <span class="operator">|</span> row_countOFFSET <span class="keyword">offset</span>&#125;];	# 指定查询的记录从哪条至哪条</span><br></pre></td></tr></table></figure>

<h3 id="基本查询"><a href="#基本查询" class="headerlink" title="基本查询"></a>基本查询</h3><p>1）查询表中所有数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student;	# 效率低</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> student；</span><br></pre></td></tr></table></figure>

<p>2）查询指定字段数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查询指定列：学号 和 姓名</span><br><span class="line"><span class="keyword">select</span> studentno,studentname <span class="keyword">from</span> student;</span><br></pre></td></tr></table></figure>

<p>3）使用 <code>as</code> 关键字查询数据并重命名。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 这里是为列取别名(当然 <span class="keyword">as</span> 关键词可以省略)</span><br><span class="line"><span class="keyword">SELECT</span> studentno <span class="keyword">AS</span> 学号,studentname <span class="keyword">AS</span> 姓名 <span class="keyword">FROM</span> student;</span><br><span class="line"></span><br><span class="line"># 使用 <span class="keyword">as</span> 也可以为表取别名</span><br><span class="line"><span class="keyword">SELECT</span> studentno <span class="keyword">AS</span> 学号,studentname <span class="keyword">AS</span> 姓名 <span class="keyword">FROM</span> student <span class="keyword">AS</span> s;</span><br><span class="line"></span><br><span class="line"># 使用<span class="keyword">as</span>，为查询结果取一个新名字，CONCAT() 函数拼接字符串</span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;姓名:&#x27;</span>,studentname) <span class="keyword">AS</span> 新姓名 <span class="keyword">FROM</span> student;</span><br></pre></td></tr></table></figure>

<p>4）使用 <code>distinct</code> 关键字去除查询记录结果中的重复记录。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 利用学号查询哪些同学参加了考试</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">result</span>; 	# <span class="number">1</span>、查看全部考试成绩</span><br><span class="line"><span class="keyword">SELECT</span> studentno <span class="keyword">FROM</span> <span class="keyword">result</span>; 	# <span class="number">2</span>、查看哪些同学参加了考试</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> studentno <span class="keyword">FROM</span> <span class="keyword">result</span>; # <span class="number">3</span>、<span class="keyword">DISTINCT</span> 去除重复数据项 , (默认是<span class="keyword">ALL</span>)</span><br></pre></td></tr></table></figure>

<p>5）对一些 MySQL 的基本信息的查询。数据库中的表达式 一般由文本值，列值，NULL，函数和操作符等组成，可以在返回结果列中使用，也可以在order by, having 等子句中使用，也可以在 where 条件语句中使用。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># selcet 查询中可以使用表达式</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@auto</span>_increment_increment; 		# 查询自增步长</span><br><span class="line"><span class="keyword">SELECT</span> VERSION(); 		# 查询系统版本号</span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">100</span><span class="operator">*</span><span class="number">3</span><span class="number">-1</span> <span class="keyword">AS</span> 计算结果; 	# 用来计算</span><br><span class="line"></span><br><span class="line"># 学员考试成绩集体加一分查看</span><br><span class="line"><span class="keyword">SELECT</span> studentno,StudentResult<span class="operator">+</span><span class="number">1</span> <span class="keyword">AS</span> <span class="string">&#x27;提分后&#x27;</span> <span class="keyword">FROM</span> <span class="keyword">result</span>;</span><br></pre></td></tr></table></figure>

<h3 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h3><p><code>[理论]</code>  条件查询主要用于检索数据表中 <code>符合设定条件</code> 的记录，而具体的搜索条件可由一个或多个逻辑表达式组成 , 结果一般为 boolean：真或假。</p>
<blockquote>
<p><code>and</code>：&amp;&amp;，表示逻辑与操作，同时为 true 才为 true。</p>
<p><code>or</code>：||，表示逻辑或操作，有一个为 true 就为 true。</p>
<p><code>not</code>：！，表示逻辑非操作，操作为 false 就为 true。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 所有学生的成绩查询</span><br><span class="line"><span class="keyword">SELECT</span> Studentno,StudentResult <span class="keyword">FROM</span> <span class="keyword">result</span>;</span><br><span class="line"># 查询考试成绩在<span class="number">95</span><span class="number">-100</span>之间的：使用 <span class="keyword">and</span> 或 <span class="operator">&amp;&amp;</span></span><br><span class="line"><span class="keyword">SELECT</span> Studentno,StudentResult <span class="keyword">FROM</span> <span class="keyword">result</span> <span class="keyword">WHERE</span> StudentResult<span class="operator">&gt;=</span><span class="number">95</span> <span class="keyword">AND</span> StudentResult<span class="operator">&lt;=</span><span class="number">100</span>;</span><br><span class="line"># 模糊查询(对应的词:精确查询)	BETWEEN...AND</span><br><span class="line"><span class="keyword">SELECT</span> Studentno,StudentResult <span class="keyword">FROM</span> <span class="keyword">result</span> <span class="keyword">WHERE</span> StudentResult <span class="keyword">BETWEEN</span> <span class="number">95</span> <span class="keyword">AND</span> <span class="number">100</span>;</span><br><span class="line"># 除了<span class="number">1000</span>号同学,查询其他同学的成绩</span><br><span class="line"><span class="keyword">SELECT</span> studentno,studentresult <span class="keyword">FROM</span> <span class="keyword">result</span> <span class="keyword">WHERE</span> studentno<span class="operator">!=</span><span class="number">1000</span>;</span><br><span class="line"># 使用 <span class="keyword">NOT</span> 查询<span class="number">1000</span>号以外其他同学的成绩</span><br><span class="line"><span class="keyword">SELECT</span> studentno,studentresult <span class="keyword">FROM</span> <span class="keyword">result</span> <span class="keyword">WHERE</span> <span class="keyword">NOT</span> studentno<span class="operator">=</span><span class="number">1000</span>;</span><br></pre></td></tr></table></figure>

<p><code>[理论]</code>  可以使用一些比较运算符来进行模糊查询。</p>
<p>1）<code>is null</code> 和 <code>is not null</code> 表示查询该项为 null 或者不为 null。</p>
<blockquote>
<p>当判断某项数据是否为 null 时不能使用 <code>= Null</code>，二应该使用 is null。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查询出生日期没有填写的同学（注意此处的判空操作：双重判断）</span><br><span class="line"><span class="keyword">SELECT</span> studentname <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> BornDate <span class="keyword">IS</span> <span class="keyword">NULL</span> <span class="keyword">OR</span> BornDate<span class="operator">=</span><span class="string">&#x27;&#x27;</span>;</span><br><span class="line"># 查询出生日期填写的同学</span><br><span class="line"><span class="keyword">SELECT</span> studentname <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> BornDate <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br><span class="line"># 查询没有写家庭住址的同学(空字符串并不等于<span class="keyword">null</span>)</span><br><span class="line"><span class="keyword">SELECT</span> studentname <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> Address<span class="operator">=</span><span class="string">&#x27;&#x27;</span> <span class="keyword">OR</span> Address <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<p>2）<code>between and</code> 表示查询某项位于某个区间内的数据。</p>
<p>3）<code>like</code> 表示模糊匹配，有一定的匹配技巧和语法，一般可能会搭配 % （表示转义或缺省）来使用。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 查询姓刘的同学的学号及姓名</span><br><span class="line"># <span class="keyword">like</span> 结合使用的通配符 : <span class="operator">%</span> (代表 <span class="number">0</span> 到任意个字符，主要只能在 <span class="keyword">like</span> 里面使用)	 	</span><br><span class="line"><span class="keyword">SELECT</span> studentno,studentname <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> studentname <span class="keyword">LIKE</span> <span class="string">&#x27;刘%&#x27;</span>;	# 表示后面可能还有多个字符</span><br><span class="line"><span class="keyword">SELECT</span> studentno,studentname <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> studentname <span class="keyword">LIKE</span> <span class="string">&#x27;%刘&#x27;</span>;	# 表示前面可能还有多个字符</span><br><span class="line"># 查询姓刘的同学,后面只有一个字的，_ (代表一个字符)</span><br><span class="line"><span class="keyword">SELECT</span> studentno,studentname <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> studentname <span class="keyword">LIKE</span> <span class="string">&#x27;刘_&#x27;</span>;</span><br><span class="line"># 查询姓刘的同学,后面只有两个字的</span><br><span class="line"><span class="keyword">SELECT</span> studentno,studentname <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> studentname <span class="keyword">LIKE</span> <span class="string">&#x27;刘__&#x27;</span>;</span><br><span class="line"># 查询姓名中含有<span class="string">&#x27;嘉&#x27;</span>字的</span><br><span class="line"><span class="keyword">SELECT</span> studentno,studentname <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> studentname <span class="keyword">LIKE</span> <span class="string">&#x27;%嘉%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>4）<code>in</code> 表示判断某项是否位于某个范围内，in 后面跟范围。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 查询学号为 <span class="number">1000</span>,<span class="number">1001</span>,<span class="number">1002</span> 的学生姓名</span><br><span class="line"><span class="keyword">SELECT</span> studentno,studentname <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> studentno <span class="keyword">IN</span> (<span class="number">1000</span>,<span class="number">1001</span>,<span class="number">1002</span>);</span><br><span class="line"># 查询地址在北京,南京或河南洛阳的学生</span><br><span class="line"><span class="keyword">SELECT</span> studentno,studentname,address <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> address <span class="keyword">IN</span> (<span class="string">&#x27;北京&#x27;</span>,<span class="string">&#x27;南京&#x27;</span>,<span class="string">&#x27;河南洛阳&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="联表查询"><a href="#联表查询" class="headerlink" title="联表查询"></a>联表查询</h3><p>​		联表查询是 SQL 高阶查询的重点查询方式，可以分为 <code>join 联表查询</code> 和 <code>自联结查询</code>。</p>
<p><code>[理论]</code>  <code>JOIN</code> 是对多张表进行结果汇总的一起查询，一般和 <code>on</code> 一起使用，使用 Join 联表查询有几种方式。</p>
<p>1）<code>inner join </code>：内连接查询，表示取出两张表的<code>交集</code>。</p>
<p>2）<code>left join</code>：左连接查询，表示以左表为基准，右边表来匹配，匹配不上的，<code>返回左表的记录</code>，右表以 NULL 填充。</p>
<p>3）<code>right join</code>：右连接查询，表示以右表为基准，左边表来匹配，匹配不上的，<code>返回右表的记录</code>，左表以 NULL 填充。</p>
<p><code>[案例分析]</code>  分析网络上的其中 join 理论，全面解释每种的用法，案例为：查询参加了考试的同学信息(学号、学生姓名、科目编号、分数)。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student;	# 查询所有学生</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">result</span>;	# 查询所有成绩</span><br><span class="line"># (<span class="number">1</span>) 分析需求,确定查询的列来源于两个类,student <span class="keyword">result</span>,连接查询</span><br><span class="line"># (<span class="number">2</span>) 确定使用哪种连接查询? (内连接)：如果表中至少有一个匹配，就返回行</span><br><span class="line"># (<span class="number">3</span>) 确定交叉点，判断这两个表中哪个数据是相同的：学号 studentno，那么判断条件：result.studentno <span class="operator">=</span> student.studentno</span><br><span class="line"><span class="keyword">SELECT</span> s.studentno,studentname,Subjectno,StudentResult </span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> <span class="keyword">result</span> r <span class="keyword">on</span> r.studentno <span class="operator">=</span> s.studentno</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 右连接方式实现：会从右表中返回所有的值，即使左表中没有匹配，没有匹配的记录填充 <span class="keyword">null</span></span><br><span class="line"><span class="keyword">SELECT</span> s.studentno,studentname,subjectno,StudentResult</span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> <span class="keyword">result</span> r</span><br><span class="line"><span class="keyword">ON</span> r.studentno <span class="operator">=</span> s.studentno</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 左连接方式实现(查询了所有同学,不考试的也会查出来)：会从左表中返回所有的值，即使右表中没有匹配，没有匹配的记录填充 <span class="keyword">null</span></span><br><span class="line"><span class="keyword">SELECT</span> s.studentno,studentname,subjectno,StudentResult</span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> <span class="keyword">result</span> r</span><br><span class="line"><span class="keyword">ON</span> r.studentno <span class="operator">=</span> s.studentno</span><br><span class="line"></span><br><span class="line"># 查询缺考的同学(左连接应用场景)</span><br><span class="line"><span class="keyword">SELECT</span> s.studentno,studentname,subjectno,StudentResult</span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> <span class="keyword">result</span> r</span><br><span class="line"><span class="keyword">ON</span> r.studentno <span class="operator">=</span> s.studentno</span><br><span class="line"><span class="keyword">WHERE</span> StudentResult <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>

<p><code>[案例实现]</code>  查询参加了考试的同学信息(学号，学生姓名，科目名，分数)：三表查询。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># (<span class="number">1</span>) 分析需求,确定查询的列来源于两个类,student <span class="keyword">result</span>,subject 连接查询</span><br><span class="line"># (<span class="number">2</span>) 确定使用哪种连接查询? (内连接)：如果表中至少有一个匹配，就返回行</span><br><span class="line"># 确定交叉点：这两个表中哪个数据是相同的，判断条件：学生表中的 studentNo<span class="operator">=</span>成绩表中的studentNo，<span class="keyword">result</span>表中的subjectNo<span class="operator">=</span>subject 表中的subjectNo</span><br><span class="line"># 解决步骤：</span><br><span class="line"># <span class="number">1</span>、确定查询字段</span><br><span class="line"># <span class="number">2</span>、确定从哪几个表查，确定 基准表</span><br><span class="line"># <span class="number">3</span>、查询考试信息 <span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">&gt;</span> 以 <span class="keyword">result</span> 表为基准</span><br><span class="line"># <span class="number">4</span>、前面两个表结果再和后面的 subject 表需要查交集 <span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">&gt;</span> <span class="keyword">Inner</span> <span class="keyword">Join</span></span><br><span class="line"># 注意：假设存在一种多张表查询，慢慢来，先查询两张表然后慢慢增加</span><br><span class="line"><span class="keyword">SELECT</span> s.studentno,studentname,subjectname,StudentResult</span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> <span class="keyword">result</span> r</span><br><span class="line"><span class="keyword">ON</span> r.studentno <span class="operator">=</span> s.studentno</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> `subject` sub</span><br><span class="line"><span class="keyword">ON</span> sub.subjectno <span class="operator">=</span> r.subjectno</span><br></pre></td></tr></table></figure>

<p><code>[案例实现]</code>  补充联表查询的 SQL 语句实例。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 查询学员及所属的年级(学号,学生姓名,年级名)</span><br><span class="line"><span class="keyword">SELECT</span> studentno <span class="keyword">AS</span> 学号,studentname <span class="keyword">AS</span> 学生姓名,gradename <span class="keyword">AS</span> 年级名称</span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> grade g</span><br><span class="line"><span class="keyword">ON</span> s.`GradeId` <span class="operator">=</span> g.`GradeID`</span><br><span class="line"></span><br><span class="line"># 查询科目及所属的年级(科目名称,年级名称)</span><br><span class="line"><span class="keyword">SELECT</span> subjectname <span class="keyword">AS</span> 科目名称,gradename <span class="keyword">AS</span> 年级名称</span><br><span class="line"><span class="keyword">FROM</span> SUBJECT sub</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> grade g</span><br><span class="line"><span class="keyword">ON</span> sub.gradeid <span class="operator">=</span> g.gradeid</span><br><span class="line"></span><br><span class="line"># 查询参加了高等数学<span class="number">-1</span> 的所有考试结果(学号 学生姓名 科目名称 成绩)</span><br><span class="line"><span class="keyword">SELECT</span> s.studentno,studentname,subjectname,StudentResult</span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> <span class="keyword">result</span> r</span><br><span class="line"><span class="keyword">ON</span> r.studentno <span class="operator">=</span> s.studentno</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> `subject` sub</span><br><span class="line"><span class="keyword">ON</span> r.subjectno <span class="operator">=</span> sub.subjectno</span><br><span class="line"><span class="keyword">WHERE</span> subjectName<span class="operator">=</span>&quot;高等数学-1&quot;</span><br></pre></td></tr></table></figure>

<p><code>[理论]</code>  <code>七种 Join 理论</code>的场景适用。</p>
<p><img src="https://img-blog.csdnimg.cn/20200511191943540.png" alt="在这里插入图片描述"></p>
<p><code>[理论]</code>  还存在场景，需要数据表和自身连接查询，这种方案的核心就是<code>将一张表拆成两张相同的表</code>使用。</p>
<p>​	对于下面这张表，父类和子类都在同一个表中，那么如何查询到查询父类对应的子类关系呢？这就需要看清楚他们的父子关系，只有部分记录的父 id 是1，这就表示这是父类，其余记录的父 id 是这几个中的其中一个。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 创建一个表</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `category` (</span><br><span class="line">`categoryid` <span class="type">INT</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主题id&#x27;</span>,</span><br><span class="line">`pid` <span class="type">INT</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;父id&#x27;</span>,</span><br><span class="line">`categoryName` <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;主题名字&#x27;</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`categoryid`)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">9</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8</span><br><span class="line"></span><br><span class="line"># 插入数据</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `category` (`categoryid`, `pid`, `categoryName`)</span><br><span class="line"><span class="keyword">VALUES</span>  (<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;信息技术&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;软件开发&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;数据库&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;美术设计&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;web开发&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;7&#x27;</span>,<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;ps技术&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;办公信息&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 从一个包含栏目ID , 栏目名称和父栏目ID的表中，查询父栏目名称和其他子栏目名称</span><br><span class="line"># 编写<span class="keyword">SQL</span>语句,将栏目的父子关系呈现出来 (父栏目名称,子栏目名称)</span><br><span class="line"># 核心思想:把一张表看成两张一模一样的表,然后将这两张表连接查询(自连接)</span><br><span class="line"><span class="keyword">SELECT</span> a.categoryName <span class="keyword">AS</span> <span class="string">&#x27;父栏目&#x27;</span>,b.categoryName <span class="keyword">AS</span> <span class="string">&#x27;子栏目&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> category <span class="keyword">AS</span> a,category <span class="keyword">AS</span> b</span><br><span class="line"><span class="keyword">WHERE</span> a.`categoryid`<span class="operator">=</span>b.`pid`</span><br></pre></td></tr></table></figure>

<h3 id="分页排序"><a href="#分页排序" class="headerlink" title="分页排序"></a>分页排序</h3><p><code>[理论]</code>分页使用 <code>limit</code> 关键字实现，需要注意数据是从 0 开始计算。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">limit 起始值，页面的大小</span><br><span class="line"># 第 N 页 : limit (pageNo<span class="number">-1</span>)<span class="operator">*</span>pageSzie,pageSzie</span><br><span class="line"># pageNo: 当前页码</span><br><span class="line"># pageSize: 单页面显示条数</span><br><span class="line"># 数据总页数：<span class="built_in">ceil</span>(数据总数<span class="operator">/</span>页面大小)</span><br></pre></td></tr></table></figure>

<p><code>[理论]</code>排序使用 <code>order by</code> 关键字实现，分为<code>升序（asc）和倒序（desc）</code>两种，用来对查询结果进行整理。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> 字段 <span class="keyword">asc</span><span class="operator">/</span><span class="keyword">desc</span>	# 默认按照 <span class="keyword">ASC</span> 升序对记录进行排序。</span><br></pre></td></tr></table></figure>

<p><code>[案例]</code>  查询 高等数学-1 课程成绩前 10 名并且分数大于 80 的学生信息(学号、姓名、课程名、分数)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s.studentno <span class="keyword">as</span> &quot;学号&quot;,studentname <span class="keyword">as</span> &quot;姓名&quot;,subjectname <span class="keyword">as</span> &quot;课程&quot;,studentResult <span class="keyword">as</span> &quot;分数&quot;</span><br><span class="line"><span class="keyword">from</span> student <span class="keyword">as</span> s</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> <span class="keyword">result</span> <span class="keyword">as</span> r</span><br><span class="line"><span class="keyword">on</span> s.studentno<span class="operator">=</span>r.studentno</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> subject <span class="keyword">as</span> sub</span><br><span class="line"><span class="keyword">on</span> sub.subjectno<span class="operator">=</span>r.subjectno</span><br><span class="line"><span class="keyword">where</span> r.studentResult <span class="operator">&gt;</span> <span class="number">80</span> <span class="keyword">and</span> sub.subjectname<span class="operator">=</span>&quot;高等数学-1&quot;</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> r.studentResult <span class="keyword">desc</span></span><br><span class="line">limit <span class="number">0</span>,<span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<h3 id="子句查询"><a href="#子句查询" class="headerlink" title="子句查询"></a>子句查询</h3><p><code>[理论]</code>  子查询就是 where 的查询条件是一个查询语句：在查询语句中的 WHERE 条件子句中，又嵌套了另一个查询语句。</p>
<p><code>注意</code>：嵌套查询可由多个子查询组成，求解的方式是由里及外，子查询返回的结果一般都是集合，故而建议使用 <code>IN</code> 关键字。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"># 查询 高等数学<span class="number">-1</span> 的所有考试结果(学号,科目名称,成绩),并且成绩降序排列。</span><br><span class="line"># 方法一:使用连接查询</span><br><span class="line"><span class="keyword">SELECT</span> studentno,r.subjectname,StudentResult</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">result</span> r</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> `subject` sub</span><br><span class="line"><span class="keyword">ON</span> r.`SubjectNo`<span class="operator">=</span>sub.`SubjectNo`</span><br><span class="line"><span class="keyword">WHERE</span> subjectname <span class="operator">=</span> <span class="string">&#x27;高等数学-1&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> studentresult <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"># 方法二:使用子查询(执行顺序:由里及外)</span><br><span class="line"><span class="keyword">select</span> studentno <span class="keyword">as</span> &quot;学号&quot;,subjectno <span class="keyword">as</span> &quot;科目编号&quot;,studentResult <span class="keyword">as</span> &quot;成绩&quot;</span><br><span class="line"><span class="keyword">from</span> <span class="keyword">result</span> <span class="keyword">as</span> r</span><br><span class="line"><span class="keyword">where</span> subjectno<span class="operator">=</span>(</span><br><span class="line">	<span class="keyword">select</span> subjectno <span class="keyword">from</span> subject <span class="keyword">where</span> subjectname<span class="operator">=</span>&quot;高等数学-1&quot;</span><br><span class="line">)</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> studentResult <span class="keyword">desc</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查询课程为 高等数学<span class="number">-2</span> 且分数不小于<span class="number">80</span>分的学生的学号和姓名</span><br><span class="line"># 方法一:使用连接查询	<span class="keyword">DISTINCT</span> 去重复</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> s.studentno,studentname</span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> <span class="keyword">result</span> r</span><br><span class="line"><span class="keyword">ON</span> s.`StudentNo` <span class="operator">=</span> r.`StudentNo`</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> `subject` sub</span><br><span class="line"><span class="keyword">ON</span> sub.`SubjectNo` <span class="operator">=</span> r.`SubjectNo`</span><br><span class="line"><span class="keyword">WHERE</span> subjectname <span class="operator">=</span> <span class="string">&#x27;高等数学-2&#x27;</span> <span class="keyword">AND</span> StudentResult<span class="operator">&gt;=</span><span class="number">80</span></span><br><span class="line"></span><br><span class="line"># 方法二:使用连接查询<span class="operator">+</span>子查询</span><br><span class="line"># 分数不小于<span class="number">80</span>分的学生的学号和姓名</span><br><span class="line"><span class="keyword">SELECT</span> r.studentno,studentname </span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> <span class="keyword">result</span> r <span class="keyword">ON</span> s.`StudentNo`<span class="operator">=</span>r.`StudentNo`</span><br><span class="line"><span class="keyword">WHERE</span> StudentResult<span class="operator">&gt;=</span><span class="number">80</span> <span class="keyword">AND</span> subjectno<span class="operator">=</span>...</span><br><span class="line"></span><br><span class="line"># 在上面<span class="keyword">SQL</span>基础上,添加需求:课程为 高等数学<span class="number">-2</span></span><br><span class="line"><span class="keyword">SELECT</span> r.studentno,studentname <span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> <span class="keyword">result</span> r <span class="keyword">ON</span> s.`StudentNo`<span class="operator">=</span>r.`StudentNo`</span><br><span class="line"><span class="keyword">WHERE</span> StudentResult<span class="operator">&gt;=</span><span class="number">80</span> <span class="keyword">AND</span> subjectno<span class="operator">=</span>(</span><br><span class="line">   <span class="keyword">SELECT</span> subjectno <span class="keyword">FROM</span> subject <span class="keyword">WHERE</span> subjectname <span class="operator">=</span> <span class="string">&#x27;高等数学-2&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"># 方法三:使用纯子查询</span><br><span class="line"># 分步写简单<span class="keyword">sql</span>语句,然后将其嵌套起来（由里及外）</span><br><span class="line"><span class="keyword">SELECT</span> studentno,studentname <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> studentno <span class="keyword">IN</span>(</span><br><span class="line">   <span class="keyword">SELECT</span> studentno <span class="keyword">FROM</span> <span class="keyword">result</span> <span class="keyword">WHERE</span> StudentResult<span class="operator">&gt;=</span><span class="number">80</span> <span class="keyword">AND</span> subjectno<span class="operator">=</span>(</span><br><span class="line">       <span class="keyword">SELECT</span> subjectno <span class="keyword">FROM</span> `subject` <span class="keyword">WHERE</span> subjectname <span class="operator">=</span> <span class="string">&#x27;高等数学-2&#x27;</span></span><br><span class="line">  )</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"># 查 C语言<span class="number">-1</span> 的前<span class="number">5</span>名学生的成绩信息(学号,姓名,分数)</span><br><span class="line"># 方法一：联表查询</span><br><span class="line"><span class="keyword">select</span> s.studentno <span class="keyword">as</span> &quot;学号&quot;,studentname <span class="keyword">as</span> &quot;姓名&quot;,studentResult <span class="keyword">as</span> &quot;分数&quot;</span><br><span class="line"><span class="keyword">from</span> student <span class="keyword">as</span> s</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> <span class="keyword">result</span> <span class="keyword">as</span> r</span><br><span class="line"><span class="keyword">on</span> s.studentno<span class="operator">=</span>r.studentno</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> subject <span class="keyword">as</span> sub</span><br><span class="line"><span class="keyword">on</span> sub.subjectno<span class="operator">=</span>r.subjectno</span><br><span class="line"><span class="keyword">where</span> sub.subjectname<span class="operator">=</span>&quot;C语言-1&quot;</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> r.studentResult <span class="keyword">desc</span></span><br><span class="line">limit <span class="number">0</span>,<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"># 方法二:使用连接查询<span class="operator">+</span>子查询</span><br><span class="line"><span class="keyword">select</span> s.studentno <span class="keyword">as</span> &quot;学号&quot;,studentname <span class="keyword">as</span> &quot;姓名&quot;,studentResult <span class="keyword">as</span> &quot;分数&quot;</span><br><span class="line"><span class="keyword">from</span> student <span class="keyword">as</span> s </span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> <span class="keyword">result</span> <span class="keyword">as</span> r</span><br><span class="line"><span class="keyword">on</span> s.studentno<span class="operator">=</span>r.studentno</span><br><span class="line"><span class="keyword">where</span> r.subjectno <span class="keyword">in</span> (</span><br><span class="line">	<span class="keyword">select</span> subjectno <span class="keyword">from</span> subject <span class="keyword">where</span> subjectname<span class="operator">=</span>&quot;C语言-1&quot;</span><br><span class="line">)</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> r.studentResult <span class="keyword">desc</span></span><br><span class="line">limit <span class="number">0</span>,<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"># 使用子查询,查询张伟同学所在的年级名称</span><br><span class="line"><span class="keyword">select</span> gradename</span><br><span class="line"><span class="keyword">from</span> grade</span><br><span class="line"><span class="keyword">where</span> gradeid <span class="keyword">in</span> (</span><br><span class="line">	<span class="keyword">select</span> gradeid <span class="keyword">from</span> student <span class="keyword">where</span> studentname<span class="operator">=</span>&quot;张伟&quot;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h1 id="外键概述"><a href="#外键概述" class="headerlink" title="外键概述"></a>外键概述</h1><p><code>[案例]</code>  引用别人的表叫主表，被引用的表叫从表。在下面的示例中，学生表的外键是 gradeid，引用年级表。学生表为主表，年级表为从表。</p>
<p>外键作用：保持数据一致性，完整性，主要目的是控制和约束存储在外键表中的数据，使两张表形成关联，外键只能引用外表中的列的值或使用空值。</p>
<p>1）创建外键的方式一：创建子表同时创建外键，增加约束，此种方法麻烦复杂。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 年级表 (id、年级名称)</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `grade` (</span><br><span class="line">`gradeid` <span class="type">INT</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;年级ID&#x27;</span>,</span><br><span class="line">`gradename` <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;年级名称&#x27;</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`gradeid`)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8</span><br><span class="line"></span><br><span class="line"># 学生表的 gradeid 字段 要去引用年纪表的 gradeid</span><br><span class="line"># 定义外键 key </span><br><span class="line"># 给这个外键添加约束（执行引用） <span class="keyword">references</span> 引用</span><br><span class="line"># 学生信息表 (学号,姓名,性别,年级,手机,地址,出生日期,邮箱,身份证号)</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `student` (</span><br><span class="line">`studentno` <span class="type">INT</span>(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;学号&#x27;</span>,</span><br><span class="line">`studentname` <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;匿名&#x27;</span> COMMENT <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">`sex` TINYINT(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span> COMMENT <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line">`gradeid` <span class="type">INT</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;年级&#x27;</span>,</span><br><span class="line">`phoneNum` <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;手机&#x27;</span>,</span><br><span class="line">`address` <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;地址&#x27;</span>,</span><br><span class="line">`borndate` DATETIME <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;生日&#x27;</span>,</span><br><span class="line">`email` <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;邮箱&#x27;</span>,</span><br><span class="line">`idCard` <span class="type">VARCHAR</span>(<span class="number">18</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;身份证号&#x27;</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`studentno`),</span><br><span class="line">KEY `FK_gradeid` (`gradeid`),</span><br><span class="line"><span class="keyword">CONSTRAINT</span> `FK_gradeid` <span class="keyword">FOREIGN</span> KEY (`gradeid`) <span class="keyword">REFERENCES</span> `grade` (`gradeid`)		# 设置外键约束</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8</span><br></pre></td></tr></table></figure>

<p>2）创建外键的方式二：创建子表完毕后,修改子表添加外键。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `student` <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> `FK_gradeid` <span class="keyword">FOREIGN</span> KEY (`gradeid`) <span class="keyword">REFERENCES</span> `grade` (`gradeid`);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>删除外键注意项：<code>删除具有主外键关系的表时 , 要先删子表 , 后删主表。</code></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 删除外键</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> student <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> KEY FK_gradeid;</span><br><span class="line"># 发现执行完上面的,索引还在,所以还要删除索引</span><br><span class="line"># 注:这个索引是建立外键的时候默认生成的</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> student <span class="keyword">DROP</span> INDEX FK_gradeid;</span><br></pre></td></tr></table></figure>

<p><code>以上的操作都是物理外键，数据库级别的外键，我们不建议使用！（避免数据库过多造成困扰，这里了解即可！）</code></p>
<blockquote>
<p>Alibaba 开发手册规定：不得使用外键和级联，一切外键概念必须在应用层解决。（Java 代码实现），因此更推荐的方式是数据库就是单纯的表，只用来存数据，只有行（数据）和列（字段），如果想要多张表的数据就使用程序实现（联表查询等），而不是使用外键。</p>
</blockquote>
<h1 id="基本函数"><a href="#基本函数" class="headerlink" title="基本函数"></a>基本函数</h1><h2 id="基本处理函数"><a href="#基本处理函数" class="headerlink" title="基本处理函数"></a>基本处理函数</h2><p><code>[理论]</code>  数据库级别的基本数学计算函数。（实际不怎么实用）</p>
<p>1）绝对值函数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">ABS</span>(<span class="number">-8</span>);</span><br></pre></td></tr></table></figure>

<p>2）向上取整和向下取整函数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 向上取整</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CEILING</span>(<span class="number">9.4</span>); 	</span><br><span class="line"># 向下取整</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(<span class="number">9.4</span>);  </span><br></pre></td></tr></table></figure>

<p>3）生成随机数函数，返回一个 0-1 之间的随机数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> RAND(); </span><br></pre></td></tr></table></figure>

<p>4）符号函数，用于确定一个数的正负性，负数返回 -1，正数返回 1，0返回 0 。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SIGN(<span class="number">0</span>); 	</span><br></pre></td></tr></table></figure>

<p><code>[理论]</code>  数据库级别的字符串使用函数，需要注意字符串的操作索引是<code>从 1 开始计数</code>，和 Java 有区别。</p>
<p>1）合并字符串。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;我&#x27;</span>,<span class="string">&#x27;爱&#x27;</span>,<span class="string">&#x27;程序&#x27;</span>);  </span><br></pre></td></tr></table></figure>

<p>2）截取字符串。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SUBSTR(<span class="string">&#x27;我们说坚持就能成功&#x27;</span>,<span class="number">4</span>,<span class="number">6</span>);</span><br></pre></td></tr></table></figure>

<p>3）替换字符串。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> REPLACE(<span class="string">&#x27;我们坚持就能成功&#x27;</span>,<span class="string">&#x27;坚持&#x27;</span>,<span class="string">&#x27;努力&#x27;</span>); </span><br></pre></td></tr></table></figure>

<p>4）其余函数（不怎么使用）。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 返回字符串包含的字符数</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CHAR_LENGTH</span>(<span class="string">&#x27;所爱隔山海，山海皆可平&#x27;</span>); </span><br><span class="line"> # 替换字符串,从某个位置开始替换某个长度，从第一个位置替换两个长度</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">INSERT</span>(<span class="string">&#x27;我爱编程helloworld&#x27;</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="string">&#x27;超级热爱&#x27;</span>);  </span><br><span class="line"># 转小写</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">LOWER</span>(<span class="string">&#x27;GaoZHeng&#x27;</span>); 	</span><br><span class="line"># 转大写</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">UPPER</span>(<span class="string">&#x27;KuangShen&#x27;</span>); 	</span><br><span class="line"># 返回第一次出现的字串的索引</span><br><span class="line"><span class="keyword">SELECT</span> INSTR(<span class="string">&#x27;GaoZHeng&#x27;</span>,<span class="string">&#x27;H&#x27;</span>);	</span><br><span class="line"># 从左边截取</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LEFT</span>(<span class="string">&#x27;hello,world&#x27;</span>,<span class="number">5</span>);   </span><br><span class="line"># 从右边截取</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RIGHT</span>(<span class="string">&#x27;hello,world&#x27;</span>,<span class="number">5</span>);  </span><br><span class="line"># 反转</span><br><span class="line"><span class="keyword">SELECT</span> REVERSE(<span class="string">&#x27;我们说坚持就能成功&#x27;</span>);</span><br><span class="line"></span><br><span class="line"># 查询姓周的同学,改成邹，不会修改源数据</span><br><span class="line"><span class="keyword">SELECT</span> REPLACE(studentname,<span class="string">&#x27;周&#x27;</span>,<span class="string">&#x27;邹&#x27;</span>) <span class="keyword">AS</span> 新名字</span><br><span class="line"><span class="keyword">FROM</span> student <span class="keyword">WHERE</span> studentname <span class="keyword">LIKE</span> <span class="string">&#x27;周%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><code>[理论]</code>  日期和时间的操作函数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 获取当前日期</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CURRENT_DATE</span>();   </span><br><span class="line"><span class="keyword">SELECT</span> CURDATE();   </span><br><span class="line"># 获取当前日期和时间</span><br><span class="line"><span class="keyword">SELECT</span> NOW();   </span><br><span class="line"># 获取当前本地日期和时间</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">LOCALTIME</span>();   </span><br><span class="line"># 获取当前系统日期和时间</span><br><span class="line"><span class="keyword">SELECT</span> SYSDATE();   </span><br><span class="line"></span><br><span class="line"># 获取年、月、日、时、分、秒</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">YEAR</span>(NOW());</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MONTH</span>(NOW());</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DAY</span>(NOW());</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">HOUR</span>(NOW());</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MINUTE</span>(NOW());</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SECOND</span>(NOW());</span><br></pre></td></tr></table></figure>

<p><code>[理论]</code>  系统信息操作函数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 查询 MySQL 版本</span><br><span class="line"><span class="keyword">SELECT</span> VERSION(); 			</span><br><span class="line"># 查询当前登录用户</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SYSTEM_USER</span>();    </span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">USER</span>();     		</span><br></pre></td></tr></table></figure>

<h2 id="进阶聚合函数"><a href="#进阶聚合函数" class="headerlink" title="进阶聚合函数"></a>进阶聚合函数</h2><p>​		聚合函数是实际工作中使用比较多的函数，可以对查询的数据进行一定的<code>计算和处理</code>，例如平均值或是计算总和等。</p>
<p>1）<code>count</code> 函数：返回满足 Select 条件的记录总和数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># <span class="built_in">count</span>(字段) 会统计该字段在表中出现的次数，忽略字段为 <span class="keyword">null</span> 的情况。即不统计字段为 <span class="keyword">null</span> 的记录。</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(studentname) <span class="keyword">FROM</span> student;</span><br><span class="line"># <span class="built_in">count</span>(<span class="operator">*</span>) 包括了所有的列，相当于行数，在统计结果的时候，包含字段为 <span class="keyword">null</span> 的记录。</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> student;</span><br><span class="line"># <span class="built_in">count</span>(<span class="number">1</span>) 用 <span class="number">1</span> 代表代码行，在统计结果的时候，包含字段为 <span class="keyword">null</span> 的记录。(推荐使用)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>​		很多人认为 <code>count(1)</code> 执行的效率会比 <code>count(*)</code> 高，原因是后者会存在全表扫描，而 count(1) 可以针对一个字段进行查询。其实二者都会对全表进行扫描，统计所有记录的条数，包括那些为 null 的记录，因此，<code>效率相差无几</code>。而 count(字段) 则与前两者不同，它会统计该字段不为 null 的记录条数。因此在表没有主键时，count(1) 比 count(*) 快，在有主键时，主键作为计算条件，count(主键)统计效率最高，若表格只有一个字段，则 <code>count(*)</code> 效率较高。</p>
</blockquote>
<p>2）<code>sum</code> 函数：返回数字字段或表达式列作统计，返回一列的总和。</p>
<p>3）<code>avg</code> 函数：通常为数值字段或表达列作统计，返回一列的平均值。</p>
<p>4）<code>max</code> 函数：可以为数值字段，字符字段或表达式列作统计，返回最大的值。</p>
<p>5）<code>min</code> 函数：可以为数值字段，字符字段或表达式列作统计，返回最小的值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 总和</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(StudentResult) <span class="keyword">AS</span> &quot;总和&quot; <span class="keyword">FROM</span> <span class="keyword">result</span>;</span><br><span class="line"># 平均值</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(StudentResult) <span class="keyword">AS</span> &quot;平均分&quot; <span class="keyword">FROM</span> <span class="keyword">result</span>;</span><br><span class="line"># 最高值</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span>(StudentResult) <span class="keyword">AS</span> &quot;最高分&quot; <span class="keyword">FROM</span> <span class="keyword">result</span>;</span><br><span class="line"># 最低值</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MIN</span>(StudentResult) <span class="keyword">AS</span> &quot;最低分&quot; <span class="keyword">FROM</span> <span class="keyword">result</span>;</span><br></pre></td></tr></table></figure>

<h2 id="分组过滤方法"><a href="#分组过滤方法" class="headerlink" title="分组过滤方法"></a>分组过滤方法</h2><p><code>[案例]</code>  查询不同课程的平均分，最高分，最低分，此时就需要对课程进行<code>分组统计</code>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> subjectname,<span class="built_in">avg</span>(studentResult) <span class="keyword">as</span> &quot;平均分&quot;,<span class="built_in">max</span>(studentResult) <span class="keyword">as</span> &quot;最高分&quot;,<span class="built_in">min</span>(studentResult) <span class="keyword">as</span> &quot;最低分&quot;</span><br><span class="line"><span class="keyword">from</span> <span class="keyword">result</span> <span class="keyword">as</span> r</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> subject <span class="keyword">as</span> sub</span><br><span class="line"><span class="keyword">on</span> sub.subjectno<span class="operator">=</span>r.subjectno</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> r.subjectno; </span><br></pre></td></tr></table></figure>

<p>​		但是如果加一个要求平均分大于 80 分，就需要对结果再进行过滤。</p>
<blockquote>
<p>where 需要写在 group by 前面，是从数据表中的字段直接进行的筛选的，因此就需要使用 <code>having</code> ，从前面筛选的字段再筛选。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 查询不同课程的平均分,最高分,最低分，同时要求平均分大于 <span class="number">80</span> 分。</span><br><span class="line"><span class="keyword">select</span> subjectname,<span class="built_in">avg</span>(studentResult) <span class="keyword">as</span> &quot;平均分&quot;,<span class="built_in">max</span>(studentResult) <span class="keyword">as</span> &quot;最高分&quot;,<span class="built_in">min</span>(studentResult) <span class="keyword">as</span> &quot;最低分&quot;</span><br><span class="line"><span class="keyword">from</span> <span class="keyword">result</span> <span class="keyword">as</span> r</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> subject <span class="keyword">as</span> sub</span><br><span class="line"><span class="keyword">on</span> sub.subjectno<span class="operator">=</span>r.subjectno</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> r.subjectno</span><br><span class="line"><span class="keyword">having</span> `平均分`<span class="operator">&gt;=</span><span class="number">80</span>;</span><br></pre></td></tr></table></figure>

<h2 id="数据库-MD5"><a href="#数据库-MD5" class="headerlink" title="数据库 MD5"></a>数据库 MD5</h2><p>​		<code>MD5</code> 即 Message-Digest Algorithm 5（信息-摘要算法5），用于确保信息传输完整一致。是计算机广泛使用的杂凑算法之一（又译摘要算法、哈希算法），主流编程语言普遍已有 MD5 实现。将数据（如汉字）运算为另一固定长度值，是杂凑算法的基础原理，MD5 的前身有 MD2、MD3 和 MD4。其主要是为了增强算法复杂度和不可逆性。但 MD 5不可逆，具体的值的 MD5 是一样的，MD5 破解网站的原理，背后有一个字典，利用 MD5 加密后的值查找加密前的值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `testmd5` (</span><br><span class="line"> `id` <span class="type">INT</span>(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"> `name` <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"> `pwd` <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"> <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> testmd5 <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="string">&#x27;zhangsan&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>),(<span class="number">2</span>,<span class="string">&#x27;lisi&#x27;</span>,<span class="string">&#x27;456789&#x27;</span>)，(<span class="number">3</span>,<span class="string">&#x27;wangwu&#x27;</span>,<span class="string">&#x27;456789&#x27;</span>)</span><br><span class="line"></span><br><span class="line"># 对 pwd 这一列数据进行加密</span><br><span class="line"><span class="keyword">update</span> testmd5 <span class="keyword">set</span> pwd <span class="operator">=</span> md5(pwd);</span><br><span class="line"># 单独对某个用户(如gaozheng)的密码在进行加密加密</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> testmd5 <span class="keyword">VALUES</span>(<span class="number">4</span>,<span class="string">&#x27;gaozheng&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>)</span><br><span class="line"><span class="keyword">update</span> testmd5 <span class="keyword">set</span> pwd <span class="operator">=</span> md5(pwd) <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;gaozheng&#x27;</span>;</span><br><span class="line"># 插入新的数据自动加密</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> testmd5 <span class="keyword">VALUES</span>(<span class="number">5</span>,<span class="string">&#x27;gaozheng2&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>)</span><br><span class="line"># 查询登录用户信息（md5对比使用，查看用户输入加密后的密码进行比对）</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> testmd5 <span class="keyword">WHERE</span> `name`<span class="operator">=</span><span class="string">&#x27;gaozheng&#x27;</span> <span class="keyword">AND</span> pwd<span class="operator">=</span>MD5(<span class="string">&#x27;123456&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h1 id="高性能索引"><a href="#高性能索引" class="headerlink" title="高性能索引"></a>高性能索引</h1><p>​		索引（Index）是帮助 MySQL <code>高效获取数据</code>的数据结构，其本质就是数据结构，类似于一本书的目录（线型结构），快速定位到具体的数据。InnoDB 存储引擎支持的索引有：<code>B+树索引</code>、全文索引、哈希索引（内部热点数据的处理），其中比较关键的是 B+树索引。</p>
<p><code>[问题]</code>  哈希索引很高效，为什么 MySQL 主索引不使用哈希索引呢？</p>
<p>1）哈希索引只适合匹配查找，并<code>不适合范围查找</code>。</p>
<p>2）哈希索引的存储方式是<code>没办法排序</code>的。</p>
<p>3）哈希索引本质是一种压缩算法，大数据量下可能会出现<code>哈希冲突</code>，影响性能。</p>
<h2 id="B-树索引"><a href="#B-树索引" class="headerlink" title="B+ 树索引"></a>B+ 树索引</h2><p>​	<code>B+树索引</code>就是传统意义上的索引，这是目前关系型数据库系统中查找最常用和最为有效的索引。B+树是通过二叉查找树（可能严重不平衡），演变为平衡二叉树（数据量大了这个树就会很高，同时维护效率低：插入删除时左旋右旋等），再演变为 <code>B树</code>（就是一步步提高查询的效率）。而 <code>B+ 树就是 B 树</code>（多路搜索树、多叉平衡查找树）的变种。</p>
<p><img src="https://pic1.imgdb.cn/item/633e76d816f2c2beb1941a51.png" alt="image-20220717203821622"></p>
<p>1）B+ 树一个节点下面有多个子节点，并不止两条，因此<code>树的高度会很低</code>。</p>
<p>2）B+ 树的中间节点不存储数据，保存索引和 key 值，<code>真实数据都在叶子节点上</code>。</p>
<p>3）B+ 树的叶子节点还单独另外有指针，相当于<code>叶子节点之间还形成了链表，且还是有序</code>的。</p>
<p>4）B+ 树的插入和删除还是有一定的性能问题，因为为了保持平衡，插入节点就会有节点分裂以及节点提升等等问题（B+ 树数据结构本身的问题），为了解决这些问题实际可以使用<code>旋转</code>的机制，而删除可能涉及到非叶子节点，可能会因为填充因子（50%）会造成叶子节点的合并。</p>
<blockquote>
<p>B+ 树也是一个<code>平衡树</code>，且叶子节点上存储的数据也是有序的，即<code>叶子节点上的数据也是有序的</code>，因此解决了范围查找的问题。</p>
</blockquote>
<p><code>[问题]</code>  为什么索引不适用 B 树，而使用 B+ 树？（<code>一个索引就是一个 B+ 树</code>）</p>
<p>​		B 树和 B+树的最大区别就是，B 树不管叶子节点还是非叶子节点，都会保存数据，这样导致在非叶子节点中能保存的指针数量变少（也称为扇出），指针少的情况下要保存大量数据，只能增加树的高度，导致 IO 操作变多，查询性能变低。</p>
<p><code>[理论]</code>  B+ 树和磁盘的关系（根本原因）。</p>
<p>​		磁盘上数据定位使用一个三维地址唯一标示：<code>柱面号</code>、<code>盘面号</code>、<code>扇区号</code>，这个扇区就是读取文件的最小单元，现在磁盘扇区一般是 512 个字节 或 4k 个字节。那么读&#x2F;写磁盘上某一指定数据需要下面步骤：</p>
<p>1）首先移动臂根据柱面号使磁头移动到所需要的柱面上，这一过程被称为定位或查找。 </p>
<p>2）所有磁头都定位到磁道上后，这时根据盘面号来确定指定盘面上的具体磁道。 （寻道时间）</p>
<p>3） 盘面确定以后，盘片开始旋转，将指定扇区的磁道段移动至磁头下。（旋转延迟）</p>
<p>​		因此可以发现磁盘的读取主要包括三个方面：寻道时间、旋转延迟 和 读取事件，速度会比较慢（9ms），那么为了提高效率，<code>磁盘往往不是严格按需读取</code>，而是每次都会<code>预读</code>，即使只需要一个字节，磁盘也会从这个位置开始，顺序向后读取一定长度的数据放入内存。遵循<code>局部性原理</code>： 当一个数据被用到时，因为程序运行期间所需要的数据通常比较集中，其附近的数据也通常会马上被使用，因此常常会预读。（例如源码中的局部变量就会被优先加载到缓存中）</p>
<p>​		预读的长度一般为<code>页（page）的整倍数</code>。页是计算机管理存储器的逻辑块，页大小通常为 4k 或 16K 的，<code>主存和磁盘以页为单位交换数据</code>。磁盘<code>顺序读取的效率很高</code>（不需要寻道时间，只需很少的旋转时间就可以直接读取），因此具有局部性的数据的读取效率会很高。</p>
<blockquote>
<p>​		当程序要读取的数据不在主存中时，会触发一个<code>缺页异常</code>，此时系统会向磁盘发出读盘信号，磁盘会找到数据的起始位置并向后连续读取一页或几页载入内存中，然后异常返回，程序继续运行。</p>
</blockquote>
<p>​		按照磁盘的这种性质，如果<code>一个页存放一个 B+树的节点</code>，自然是可以存放很多的数据的， InnoDB 里规定 B+树的节点大小是16KB，这就是说，假如一个 Key 是 8 个字节，那么一个节点可以存放大约 1000 个Key（指向子节点的指针），意味着 B+树可以有 1000 个分叉。同时由于 InnoDB 每一次磁盘 I&#x2F;O，读取的都是页 16KB 的整数倍的数据，即 InnoDB 在节点的读写上是可以充分利用<code>磁盘顺序IO</code>的高速读写特性。 同时按照 B+树逻辑结构来说，在叶子节点一层，所有记录的主键按照从小到大的<code>顺序排列</code>，并且形成了一个双向链表。同一层的非叶子节点也互相串联，形成了一个双向链表。那么在实际读写的时候，很大的概率相邻的节点会放在相邻的页上，又可以<code>充分利用磁盘顺序 IO 的高速读写特性</code>。因此<code>对MySQL 优化的一大方向就是尽可能的多让数据顺序读写，少让数据随机读写</code>。</p>
<h2 id="InnoDB-索引"><a href="#InnoDB-索引" class="headerlink" title="InnoDB 索引"></a>InnoDB 索引</h2><p><code>[理论]</code>  聚集索引（聚簇索引），也称为<code>主键索引</code>。</p>
<p>​	主键索引就是将表的主键用来构造一棵 B+ 树，并且将整张表的行记录数据存放在该 B+ 树的<code>叶子节点</code>中。</p>
<p>​		1）叶子节点上包含该记录的所有信息，同时主键连续，读取速度会非常快。</p>
<p>​		2）当没有定义主键时，InnoDB 会创建唯一性的隐含主键：rawId（定义主键后不会存在）。</p>
<p><code>[理论]</code>  辅助索引，也称为<code>二级索引</code>。</p>
<p>​	一般会建立多个索引，这些索引被称为辅助索引或二级索引，但只有一个 B+ 树，<code>叶子节点只存放该字段 和 主键列</code>。</p>
<p>​		1）二级索引列本身是按照 B+ 树的原则排好序的，但这个主键列不会排好序。</p>
<p>​		2）当我们需要根据该索引字段查询记录时，但是节点中只存放了<code>该字段 和 主键</code>，并没有存放完整信息，此时便需要通过里面存放的<code>主键利用主键索引再寻找完整的数据记录</code>，这个过程称作 <code>回表</code>。（通过二级索引查找到完整的一条记录需要用到两个 B+ 树）</p>
<p>​		3）回表的机制意味着回表的记录越少，则查询的性能越高，如果回表次数过高，<code>查询优化器</code>就可能会直接使用全文扫描（有一定的机制进行选择）。</p>
<blockquote>
<p>回表设计原因：如果和 MyISAM 一样在主键索引和辅助索引的叶子节点中都存放数据行指针，一旦数据发生迁移，则需要去重新组织维护所有的索引。</p>
</blockquote>
<p><code>[理论]</code>  联合索引，也称为<code>复合索引</code>。</p>
<p>​	复合索引是将多个字段列组合起来组成索引，那么此时叶子节点中存放的就是<code>对应的几个索引列和主键列</code>。联合索引多个字段也只会建立一个 B+ 树，会<code>根据定义时的字段的前后顺序来进行多步排序</code>，最终结果才是叶子节点的顺序。</p>
<p><code>[理论]</code>  覆盖索引，也称为<code>索引覆盖</code>，是一种<code>行为</code>，并不是一种 InnoDB 索引。覆盖索引的机制指的是从复合索引中就可以得到查询的记录（意思就是需要<code>查询的列都是索引列</code>时，就不需要利用主键列进行回表），而不需要查询聚集索引中的记录。同时由于辅助索引包含字段少，可以增多同一页的节点数，减少 IO 操作。</p>
<p><code>[理论]</code>  自适应哈希索引。</p>
<p>​	InnoDB 存储引擎内部会不停的监控<code>索引热数据</code>（热点索引），然后内部创建一个 hash 索引，称之为<code>自适应哈希索引</code>( Adaptive Hash Index，AHI)，其主要的控制参数有 innodb_adaptive_hash_index 和 innodb_adaptive_hash_index_parts（调整分区个数），基本不能人为干涉此索引，默认处于开启状态。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查看当前 InnoDB 的索引情况，可以查看到内部的 hash <span class="keyword">table</span> 索引情况</span><br><span class="line"><span class="keyword">show</span> engine innodb status \G;</span><br></pre></td></tr></table></figure>

<p><code>[理论]</code>  新版本的 InnoDB 引擎也提供全文检索的索引，只有字段的数据类型为 <code>char、varchar、text 及其系列</code>才可以建全文索引。</p>
<p>​		例如现在需要保存唐宋诗词，如果需要根据标题、作者等等查找诗词很好解决，但是如果需要查找诗词中包含某个字的诗，那么就复杂了，使用全文检索的方式就没有优化的可能性了。那么就考虑可以使用<code>全文索引的倒排索引 Inverted index</code> 来解决这个问题。</p>
<p>​		存入数据时就做好<code>分词</code>，将<code>关键词</code>提取出来，记录每个关键字在每首诗词里面的存在与否的对应关系表。InnoDB 的全文检索的倒排索引使用的并不好，甚至连中文的分词器都没有。</p>
<blockquote>
<p>MySQL 5.6 以前的版本，只有 MyISAM 存储引擎支持全文索引，InnoDB 存储引擎是在之后的版本才支持全文索引。</p>
</blockquote>
<h2 id="索引的使用"><a href="#索引的使用" class="headerlink" title="索引的使用"></a>索引的使用</h2><p><code>[问题]</code> 索引在查询中的作用，以创建表 order_exp 同时添加一个主键索引和两个普通的二级索引和一个联合索引为例说明。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 表 order_exp </span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE ,</span><br><span class="line"><span class="keyword">UNIQUE</span> INDEX `u_ idx_ day_ status` ( `insert_ <span class="type">time</span>`,`order_ status`, `expire_ <span class="type">time</span>` )</span><br><span class="line">INDEX `idx_ order_ <span class="keyword">no</span>` (`order_ <span class="keyword">no</span>`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">INDEX `idx_ expire_ <span class="type">time</span>`(`expire_ <span class="type">time</span>`) <span class="keyword">USING</span> BTREE</span><br></pre></td></tr></table></figure>

<p>1、一个索引就是一个 B+ 树，索引能让查询可以<code>快速定位和扫描</code>到我们需要的数据记录上，加快查询的速度。</p>
<p>2、一个 select 查询语句在执行过程中<code>一般</code>最多只能使用一个二级索引（辅助索引），即使在 where 条件中用了多个二级索引。</p>
<p>​		如果执行 <code>SELECT * FROM order_no = &#39;sss&#39; and expire_time = &#39;xxxx&#39;;</code> ，此时就会有两个 B+ 树可供选择，但只会选择一个 B+ 树进行检索，而具体的选择是 MySQL 根据优化器来进行计算选择。</p>
<p><code>[理论]</code>  扫描区间的概念。（查询优化器时使用到了 扫描区间 的概念）</p>
<p>​		对于一个查询，最简单粗暴的方式是全面扫描，从头扫描到尾，使用 B+ 树就是为了避免全文扫描，而实际上就是使某个查询能够只在某个区间进行扫描。例如对于查询 <code>SELECT * FROM order_exp WHERE id &gt;= 3 AND id&lt;= 99;</code>，如果没有这个 where 条件，MySQL 就只能一条条记录扫描，但是当有了 where 限制条件后，就能通过主键索引从 id &#x3D; 3 出开始扫描，直到扫描到 id &gt; 99 时（叶子节点都是顺序的），就表示扫描完了，此种方式就是将扫描区间缩小到了 [3, 99]。</p>
<p>​		再通过查询 <code>SELECT * FROM order_exp WHERE id in(3,9) OR (id&gt;=23 AND id&lt;= 99);</code>，其扫描区间就有三个 [3, 3]，[9, 9]，[23, 99]，前两者被称为单点扫描区间，后面一个是范围扫描区间。<code>in</code> 里面的每个数据都会被视作一个单点扫描区间。再执行查询 <code>SELECT * FROM order_exp WHERE order_no &lt;&#39;DD00_10S&#39; AND expire _time &gt; &#39;2021-03-22 18:28:28&#39; AND order_note &gt; &#39;7排&#39;;</code> 语句时，因为一个查询中最多只能使用一个二级索引检索，此时 MySQL 就只会选择 order_no 或 expire _time 来作为扫描索引，因此只有一个扫描区间。</p>
<p><code>[理论]</code>  范围区间扫描的概念：对于 B+树索引来说，只要索引列和常数使用 &#x3D;、&lt;&#x3D;&gt;、IN、NOT IN、IS NULL、IS NOT NULL、&gt;、&lt;、&gt;&#x3D;、&lt;&#x3D;、BETWEEN、!&#x3D;&lt;&gt; 或 LIKE 等操作符连接起来，就可以产生一个扫描区间。in 操作符产生的是单点扫描区间，!&#x3D; 产生的扫描区间几近全局区间，like 关键字只有在匹配完整的字符串或者匹配字符串前缀时才产生合适的扫描区间（字符串按照字典排序）。</p>
<p>​		MySQL 优化器会根据几个索引的范围区间进行成本计算，来选择最高效的检索索引，也就是说有些条件并不一定会用上。</p>
<p><code>[问题]</code>  日常的工作中，一个查询的 WHERE 子句可能有很多个小的搜索条件，这些搜索条件需要使用 AND 或者 OR 操作符连接起来，那么怎么从由 AND或 OR 组成的<code>复杂搜索条件中提取出正确的范围区间</code>，判断能不能使用索引呢？</p>
<p>1）针对执行 <code>SELECT * FROM order_exp WHERE order_no &gt; &#39;DD00_6S&#39; AND order_no &gt; &#39;DD00_9S&#39;;</code> 语句，这个搜索条件是能够使用索引的。</p>
<p>2）针对执行 <code>SELECT * FROM order_exp WHERE order_no &gt; &#39;DD00_6S&#39; or order_no &gt; &#39;DD00_9S&#39;;</code> 语句，这个搜索条件也是能够使用索引的。</p>
<p>3）针对执行 <code>SELECT * FROM order_exp WHERE expire_time&gt; &#39;2021-03-22 18:35:09&#39; AND order_note = &#39;abc&#39;;</code> 语句，这个搜索条件的扫描范围是由 expire_time 决定的，因为 order_note 并没有建立索引。</p>
<p>4）针对执行 <code>SELECT * FROM order_exp WHERE expire_time&gt; &#39;2021-03-22 18:35:09&#39; OR order_note = &#39;abc&#39;;</code> 语句，使用 OR 来连接，但因为 order_note 不是索引，因此这个 expire_time 索引实际上是用不上的，还是必须全局扫描。（索引失效）</p>
<p><code>[案例]</code>  针对下面的复杂的搜索条件，怎么判断扫描范围呢？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> (order_no <span class="operator">&gt;</span> <span class="string">&#x27;DD00_9S&#x27;</span> <span class="keyword">AND</span> expire_time <span class="operator">=</span> <span class="string">&#x27;2021-03-22 18:35:09&#x27;</span> ) <span class="keyword">OR</span> (order_no <span class="operator">&lt;</span> <span class="string">&#x27;DD00_6S&#x27;</span> <span class="keyword">AND</span> order_no <span class="operator">&gt;</span> <span class="string">&#x27;DD00_10S&#x27;</span>) <span class="keyword">OR</span> (order_no <span class="keyword">LIKE</span> <span class="string">&#x27;%0S&#x27;</span> <span class="keyword">AND</span> order_no <span class="operator">&gt;</span> <span class="string">&#x27;DD00_12S&#x27;</span> <span class="keyword">AND</span> (expire_time <span class="operator">&lt;</span> <span class="string">&#x27;2021-03-22 18:28:28&#x27;</span> <span class="keyword">OR</span> order_note <span class="operator">=</span> <span class="string">&#x27;abc&#x27;</span>)) ;</span><br></pre></td></tr></table></figure>

<p>​		where 条件中涉及 order_no 和 expire_time 有索引，order_note 是没有索引的。</p>
<p>1）假设使用 order_no 作为索引检索，可以将其他的搜索条件都变成 true 考虑：(<code>like % 在前面则不能用作索引</code>)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> (order_no <span class="operator">&gt;</span> <span class="string">&#x27;DD00_9S&#x27;</span> <span class="keyword">AND</span> <span class="literal">true</span>) <span class="keyword">OR</span> (order_no <span class="operator">&lt;</span> <span class="string">&#x27;DD00_6S&#x27;</span> <span class="keyword">AND</span> order_no <span class="operator">&gt;</span> <span class="string">&#x27;DD00_10S&#x27;</span>) <span class="keyword">OR</span> (<span class="literal">true</span> <span class="keyword">AND</span> order_no <span class="operator">&gt;</span> <span class="string">&#x27;DD00_12S&#x27;</span> <span class="keyword">AND</span> (<span class="literal">true</span> <span class="keyword">OR</span> <span class="literal">true</span>)) ;</span><br><span class="line"># 根据 <span class="keyword">and</span> 和 <span class="keyword">or</span> 的计算规则进而化简为</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> order_no <span class="operator">&gt;</span> <span class="string">&#x27;DD00_9S&#x27;</span>  <span class="keyword">OR</span> (order_no <span class="operator">&lt;</span> <span class="string">&#x27;DD00_6S&#x27;</span> <span class="keyword">AND</span> order_no <span class="operator">&gt;</span> <span class="string">&#x27;DD00_10S&#x27;</span>) <span class="keyword">OR</span> order_no <span class="operator">&gt;</span> <span class="string">&#x27;DD00_12S&#x27;</span> ;</span><br><span class="line"># 有的条件恒为 <span class="literal">true</span> 或 <span class="literal">false</span> 时也能化简</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> order_no <span class="operator">&gt;</span> <span class="string">&#x27;DD00_9S&#x27;</span> <span class="keyword">or</span> <span class="literal">false</span> <span class="keyword">OR</span> order_no <span class="operator">&gt;</span> <span class="string">&#x27;DD00_12S&#x27;</span> ;</span><br><span class="line"># 再根据 <span class="keyword">or</span> 的计算规则化简</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> order_no <span class="operator">&gt;</span> <span class="string">&#x27;DD00_9S&#x27;</span> <span class="keyword">OR</span> order_no <span class="operator">&gt;</span> <span class="string">&#x27;DD00_12S&#x27;</span> ;</span><br></pre></td></tr></table></figure>

<p>​		因此此时的查询区间就是 [DD00_12S，+∞ ]，但是 MySQL 的优化器还是会重新评估的。</p>
<p>1）假设使用 expire_time 作为索引检索，可以将其他的搜索条件都变成 true 考虑：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> (<span class="literal">true</span> <span class="keyword">AND</span> expire_time <span class="operator">=</span> <span class="string">&#x27;2021-03-22 18:35:09&#x27;</span> ) <span class="keyword">OR</span> (<span class="literal">true</span> <span class="keyword">AND</span> <span class="literal">true</span>) <span class="keyword">OR</span> (<span class="literal">true</span> <span class="keyword">AND</span> <span class="literal">true</span> <span class="keyword">AND</span> (expire_time <span class="operator">&lt;</span> <span class="string">&#x27;2021-03-22 18:28:28&#x27;</span> <span class="keyword">OR</span> <span class="literal">true</span>)) ;</span><br><span class="line">#  根据 <span class="keyword">and</span> 和 <span class="keyword">or</span> 的计算规则进而化简为</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> expire_time <span class="operator">=</span> <span class="string">&#x27;2021-03-22 18:35:09&#x27;</span> <span class="keyword">OR</span> <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<p>​		因此此时如果使用索引，查询区间就是单点区间，同时由于后面条件恒成立，那么还需要根据找到的记录再回表查询所有信息，还不如直接使用全表扫描，因此 MySQL 是不可能使用 expire_time 作为索引进行扫描的。</p>
<p>上面这个 SQL 语句，执行全表扫描的代价大概是 2169，用 order_no 索引的代价大概是 6211，所以实际执行的时候，MySQL 会选择全表扫描。（<code>成本分析</code>）</p>
<p><code>[理论]</code>  联合索引执行查询时对应的扫描区间分析。</p>
<p>​		例如上面定义的 <code>u_ idx_ day_ status</code> 这个联合主键，MySQL 会先根据 insert_time 排序，再将排序结果相等时按照 order_status 排序，再如果还是相等则按照 expire_time 进行排序，才得到最终的 B+ 树的叶子节点的排序顺序。</p>
<p>1）会定位满足这个条件的第一条记录，向后扫描找到扫描区间，找到所有的记录再进行回表。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> insert_time <span class="operator">=</span> <span class="string">&#x27;2021-03-22 18:34:55&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>2）先根据 insert_time 确定扫描区间，再在扫描区间内找到 order_status 的扫描区间，找到所有的记录再进行回表。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> insert_time <span class="operator">=</span> <span class="string">&#x27;2021-03-22 18:34:55&#x27;</span> <span class="keyword">AND</span> order_status <span class="operator">=</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>3）先找到第一条满足这个条件的，再往前扫描找到扫描区间，找到所有的记录再进行回表。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> insert_time <span class="operator">&lt;</span> <span class="string">&#x27;2021-03-22 18:34:55&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>4）此种情况是不能得到扫描区间的，因为会现根据 insert_time 排序，order_status 的排列不一定有序，因此并不能作为扫描区间的确定条件。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp  <span class="keyword">WHERE</span> order_status <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>5）可以作为扫描区间查找，但是 expire_time 条件在扫描区间的确定上是用不上的，因为并不一定有序。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> insert_time <span class="operator">=</span> <span class="string">&#x27;2021-03-22 18:34:55&#x27;</span> <span class="keyword">AND</span> expire_time <span class="operator">=</span> <span class="string">&#x27;2021-03-22 18:35:12&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>6）可以作为扫描区间查找，但是 order_status 条件在扫描区间的确定上是用不上的，因为并不一定有序。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> insert_time <span class="operator">&lt;</span> <span class="string">&#x27;2021-03-22 18:34:57&#x27;</span> <span class="keyword">AND</span> order_status <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h2 id="MyISAM索引"><a href="#MyISAM索引" class="headerlink" title="MyISAM索引"></a>MyISAM索引</h2><p><code>[理论]</code>  MyISAM 索引底层也是 B+ 树实现，但索引和数据是分开放的，数据记录没有分页，就是顺序放下来（也就是直接统一往数据文件塞）。索引信息则单独放在 <code>myisam.MYI</code> 文件，存储时不仅<code>存储索引值</code>，还会存在这条记录在文件里面的<code>行号</code>，因此使用 MyISAM 存储引擎进行查找时是通过索引找到这条记录在数据文件中的行号，再对应找到数据记录。也就是说 MyISAM 引擎中，只要是索引则<code>全部都是相当于二级索引</code>，只要是查询则全部都是需要回表。</p>
<h2 id="索引创建策略"><a href="#索引创建策略" class="headerlink" title="索引创建策略"></a>索引创建策略</h2><p>1）查看索引。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> 表名 \G;</span><br></pre></td></tr></table></figure>

<p>2）创建修改索引。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> TALBE 表名 (</span><br><span class="line">	各种列的信息 ··· ,</span><br><span class="line">	[KEY<span class="operator">|</span>INDEX] 索引名 (需要被索引的单个列或多个列)</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"># 已经创建表后添加索引</span><br><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">UNIQUE</span> <span class="operator">|</span> FULLTEXT <span class="operator">|</span> SPATIAL] INDEX 索引名 <span class="keyword">ON</span> 表名(columnname(length));</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">ADD</span> [<span class="keyword">UNIQUE</span> <span class="operator">|</span> FULLTEXT <span class="operator">|</span> SPATIAL] INDEX [indexName] <span class="keyword">ON</span> (字段名[(长度)]</span><br></pre></td></tr></table></figure>

<p>3）删除索引。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 删除索引</span><br><span class="line"><span class="keyword">DROP</span> INDEX 索引名 <span class="keyword">ON</span> 表名;</span><br><span class="line"># 删除主键索引</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">DROP</span> <span class="keyword">PRIMARY</span> KEY;</span><br></pre></td></tr></table></figure>

<p><code>[理论]</code>  索引有一定的好处，但同时也有一定的<code>代价</code>（空间和时间代价）。</p>
<p>1）空间代价：每一个索引都会创建一个 B+ 树，每个节点都是一个数据页（16K）。</p>
<p>2）时间代价：增删改查时 B+ 树中的数据很可能需要调整。</p>
<p><code>[总结]</code>  高性能索引创建的策略。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># EXPLAIN : 分析<span class="keyword">SQL</span>语句执行性能和状况</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student；	# 非全文索引</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> studentno<span class="operator">=</span><span class="string">&#x27;1000&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 使用全文索引</span><br><span class="line"># 全文搜索通过 <span class="keyword">MATCH</span>() 函数完成。</span><br><span class="line"># 搜索字符串作为 against() 的参数被给定。搜索以忽略字母大小写的方式执行。对于表中的每个记录行，<span class="keyword">MATCH</span>() 返回一个相关性值。即，在搜索字符串与记录行在 <span class="keyword">MATCH</span>() 列表中指定的列的文本之间的相似性尺度。</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span><span class="keyword">FROM</span> student <span class="keyword">WHERE</span> <span class="keyword">MATCH</span>(studentname) AGAINST(<span class="string">&#x27;love&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>1）数据类型越小，在查询时进行的比较操作越快，同时占用空间代价越小，一个数据页放下的记录越多，从而减少磁盘 I&#x2F;O 带来的性能损耗，也就意味着可以把更多的数据页缓存在内存中，从而加快读写效率。</p>
<p>2）需要根据索引的 <code>“选择性/离散型”</code> 来选择索引。例如某表四个字段为姓名、年龄、性别、区号，则就应该选择姓名来作为索引，性别就是最差的。</p>
<blockquote>
<p>选择性（离散型）：不重复的记录条数和总记录条数的比值，最好的就是 1，表示完全无重复。（因为离散型高的说明扫描区间小）</p>
</blockquote>
<p>​		要计算某数据列的离散性就可以使用 distinct 关键字：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> order_no)<span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> cnt <span class="keyword">from</span> order_exp;</span><br></pre></td></tr></table></figure>

<p>3）有时候会使用字符串来做索引，但可能这个字符串很长，那么就可以使用 <code>模拟哈希索引</code> 或者 <code>前缀索引</code>。</p>
<blockquote>
<p>​	<code>模拟哈希索引</code>：就是将该很长的字段算出一个 hash 值，存入另一个字段列中，马么就使用这个新的字段作为索引。但是这种方法需要重新维护一列字段，同时可能还会发生哈希冲突的问题，同时也很难支持范围查找。</p>
</blockquote>
<p>​		<code>前缀索引</code>也就是只索引该字段的开始部分字符，可以大大节约索引空间，从而提高索引效率，但也会降低索引的离散性。那么如何选择索引的长度呢？</p>
<p>​	可以使用 sql 语句确定该字段使用不同长度值作为索引的离散型，从而判断：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">LEFT</span>(order_note,<span class="number">3</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> sel3 <span class="keyword">from</span> order_exp;	# 查询三个字符的离散型</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">LEFT</span>(order_note,<span class="number">4</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> sel4 <span class="keyword">from</span> order_exp;	# 查询四个字符的离散型</span><br></pre></td></tr></table></figure>

<p>​	经过判断，例如14个字符的离散性比较好，同时又比较短，因此选择此字段的 14 个字符长度作为索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> order_exp <span class="keyword">add</span> key(order_note(<span class="number">14</span>));</span><br></pre></td></tr></table></figure>

<p>​	例如使用当表中有邮箱字段时，需要查询所有 ‘@qq.com’ 的为后缀的邮箱，如果直接使用 <code>like &#39;%@qq.com&#39;</code> 那么便不会使用索引查询，因此可以考虑使用反向的查询，但是 MySQL 并不支持反向查询，因此可以在业务处理逻辑中反向，或者在数据库中反转再存储，再建立<code>前缀索引</code>进行查询。</p>
<p>4）只为分组、排序或分组的列创建索引：只为出现在 where 子句中的列、连接子句中的连接列创建索引，而出现在查询结果列表中的列一般就没必要建立索引，除非是需要使用覆盖索引，又或者为出现在 ORDER BY 或 GROUP BY 子句中的列创建索引，但是需要注意顺序。</p>
<p>​		例如 <code>SELECT * FROM order_exp ORDER BY insert_time, order_status,expire_time;</code>  结果检索出来就直接是排好序的，就不需要额外的排序。group by 也是类似的情况，都是直接查询出来就是顺序的或是分好组的。</p>
<p>5）多列索引（联合索引）如何选择合适的索引创建顺序呢？</p>
<p>​		一般将<code>选择性最高的列</code>放到索引最前列（也需要注意业务的使用），同时需要根据那些运行频率最高的查询来调整索引列的顺序（再创建一个新的联合索引），因此在优化性能的时候可能需要使用相同的列但顺序不同的索引来满足不同类型的查询需求。</p>
<p>6）设计针对<code>查询的三星索引</code>，表示一个索引设计的好坏可以由三颗星来评价，实践中主要是满足两颗星即可。（针对查询）</p>
<p>​	一星：索引将相关的记录放到一起。（物理上的记录相邻则扫描的范围小，就可以利用顺序读的特点提高查询效率）</p>
<p>​	二星（排序星）：索引中的数据顺序和查找中的排列顺序一致。（也就是充分利用索引判断是否是顺序匹配）</p>
<p>​	三星（宽索引星）：索引中的列包含了查询中需要的全部列，这是最重要的，因为回表会导致<code>过多的随机读</code>。（就是索引覆盖：不需要回表）</p>
<p><code>[案例]</code> 创建 customer 表，针对具体的查询语句，判断当前创建的索引是否达到三星索引标准。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> customer(</span><br><span class="line">    cno <span class="type">int</span>,</span><br><span class="line">    lname <span class="type">varchar</span>(<span class="number">10</span>),</span><br><span class="line">    fname <span class="type">varchar</span>(<span class="number">10</span>),</span><br><span class="line">    sex <span class="type">int</span>,</span><br><span class="line">    weight <span class="type">int</span>,</span><br><span class="line">    city <span class="type">varchar</span>(<span class="number">10</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> index idx_cust <span class="keyword">on</span> customer(city,lname,fname,cno); # 联合索引</span><br></pre></td></tr></table></figure>

<p>​	对于查询语句 <code>select cno,fname from customer where lname =’xx’ and city =’yy’ order by fname;</code> 而言，现在创建的索引就是三星索引。因为前面两个 &#x3D; 条件可以将搜索范围缩的很窄（一星），同时由于前面条件成立时， fname 排列就是有序的（二星），cno 和 fname 都在索引中（三星）。</p>
<p><code>[案例]</code> 创建 test 表，针对具体的查询语句，判断当前创建的索引是否达到三星索引标准。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `test` (</span><br><span class="line">      `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">      `user_name` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">      `sex` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">      `age` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">      `c_date` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">      <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  ) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">12</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line">  </span><br><span class="line">  # <span class="keyword">sql</span> 语句：<span class="keyword">select</span> user_name,sex,age <span class="keyword">from</span> test <span class="keyword">where</span> user_name <span class="keyword">like</span> <span class="string">&#x27;test%&#x27;</span> <span class="keyword">and</span> sex <span class="operator">=</span><span class="number">1</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> age</span><br></pre></td></tr></table></figure>

<p>​		如果创建索引为（user_name，sex，age）不满足二星，因为无法保证 user_name 范围匹配的结果下 age 是一定有序的。</p>
<p>​		如果创建索引为（sex，user_name，age）不满足一星，因为 sex 的选择性过差。</p>
<p>7）<code>设立主键</code>时应该使用很少改变的列，少 update 操作，行是按照聚集索引物理排序的，如果主键频繁改变，物理顺序会改变，性能会急剧降低。</p>
<p>8）不要产生冗余和重复的索引。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 创建了三个索引都是 ID，重复索引</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test (</span><br><span class="line">    ID <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    A <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    B <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">UNIQUE</span>(ID),</span><br><span class="line">    INDEX(ID)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br><span class="line"></span><br><span class="line"># 如果创建索引 index(A, B) 和 index(A) 呢？	还是重复索引，因为index(A,B)已经将 A 顺序排列了一次，index(A)又来顺序排列了一次</span><br><span class="line"># 如果创建索引 index(B, A) 和 index(A) 呢？	那么就不是重复索引</span><br><span class="line"># 如果创建索引 index(A) 和 index(A，ID) 呢？	重复索引，因为二级索引本身就存储了索引列和主键列，index(A) 本身就包含了 ID 列</span><br></pre></td></tr></table></figure>

<p>9）不要创建未使用的索引（可以统计索引的使用频率）。</p>
<h1 id="权限管理和备份"><a href="#权限管理和备份" class="headerlink" title="权限管理和备份"></a>权限管理和备份</h1><h2 id="用户权限管理"><a href="#用户权限管理" class="headerlink" title="用户权限管理"></a>用户权限管理</h2><p>​		用户信息表：mysql.user，实际就是操作这个表。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"># 刷新权限</span><br><span class="line">FLUSH PRIVILEGES</span><br><span class="line"></span><br><span class="line"># 增加用户并设置密码</span><br><span class="line"># 语法：<span class="keyword">CREATE</span> <span class="keyword">USER</span> 用户名 IDENTIFIED <span class="keyword">BY</span> [PASSWORD] 密码(字符串)</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> gaozheng IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span></span><br><span class="line"># 注意事项：</span><br><span class="line"># 必须拥有mysql数据库的全局<span class="keyword">CREATE</span> <span class="keyword">USER</span>权限，或拥有<span class="keyword">INSERT</span>权限。</span><br><span class="line"># 只能创建用户，不能赋予权限。</span><br><span class="line"># 用户名，注意引号：如 <span class="string">&#x27;user_name&#x27;</span>@<span class="string">&#x27;192.168.1.1&#x27;</span></span><br><span class="line"># 密码也需引号，纯数字密码也要加引号</span><br><span class="line"># 要在纯文本中指定密码，需忽略PASSWORD关键词。要把密码指定为由 PASSWORD() 函数返回的混编值，需包含关键字PASSWORD</span><br><span class="line"></span><br><span class="line"># 重命名用户 </span><br><span class="line"># 语法：RENAME <span class="keyword">USER</span> old_user <span class="keyword">TO</span> new_user</span><br><span class="line">RENAME <span class="keyword">USER</span> gaozheng <span class="keyword">TO</span> gaozheng2</span><br><span class="line"></span><br><span class="line"># 设置（修改）密码</span><br><span class="line"><span class="keyword">SET</span> PASSWORD <span class="operator">=</span> PASSWORD(<span class="string">&#x27;密码&#x27;</span>)    # 为当前用户设置密码</span><br><span class="line"><span class="keyword">SET</span> PASSWORD <span class="keyword">FOR</span> 用户名 <span class="operator">=</span> PASSWORD(<span class="string">&#x27;密码&#x27;</span>)   # 为指定用户设置密码</span><br><span class="line"></span><br><span class="line"># 删除用户 </span><br><span class="line"># 语法：<span class="keyword">DROP</span> <span class="keyword">USER</span> 用户名</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> gaozheng2</span><br><span class="line"></span><br><span class="line"># 分配权限<span class="operator">/</span>添加用户</span><br><span class="line"># 语法：<span class="keyword">GRANT</span> 权限列表 <span class="keyword">ON</span> 表名 <span class="keyword">TO</span> 用户名 [IDENTIFIED <span class="keyword">BY</span> [PASSWORD] <span class="string">&#x27;password&#x27;</span>]</span><br><span class="line"># <span class="keyword">all</span> privileges 表示所有权限，除了给别的用户授权</span><br><span class="line"># <span class="operator">*</span>.<span class="operator">*</span> 表示所有库的所有表，库名.表名 表示某库下面的某表</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> privileges <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">to</span> gaozheng</span><br><span class="line"># 注意：这个用户拥有所有的权限，但是不能给别的用户授权。</span><br><span class="line"></span><br><span class="line"># 查看权限  </span><br><span class="line"># 语法：<span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> 用户名</span><br><span class="line"># 查看 root 权限</span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> root<span class="variable">@localhost</span>;</span><br><span class="line"># 查看指定用户权限</span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> gaozheng</span><br><span class="line"></span><br><span class="line"># 撤消权限</span><br><span class="line"># 语法：<span class="keyword">REVOKE</span> 权限列表 <span class="keyword">ON</span> 表名 <span class="keyword">FROM</span> 用户名</span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">FROM</span> 用户名    # 撤销所有权限</span><br></pre></td></tr></table></figure>

<p>权限解释：了解即可</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 权限列表</span></span><br><span class="line"><span class="keyword">ALL</span> [PRIVILEGES]    <span class="comment">-- 设置除GRANT OPTION之外的所有简单权限</span></span><br><span class="line"><span class="keyword">ALTER</span>    <span class="comment">-- 允许使用ALTER TABLE</span></span><br><span class="line"><span class="keyword">ALTER</span> ROUTINE    <span class="comment">-- 更改或取消已存储的子程序</span></span><br><span class="line"><span class="keyword">CREATE</span>    <span class="comment">-- 允许使用CREATE TABLE</span></span><br><span class="line"><span class="keyword">CREATE</span> ROUTINE    <span class="comment">-- 创建已存储的子程序</span></span><br><span class="line"><span class="keyword">CREATE</span> TEMPORARY TABLES        <span class="comment">-- 允许使用CREATE TEMPORARY TABLE</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span>        <span class="comment">-- 允许使用CREATE USER, DROP USER, RENAME USER和REVOKE ALL PRIVILEGES。</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span>        <span class="comment">-- 允许使用CREATE VIEW</span></span><br><span class="line"><span class="keyword">DELETE</span>    <span class="comment">-- 允许使用DELETE</span></span><br><span class="line"><span class="keyword">DROP</span>    <span class="comment">-- 允许使用DROP TABLE</span></span><br><span class="line"><span class="keyword">EXECUTE</span>        <span class="comment">-- 允许用户运行已存储的子程序</span></span><br><span class="line">FILE    <span class="comment">-- 允许使用SELECT...INTO OUTFILE和LOAD DATA INFILE</span></span><br><span class="line">INDEX     <span class="comment">-- 允许使用CREATE INDEX和DROP INDEX</span></span><br><span class="line"><span class="keyword">INSERT</span>    <span class="comment">-- 允许使用INSERT</span></span><br><span class="line">LOCK TABLES        <span class="comment">-- 允许对您拥有SELECT权限的表使用LOCK TABLES</span></span><br><span class="line">PROCESS     <span class="comment">-- 允许使用SHOW FULL PROCESSLIST</span></span><br><span class="line"><span class="keyword">REFERENCES</span>    <span class="comment">-- 未被实施</span></span><br><span class="line">RELOAD    <span class="comment">-- 允许使用FLUSH</span></span><br><span class="line">REPLICATION CLIENT    <span class="comment">-- 允许用户询问从属服务器或主服务器的地址</span></span><br><span class="line">REPLICATION SLAVE    <span class="comment">-- 用于复制型从属服务器（从主服务器中读取二进制日志事件）</span></span><br><span class="line"><span class="keyword">SELECT</span>    <span class="comment">-- 允许使用SELECT</span></span><br><span class="line"><span class="keyword">SHOW</span> DATABASES    <span class="comment">-- 显示所有数据库</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VIEW</span>    <span class="comment">-- 允许使用SHOW CREATE VIEW</span></span><br><span class="line">SHUTDOWN    <span class="comment">-- 允许使用mysqladmin shutdown</span></span><br><span class="line">SUPER    <span class="comment">-- 允许使用CHANGE MASTER, KILL, PURGE MASTER LOGS和SET GLOBAL语句，mysqladmin debug命令；允许您连接（一次），即使已达到max_connections。</span></span><br><span class="line"><span class="keyword">UPDATE</span>    <span class="comment">-- 允许使用UPDATE</span></span><br><span class="line">USAGE    <span class="comment">-- “无权限”的同义词</span></span><br><span class="line"><span class="keyword">GRANT</span> OPTION    <span class="comment">-- 允许授予权限</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 表维护 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 分析和存储表的关键字分布</span></span><br><span class="line">ANALYZE [<span class="keyword">LOCAL</span> <span class="operator">|</span> NO_WRITE_TO_BINLOG] <span class="keyword">TABLE</span> 表名 ...</span><br><span class="line"><span class="comment">-- 检查一个或多个表是否有错误</span></span><br><span class="line"><span class="keyword">CHECK</span> <span class="keyword">TABLE</span> tbl_name [, tbl_name] ... [option] ...</span><br><span class="line">option <span class="operator">=</span> &#123;QUICK <span class="operator">|</span> FAST <span class="operator">|</span> MEDIUM <span class="operator">|</span> EXTENDED <span class="operator">|</span> CHANGED&#125;</span><br><span class="line"><span class="comment">-- 整理数据文件的碎片</span></span><br><span class="line">OPTIMIZE [<span class="keyword">LOCAL</span> <span class="operator">|</span> NO_WRITE_TO_BINLOG] <span class="keyword">TABLE</span> tbl_name [, tbl_name] ...</span><br></pre></td></tr></table></figure>

<h2 id="MySQL备份"><a href="#MySQL备份" class="headerlink" title="MySQL备份"></a>MySQL备份</h2><p>数据库备份必要性：保证重要数据不丢失，同时进行数据转移，一般用于<code>容灾</code>。</p>
<p>MySQL数据库备份方法</p>
<p>1）直接拷贝物理文件：data 文件。</p>
<p>2）数据库可视化工具中手动导出：在想要导出的表或者库中右键，选择备份或者导出。</p>
<p>3）使用命令行导出：mysqldump，可以将将数据转移到另一个SQL服务器，不一定是MySQL服务器。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导出一张表</span></span><br><span class="line"><span class="comment"># mysqldump -h主机 -u用户名 -p密码 数据库 表名 &gt;物理磁盘位置/文件名</span></span><br><span class="line">mysqldump -hlocalhost -uroot -p123456 school student &gt;D:/a.sql</span><br><span class="line"><span class="comment"># 导出多张表</span></span><br><span class="line"><span class="comment"># mysqldump -h主机 -u用户名 -p密码 数据库 表1 表2 表3 &gt;物理磁盘位置/文件名</span></span><br><span class="line">mysqldump -hlocalhost -uroot -p123456 school student grand &gt;D:/a.sql</span><br><span class="line"><span class="comment"># 导出一个库</span></span><br><span class="line"><span class="comment"># mysqldump -h主机 -u用户名 -p密码 数据库&gt;物理磁盘位置/文件名</span></span><br><span class="line">mysqldump -hlocalhost -uroot -p123456 school&gt;D:/a.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入过程：</span></span><br><span class="line"><span class="comment"># 登陆的情况下，切换到指定的数据库(尽量登录)</span></span><br><span class="line"><span class="comment"># sources 备份文件</span></span><br><span class="line"><span class="built_in">source</span> D:/a.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在不登录的情况下</span></span><br><span class="line"><span class="comment"># mysql -u用户名 -p密码 库名 &lt; 备份文件</span></span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://localhost:4000">moon</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://localhost:4000/2022/06/20/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8A%80%E6%9C%AF/MySQL%20%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/">http://localhost:4000/2022/06/20/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8A%80%E6%9C%AF/MySQL%20%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://localhost:4000" target="_blank">月の子豚小屋</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><div class="post_share"><div class="social-share" data-image="https://w.wallhaven.cc/full/k7/wallhaven-k7m65d.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/06/08/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%AD%E9%97%B4%E4%BB%B6/ElasticSearch%20%E5%9F%BA%E7%A1%80/"><img class="prev-cover" src="https://w.wallhaven.cc/full/z8/wallhaven-z81qyy.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Elastic Search 简述</div></div></a></div><div class="next-post pull-right"><a href="/2022/10/05/%E9%A1%B9%E7%9B%AE%E7%BB%83%E4%B9%A0/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D/"><img class="next-cover" src="https://w.wallhaven.cc/full/m9/wallhaven-m9873y.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">谷粒商城-项目介绍</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/03/02/Java%20%E6%A1%86%E6%9E%B6/MybatisPlus%20%E5%9F%BA%E7%A1%80/" title="Mybatis-Plus 简单使用"><img class="cover" src="https://w.wallhaven.cc/full/wq/wallhaven-wqplxr.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-02</div><div class="title">Mybatis-Plus 简单使用</div></div></a></div><div><a href="/2021/02/21/Java%20%E6%A1%86%E6%9E%B6/Mybatis%20%E5%9F%BA%E7%A1%80/" title="Mybatis 使用初探"><img class="cover" src="https://w.wallhaven.cc/full/8o/wallhaven-8o2d8k.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-21</div><div class="title">Mybatis 使用初探</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://pic1.imgdb.cn/item/6337ca6e16f2c2beb17d8731.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">moon</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">36</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">16</div></a></div><a id="card-info-btn"><i class="fab fa-github"></i><span>月の子豚小屋</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="/xxx" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/1963885633@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/1963885633" target="_blank" title="QQ"><i class="fa-sharp fa-solid fa-ghost"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">月の子豚小屋</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9D%E8%AF%86-MySQL"><span class="toc-number">1.</span> <span class="toc-text">初识 MySQL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1"><span class="toc-number">2.</span> <span class="toc-text">数据库事务</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1"><span class="toc-number">3.</span> <span class="toc-text">数据库设计</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-number">4.</span> <span class="toc-text">数据库操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%93%E8%A1%A8%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">4.1.</span> <span class="toc-text">库表基本操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DML%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">4.2.</span> <span class="toc-text">DML基本操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DQL%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">4.3.</span> <span class="toc-text">DQL基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.3.1.</span> <span class="toc-text">基本查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.3.2.</span> <span class="toc-text">条件查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%94%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.3.3.</span> <span class="toc-text">联表查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%8E%92%E5%BA%8F"><span class="toc-number">4.3.4.</span> <span class="toc-text">分页排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E5%8F%A5%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.3.5.</span> <span class="toc-text">子句查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%96%E9%94%AE%E6%A6%82%E8%BF%B0"><span class="toc-number">5.</span> <span class="toc-text">外键概述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%87%BD%E6%95%B0"><span class="toc-number">6.</span> <span class="toc-text">基本函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0"><span class="toc-number">6.1.</span> <span class="toc-text">基本处理函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E9%98%B6%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">6.2.</span> <span class="toc-text">进阶聚合函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E8%BF%87%E6%BB%A4%E6%96%B9%E6%B3%95"><span class="toc-number">6.3.</span> <span class="toc-text">分组过滤方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93-MD5"><span class="toc-number">6.4.</span> <span class="toc-text">数据库 MD5</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%AB%98%E6%80%A7%E8%83%BD%E7%B4%A2%E5%BC%95"><span class="toc-number">7.</span> <span class="toc-text">高性能索引</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#B-%E6%A0%91%E7%B4%A2%E5%BC%95"><span class="toc-number">7.1.</span> <span class="toc-text">B+ 树索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#InnoDB-%E7%B4%A2%E5%BC%95"><span class="toc-number">7.2.</span> <span class="toc-text">InnoDB 索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">7.3.</span> <span class="toc-text">索引的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MyISAM%E7%B4%A2%E5%BC%95"><span class="toc-number">7.4.</span> <span class="toc-text">MyISAM索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%88%9B%E5%BB%BA%E7%AD%96%E7%95%A5"><span class="toc-number">7.5.</span> <span class="toc-text">索引创建策略</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E5%92%8C%E5%A4%87%E4%BB%BD"><span class="toc-number">8.</span> <span class="toc-text">权限管理和备份</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-number">8.1.</span> <span class="toc-text">用户权限管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E5%A4%87%E4%BB%BD"><span class="toc-number">8.2.</span> <span class="toc-text">MySQL备份</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/11/06/%E9%A1%B9%E7%9B%AE%E7%BB%83%E4%B9%A0/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%AE%A2%E5%8D%95%E6%9C%8D%E5%8A%A1/" title="谷粒商城-订单服务实现"><img src="https://w.wallhaven.cc/full/m9/wallhaven-m9873y.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="谷粒商城-订单服务实现"/></a><div class="content"><a class="title" href="/2022/11/06/%E9%A1%B9%E7%9B%AE%E7%BB%83%E4%B9%A0/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%AE%A2%E5%8D%95%E6%9C%8D%E5%8A%A1/" title="谷粒商城-订单服务实现">谷粒商城-订单服务实现</a><time datetime="2022-11-06T14:42:44.735Z" title="发表于 2022-11-06 22:42:44">2022-11-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/03/%E9%A1%B9%E7%9B%AE%E7%BB%83%E4%B9%A0/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0/" title="谷粒商城-购物车逻辑实现"><img src="https://w.wallhaven.cc/full/m9/wallhaven-m9873y.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="谷粒商城-购物车逻辑实现"/></a><div class="content"><a class="title" href="/2022/11/03/%E9%A1%B9%E7%9B%AE%E7%BB%83%E4%B9%A0/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0/" title="谷粒商城-购物车逻辑实现">谷粒商城-购物车逻辑实现</a><time datetime="2022-11-03T07:19:16.711Z" title="发表于 2022-11-03 15:19:16">2022-11-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/30/%E9%A1%B9%E7%9B%AE%E7%BB%83%E4%B9%A0/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81%E5%A4%84%E7%90%86/" title="谷粒商城-用户认证处理"><img src="https://w.wallhaven.cc/full/m9/wallhaven-m9873y.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="谷粒商城-用户认证处理"/></a><div class="content"><a class="title" href="/2022/10/30/%E9%A1%B9%E7%9B%AE%E7%BB%83%E4%B9%A0/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81%E5%A4%84%E7%90%86/" title="谷粒商城-用户认证处理">谷粒商城-用户认证处理</a><time datetime="2022-10-30T02:15:21.954Z" title="发表于 2022-10-30 10:15:21">2022-10-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/28/%E9%A1%B9%E7%9B%AE%E7%BB%83%E4%B9%A0/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E7%94%A8%E6%88%B7%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E5%A4%84%E7%90%86/" title="谷粒商城-用户商品详情处理"><img src="https://w.wallhaven.cc/full/m9/wallhaven-m9873y.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="谷粒商城-用户商品详情处理"/></a><div class="content"><a class="title" href="/2022/10/28/%E9%A1%B9%E7%9B%AE%E7%BB%83%E4%B9%A0/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E7%94%A8%E6%88%B7%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E5%A4%84%E7%90%86/" title="谷粒商城-用户商品详情处理">谷粒商城-用户商品详情处理</a><time datetime="2022-10-28T08:39:51.722Z" title="发表于 2022-10-28 16:39:51">2022-10-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/24/%E9%A1%B9%E7%9B%AE%E7%BB%83%E4%B9%A0/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E6%90%9C%E7%B4%A2%E4%B8%9A%E5%8A%A1%E5%A4%84%E7%90%86/" title="谷粒商城-用户搜索业务处理"><img src="https://w.wallhaven.cc/full/m9/wallhaven-m9873y.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="谷粒商城-用户搜索业务处理"/></a><div class="content"><a class="title" href="/2022/10/24/%E9%A1%B9%E7%9B%AE%E7%BB%83%E4%B9%A0/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E6%90%9C%E7%B4%A2%E4%B8%9A%E5%8A%A1%E5%A4%84%E7%90%86/" title="谷粒商城-用户搜索业务处理">谷粒商城-用户搜索业务处理</a><time datetime="2022-10-24T14:24:27.926Z" title="发表于 2022-10-24 22:24:27">2022-10-24</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://w.wallhaven.cc/full/k7/wallhaven-k7m65d.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By moon</div><div class="footer_custom_text">Hi, welcome to <a href="">月の子豚小屋</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'W7dceLXrUuiCITXy8cfM3sQ5-gzGzoHsz',
      appKey: 'Cu1minmiIoZRLGrJNxHnhZgn',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><div class="aplayer no-destroy" data-id="60198" data-server="netease" data-type="playlist" data-mini="true" data-fixed="true" data-autoplay="true"> </div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="true"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>