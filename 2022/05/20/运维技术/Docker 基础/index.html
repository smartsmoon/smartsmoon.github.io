<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Docker 的基本使用 | 月の子豚小窝</title><meta name="keywords" content="Docker"><meta name="author" content="月の子豚小窝"><meta name="copyright" content="月の子豚小窝"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="主要讲述 Docker、Docker0、Docker compose 的基本使用">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker 的基本使用">
<meta property="og:url" content="http://localhost:4000/2022/05/20/%E8%BF%90%E7%BB%B4%E6%8A%80%E6%9C%AF/Docker%20%E5%9F%BA%E7%A1%80/index.html">
<meta property="og:site_name" content="月の子豚小窝">
<meta property="og:description" content="主要讲述 Docker、Docker0、Docker compose 的基本使用">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://w.wallhaven.cc/full/e7/wallhaven-e7dy9w.jpg">
<meta property="article:published_time" content="2022-05-19T16:00:00.000Z">
<meta property="article:modified_time" content="2022-11-12T13:49:59.086Z">
<meta property="article:author" content="月の子豚小窝">
<meta property="article:tag" content="Docker">
<meta property="article:tag" content="项目部署">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://w.wallhaven.cc/full/e7/wallhaven-e7dy9w.jpg"><link rel="shortcut icon" href="https://pic.imgdb.cn/item/637afbc616f2c2beb1d6ef3b.png"><link rel="canonical" href="http://localhost:4000/2022/05/20/%E8%BF%90%E7%BB%B4%E6%8A%80%E6%9C%AF/Docker%20%E5%9F%BA%E7%A1%80/"><link rel="preconnect" href="//fastly.jsdelivr.net"/><link rel="preconnect" href="//cdn.dusays.com"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"简","msgToSimplifiedChinese":"繁"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"距离上次更新已经过了","messageNext":"天，文章所描述的內容可能已经发生变化，请留意"},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 月の子豚小窝","link":"链接: ","source":"来源: 月の子豚小窝","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-right"},
  source: {
    justifiedGallery: {
      js: 'https://cdn1.tianli0.top/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn1.tianli0.top/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Docker 的基本使用',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-12 21:49:59'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="shenma-site-verification" content="df2d187adea46639af5b16a59246a655_1658299306"><meta name="bytedance-verification-code" content="Sgu9oIPNU2jM5Z2P4Dv7" /><link rel="stylesheet" href="/css/styles.css"><link id="css" rel="stylesheet" href="/css/stylessimple.css"><link rel="stylesheet" href="https://cdn1.tianli0.top/gh/LYXOfficial/LYXOfficial.github.io/css/iconfont.css"><style>#article-container h1:before, h2:before, h3:before, h4:before, h5:before, h6:before { -webkit-animation: avatar_turn_around 3s linear infinite; -moz-animation: avatar_turn_around 3s linear infinite; -o-animation: avatar_turn_around 3s linear infinite; -ms-animation: avatar_turn_around 3s linear infinite; animation: avatar_turn_around 3s linear infinite; }</style><style id="barragesColor"></style><style id="settingStyle"></style><style id="yjjs"></style><style id="themeColor"></style><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+SC"><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/swiper/swiper-bundle.min.css"><link rel="stylesheet" href="https://cdn1.tianli0.top/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC"><link rel="stylesheet" type="text/css" href="https://cdn1.tianli0.top/npm/node-snackbar@latest/dist/snackbar.min.css" /><script src="/swReg.js"></script><span id="fps"></span><link rel="stylesheet" href="/css/fixed_comment.css"  media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/aplayer.css"><link rel="stylesheet" href="/css/player.css"><link rel="stylesheet" href="/css/essay.css"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper-anzhiyu@1.0.4/lib/swiper.min.css"><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="/css/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/css/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><link rel="stylesheet" href="https://unpkg.zhimg.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-newspaper"></i><span> 文章</span><!--i.fas.fa-chevron-down--></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 隧道</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-chart-bar"></i><span> 博客</span><!--i.fas.fa-chevron-down--></a><ul class="menus_item_child"><li><a class="site-page child" href="/charts/"><i class="fa-fw fas fa-chart-area"></i><span> 文章统计</span></a></li><li><a class="site-page child" href="/census/"><i class="fa-fw fas fa-chart-line"></i><span> 博客统计</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-sitemap"></i><span> 空间</span><!--i.fas.fa-chevron-down--></a><ul class="menus_item_child"><li><a class="site-page child" href="/speaks/"><i class="fa-fw fa fa-comments"></i><span> 说说</span></a></li><li><a class="site-page child" href="/essay/"><i class="fa-fw fa fa-bell"></i><span> 哔哔</span></a></li><li><a class="site-page child" href="/fcircle/"><i class="fa-fw fab fa-galactic-republic"></i><span> 朋友圈</span></a></li><li><a class="site-page child" href="/barrage/"><i class="fa-fw fa fa-blackboard"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-sitemap"></i><span> 娱乐</span><!--i.fas.fa-chevron-down--></a><ul class="menus_item_child"><li><a class="site-page child" href="/musiccentor/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/muyu/"><i class="fa-fw fa-fw fa-solid fa-fish"></i><span> 木鱼</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-fw fas fa-address-card"></i><span> 我的</span><!--i.fas.fa-chevron-down--></a><ul class="menus_item_child"><li><a class="site-page child" href="/tools/"><i class="fa-fw fa-fw fas fa-tools"></i><span> 宝藏网站</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-info-circle"></i><span> 关于我</span></a></li><li><a class="site-page child" href="/license/"><i class="fa-fw fas fa-balance-scale"></i><span> 版权声明</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://w.wallhaven.cc/full/e7/wallhaven-e7dy9w.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">月の子豚小窝</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-newspaper"></i><span> 文章</span><!--i.fas.fa-chevron-down--></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 隧道</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-chart-bar"></i><span> 博客</span><!--i.fas.fa-chevron-down--></a><ul class="menus_item_child"><li><a class="site-page child" href="/charts/"><i class="fa-fw fas fa-chart-area"></i><span> 文章统计</span></a></li><li><a class="site-page child" href="/census/"><i class="fa-fw fas fa-chart-line"></i><span> 博客统计</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-sitemap"></i><span> 空间</span><!--i.fas.fa-chevron-down--></a><ul class="menus_item_child"><li><a class="site-page child" href="/speaks/"><i class="fa-fw fa fa-comments"></i><span> 说说</span></a></li><li><a class="site-page child" href="/essay/"><i class="fa-fw fa fa-bell"></i><span> 哔哔</span></a></li><li><a class="site-page child" href="/fcircle/"><i class="fa-fw fab fa-galactic-republic"></i><span> 朋友圈</span></a></li><li><a class="site-page child" href="/barrage/"><i class="fa-fw fa fa-blackboard"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-sitemap"></i><span> 娱乐</span><!--i.fas.fa-chevron-down--></a><ul class="menus_item_child"><li><a class="site-page child" href="/musiccentor/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/muyu/"><i class="fa-fw fa-fw fa-solid fa-fish"></i><span> 木鱼</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-fw fas fa-address-card"></i><span> 我的</span><!--i.fas.fa-chevron-down--></a><ul class="menus_item_child"><li><a class="site-page child" href="/tools/"><i class="fa-fw fa-fw fas fa-tools"></i><span> 宝藏网站</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-info-circle"></i><span> 关于我</span></a></li><li><a class="site-page child" href="/license/"><i class="fa-fw fas fa-balance-scale"></i><span> 版权声明</span></a></li></ul></div></div><center id="name-container"><a id="page-name" href="javascript:rmf.scrollToTop()">PAGE_NAME</a></center></div><div id="toggleButtons"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><!--span=' '+_p('search.title')--></a></div><div id="randoms"><a class="site-page social-icon" href="javascript:toRandomPost()"><i class="fa fa-paper-plane"></i></a></div><a class="icon-V hidden" onclick="switchNightMode()" title="浅色和深色模式转换"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Docker 的基本使用</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-05-19T16:00:00.000Z" title="发表于 2022-05-20 00:00:00">2022-05-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-12T13:49:59.086Z" title="更新于 2022-11-12 21:49:59">2022-11-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%BF%90%E7%BB%B4%E6%8A%80%E6%9C%AF/">运维技术</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">21.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>95分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title="Docker 的基本使用"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="twikoo_visitors"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2022/05/20/%E8%BF%90%E7%BB%B4%E6%8A%80%E6%9C%AF/Docker%20%E5%9F%BA%E7%A1%80/#post-comment"><span id="twikoo-count"></span></a></span><span class="post-meta-separator">|&nbsp <span class="post-meta-dianzan"><a class="dianzan" href="javascript:void(0)" onclick="dianzan()"><i class="fas fa-thumbs-up"></i></a><span class="post-meta-label"> 点赞:</span><span class="dianzan-count">0</span></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Docker-概述"><a href="#Docker-概述" class="headerlink" title="Docker 概述"></a>Docker 概述</h1><h2 id="Docker-来由"><a href="#Docker-来由" class="headerlink" title="Docker 来由"></a>Docker 来由</h2><p>​		Docker 为什么会出现呢？</p>
<p>一个系统，需要经历：<code>开发 到 上线</code>，起码需要两套<code>环境</code>，同时还需要<code>配置</code>。</p>
<p>这个时候就<code>开发和运维</code>之间可能出现一个问题：开发人员在自己电脑上可以运行，但是运维人员却运行不了，为什么呢？如何解决呢？&#x3D;&#x3D;&#x3D;&gt; <code>开发学运维</code>。</p>
<p>​		举例：一个项目环境： jar + (Redis MySQL JDK ES 等) </p>
<p>1、以前的部署方式：</p>
<p>​		每一个机器都要部署环境(集群Redis、ES、Hadoop…)，费事费力，开发负责开发 jar 包，运维负责项目运行部署，同时不能跨平台。</p>
<p>2、现在使用 <code>docker</code> 部署：<code>项目带上环境</code>进行部署，开发打包部署上线。</p>
<p>​		docker流程：jar 包（环境） — 打包项目带上环境（镜像） — ( Docker仓库：商店）—— 下载我们发布的镜像 — 直接运行</p>
<p>​		Docker的思想就来自于<code>集装箱</code>。核心思想：<code>隔离</code></p>
<p><code>隔离</code>：将应用打包装箱，每个箱子是互相隔离的，通过隔离机制，可以<code>将服务器利用到极致</code>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic1.imgdb.cn/item/63369ced16f2c2beb16ba63e.png"></p>
<h2 id="Docker-历史"><a href="#Docker-历史" class="headerlink" title="Docker 历史"></a>Docker 历史</h2><p>​		dotcloud 公司开发，最初是做一些 pass 的云计算服务（LXC 容器化技术），后来将容器化技术命名为 <code>docker</code> ，同时进行<code>开源</code>（Go 语言）。</p>
<p>在容器化技术出来之前，使用虚拟机技术（笨重），虚拟机也属于虚拟化技术，Docker 容器技术，也是一种<code>虚拟化技术</code>，但是 docker 确能做到<code>轻巧</code>。</p>
<blockquote>
<p>Docker 官网：<code>https://www.docker.com/</code>。</p>
<p>官方仓库：<code>https://hub.docker.com/</code>，用于搜寻镜像。</p>
</blockquote>
<h2 id="Docker-作用"><a href="#Docker-作用" class="headerlink" title="Docker 作用"></a>Docker 作用</h2><p>虚拟化技术比较：比较Docker和虚拟机技术的不同。</p>
<p>1）传统虚拟机，虚拟出一套硬件，运行一个完整的操作系统，然后在这个系统上安装和运行软件。</p>
<p>2）<code>容器化技术</code>（Docker），容器内的应用<code>直接运行在宿主机的内核</code>之上，容器是没有自己的内核的，也没有虚拟我们的硬件，非常轻便。但<code>每个容器间是互相隔离</code>，每个容器内都有一个属于自己的文件系统，互不影响。<code>极大利用宿主机的资源</code></p>
<p><code>问题</code>：那么，Docker 为什么比 VM 快？</p>
<p>​		Dokcer 有着比虚拟机更少的<code>抽象层</code>。由于 docker 不需要 Hypervisor 实现硬件资源虚拟化，运行在 docker 容器上的程序直接使用的都是实际物理机的硬件资源。因此在CPU、内存利用率上 docker 将会在效率上有明显优势。</p>
<p>​		同时，docker 利用的是宿主机的内核，vm 需要是 Guest OS（就是 centos 操作系统）。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20210719100837873.png" alt="在这里插入图片描述"></p>
<h2 id="DevOps"><a href="#DevOps" class="headerlink" title="DevOps"></a>DevOps</h2><p>​		<code>DevOps</code>：开发和运维。</p>
<p>四个特点：</p>
<p>1）应用更快速的交付和部署。传统是通过一堆帮助文档来安装程序，而 Docker 则是打包镜像发布测试一键运行。</p>
<p>2）更便捷的升级和扩缩容。Docker 部署应用就和搭积木一样，项目打包为一个镜像，服务器A性能不够，直接在服务器B 上运行一套。</p>
<p>3）更简单的系统运维。在容器化之后，我们的开发，测试环境都是高度一致的，不会出现运行不一致情况。</p>
<p>4）更高效的计算资源利用。Docker是<code>内核级别的虚拟化</code>，可以在一个物理机上可以运行很多的容器实例，服务器的性能可以被压榨到极致。</p>
<h2 id="Docker-架构"><a href="#Docker-架构" class="headerlink" title="Docker 架构"></a>Docker 架构</h2><p>​		Docker 架构图：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20210112223441225.png" alt="在这里插入图片描述"></p>
<p>1）<code>镜像（image)</code>：就像 <code>模板</code>，通过模板来创建容器，通过这个镜像可以创建多个容器。</p>
<p>​		举例：Tomcat 镜像 &#x3D;&#x3D;&gt; run &#x3D;&#x3D;&gt; 容器（Tomcat01、Tomcat02）（最终服务运行或者项目运行就是在容器中的）</p>
<p>2）<code>容器(container)</code>：Docker 利用容器技术，独立运行一个或者一组应用，通过镜像来创建的。（可以把这个容器理解为就是一个简易的 Linux 系统）</p>
<p>3）<code>仓库(repository)</code>：存放镜像的地方。仓库分为公有仓库和私有仓库。Docker Hub是国外的，需要配置镜像加速。</p>
<h2 id="HelloDocker-原理"><a href="#HelloDocker-原理" class="headerlink" title="HelloDocker 原理"></a>HelloDocker 原理</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/2021071908571839.png" alt="在这里插入图片描述"></p>
<p><code>Docker 底层原理</code>：</p>
<p>​		Docker 是一个 <code>Client-Server 结构</code>的系统，Docker 的守护进程运行在主机上。通过 Socket 从客户端访问，Docker-Server 接收到 Docker-Client 的指令，就会执行这个命令。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20210719092624997.png" alt="在这里插入图片描述"></p>
<h1 id="Docker-使用"><a href="#Docker-使用" class="headerlink" title="Docker 使用"></a>Docker 使用</h1><h2 id="帮助信息命令"><a href="#帮助信息命令" class="headerlink" title="帮助信息命令"></a>帮助信息命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker version 		 # 显示 docker 的版本信息。</span><br><span class="line">docker info 		 # 显示 docker 的系统信息，包括镜像和容器的数量。</span><br><span class="line">docker 命令 --help    # 帮助命令（万能命令）</span><br></pre></td></tr></table></figure>

<p>命令帮助文档地址：<code>https://docs.docker.com/engine/reference/commandline/docker/</code>。</p>
<h2 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h2><p>1、<code>docker images</code> 查看所有本地主机上的镜像。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ nginx]# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">hello-world   latest    feb5d9fea6a5   8 months ago   13.3kB</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">REPOSITORY	镜像的仓库源</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">TAG	镜像的标签（版本）</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">IMAGE ID	镜像的 ID</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">CREATED	镜像的创建时间</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">SIZE	镜像的大小</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-a，-all 	# 表示列出所有的镜像。</span><br><span class="line">-f，-quiet	# 表示只显示镜像的 ID。</span><br></pre></td></tr></table></figure>

<p>2、<code>docker search</code> 搜索镜像。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ nginx]# docker search mysql</span><br><span class="line">NAME                           DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">mysql                          MySQL is a widely used, open-source relation…   12687     [OK]       </span><br><span class="line">mariadb                        MariaDB Server is a high performing open sou…   4864      [OK]       </span><br><span class="line">percona                        Percona Server is a fork of the MySQL relati…   579       [OK]       </span><br><span class="line">phpmyadmin                     phpMyAdmin - A web interface for MySQL and M…   550       [OK]       </span><br><span class="line">bitnami/mysql                  Bitnami MySQL Docker Image                      71                   [OK]</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-f		# 根据条件过滤搜索结果</span><br><span class="line">docker search mysql -f=stars=3000		# 搜索收藏数为 3000 以上的 mysql 镜像</span><br></pre></td></tr></table></figure>

<p>3、<code>docker pull</code> 拉取下载镜像。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker pull 镜像名[:tag] 	拉取指定版本 tag 的镜像，如果不写 tag，默认拉取最新的</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ nginx]# docker pull mysql</span><br><span class="line">Using default tag: latest		# 不写 tag 表示拉取最新版本</span><br><span class="line">latest: Pulling from library/mysql		# 下面是分层下载的过程</span><br><span class="line">c1ad9731b2c7: Pull complete </span><br><span class="line">54f6eb0ee84d: Pull complete </span><br><span class="line">cffcf8691bc5: Pull complete </span><br><span class="line">89a783b5ac8a: Pull complete </span><br><span class="line">6a8393c7be5f: Pull complete </span><br><span class="line">af768d0b181e: Pull complete </span><br><span class="line">810d6aaaf54a: Pull complete </span><br><span class="line">2e014a8ae4c9: Pull complete </span><br><span class="line">a821425a3341: Pull complete </span><br><span class="line">3a10c2652132: Pull complete </span><br><span class="line">4419638feac4: Pull complete </span><br><span class="line">681aeed97dfe: Pull complete </span><br><span class="line">Digest: sha256:548da4c67fd8a71908f17c308b8ddb098acf5191d3d7694e56801c6a8b2072cc		# 签名，防伪标志</span><br><span class="line">Status: Downloaded newer image for mysql:latest		</span><br><span class="line">docker.io/library/mysql:latest		# 真实地址</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker pull mysql 等价于：docker pull docker.io/library/mysql:latest</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拉取指定版本的 mysql（必须在dockerhub 存在的）</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ nginx]# docker pull mysql:5.7</span><br><span class="line">5.7: Pulling from library/mysql</span><br><span class="line">c1ad9731b2c7: Already exists </span><br><span class="line">54f6eb0ee84d: Already exists </span><br><span class="line">cffcf8691bc5: Already exists </span><br><span class="line">89a783b5ac8a: Already exists </span><br><span class="line">6a8393c7be5f: Already exists </span><br><span class="line">af768d0b181e: Already exists </span><br><span class="line">810d6aaaf54a: Already exists </span><br><span class="line">81fe6daf2395: Pull complete </span><br><span class="line">5ccf426818fd: Pull complete </span><br><span class="line">68b838b06054: Pull complete </span><br><span class="line">1b606c4f93df: Pull complete </span><br><span class="line">Digest: sha256:7e99b2b8d5bca914ef31059858210f57b009c40375d647f0d4d65ecd01d6b1d5</span><br><span class="line">Status: Downloaded newer image for mysql:5.7</span><br><span class="line">docker.io/library/mysql:5.7</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">根据上面的下载过程就体现了 分层下载的优势：已经存在的包就不用下载了</span></span><br></pre></td></tr></table></figure>

<p>4、<code>docker rmi</code> 删除镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">根据镜像名称删</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ nginx]# docker rmi mysql:5.7</span><br><span class="line">Untagged: mysql:5.7</span><br><span class="line">Untagged: mysql@sha256:7e99b2b8d5bca914ef31059858210f57b009c40375d647f0d4d65ecd01d6b1d5</span><br><span class="line">Deleted: sha256:2a0961b7de03c7b11afd13fec09d0d30992b6e0b4f947a4aba4273723778ed95</span><br><span class="line">Deleted: sha256:2fbd454d39f146da1c0747174089b983c1cf1da7a062384e5a71a94f540141ab</span><br><span class="line">Deleted: sha256:60ce6f6a8d71e66bd7ca1dae1f84a5faedfb993c1a0f352b90597b73eb94d56e</span><br><span class="line">Deleted: sha256:226a653f6ee6b0184d7a6304f29976dc89b0e54e2eec2027d0e3cf87cbe8f2af</span><br><span class="line">Deleted: sha256:218468cc1e9e25a831221617115da837798856793eb7decb3b089c8a1b5bd98f</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">根据镜像 ID 删</span></span><br><span class="line">docker rmi feb5d9fea6a5</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除多个镜像</span></span><br><span class="line">docker rmi 镜像id 镜像id 镜像id 镜像id</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除全部镜像</span></span><br><span class="line">docker rmi -f $(docker images -aq)</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-f		# 参数表示强制删除，就算该镜像有容器在运行</span><br></pre></td></tr></table></figure>

<p>可以根据 <code>镜像名称</code> 删，也可以根据<code>镜像 ID</code> 删除。</p>
<h2 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h2><p>​		<code>有了镜像才可以创建容器</code>。以 下载一个 centos 镜像为案例。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos</span><br></pre></td></tr></table></figure>

<p>1、<code>docker run [-options] image</code> 创建容器并启动，并设置参数。</p>
<p>1）基本命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker run [-options] image</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">常用参数选项</span></span><br><span class="line">--name		# 指定启动后容器的名称，例如 tomcat01，用来区分具体的容器</span><br><span class="line">-d			# 以后台方式运行，类似于之前的 nohup</span><br><span class="line">-it			# 使用交互方式运行，进入容器查看内容</span><br><span class="line">-p			# 指定容器的端口</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">几种方式：</span></span><br><span class="line">	-p ip：主机端口：容器端口</span><br><span class="line">	-p 主机端口:容器端口（最常用）</span><br><span class="line">	-p 容器端口</span><br><span class="line">	容器端口</span><br><span class="line">	</span><br><span class="line">-P			# 随机指定端口</span><br></pre></td></tr></table></figure>

<p>测试使用：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动并进入容器</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker run -it centos /bin/bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">此时发现 root 后面的主机名变成了镜像名</span> </span><br><span class="line">[root@da547f060a6b /]# </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看容器内的 centos</span></span><br><span class="line">[root@da547f060a6b /]# ls</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">从容器中退回主机，并停止容器</span></span><br><span class="line">[root@da547f060a6b /]# exit</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>

<p>2、<code>docker ps</code> 列出所有运行的容器。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED             STATUS                         PORTS     NAMES</span><br><span class="line">da547f060a6b   centos    &quot;/bin/bash&quot;   About an hour ago   Exited (0) About an hour ago             frosty_banzai</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">常用参数选项</span></span><br><span class="line">无参数		# 列出当前正在运行的容器</span><br><span class="line">-a		  # 列出所有容器</span><br><span class="line">-n=m	  # 显示最近 m 个容器</span><br><span class="line">-q		  # 只显示容器 ID</span><br></pre></td></tr></table></figure>

<p>3、<code>docker rm</code> 删除容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除指定容器，不能删除正在运行的容器</span></span><br><span class="line">docker rm 容器ID</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除所有容器</span></span><br><span class="line">docker rm -f $(docker ps -aq)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除所有容器</span></span><br><span class="line">docker ps -a -q | xargs docker rm</span><br></pre></td></tr></table></figure>

<p>4、退出容器命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">从容器中退回主机，并停止容器</span></span><br><span class="line">exit</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">从容器中退回主机，不停止容器</span></span><br><span class="line">ctrl + p + q</span><br></pre></td></tr></table></figure>

<p>5、启动和停止容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动容器</span></span><br><span class="line">docker start 容器ID</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启容器</span></span><br><span class="line">docker restart 容器ID</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">停止容器</span></span><br><span class="line">docker stop 容器ID</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">强制停止容器</span></span><br><span class="line">docker kill 容器ID</span><br></pre></td></tr></table></figure>

<h2 id="进阶命令"><a href="#进阶命令" class="headerlink" title="进阶命令"></a>进阶命令</h2><p>1、后台启动容器，不直接进去：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d centos</span><br></pre></td></tr></table></figure>

<p>​		此命令启动容器，发现启动的 centos 自动停止了，为什么呢？</p>
<blockquote>
<p>常见的坑：docker 后台启动的话，就必须要有一个前台进程，docker 发现没有前台应用，就会自动停止。</p>
<p>例如 nginx，容器启动后发现自己没有提供服务，就会立刻停止 “自杀”。</p>
</blockquote>
<p>2、查看日志</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker logs -tf [--tail numbers] 容器ID</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注意：该容器需要是启动状态</span></span><br><span class="line">-tf		# 显示带时间戳的日志</span><br><span class="line">--tail numbers	# 要显示的日志条数</span><br></pre></td></tr></table></figure>

<p>一般情况查看日志：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs -f 容器ID</span><br></pre></td></tr></table></figure>

<p>3、查看容器中的进程信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker top 容器ID</span><br><span class="line"></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker top b44b5d08542e</span><br><span class="line">UID     PID       PPID     C      STIME               TTY                 TIME                CMD</span><br><span class="line">root   3679834   3679814   0      19:44               pts/0               00:00:00            /bin/bash</span><br></pre></td></tr></table></figure>

<p>4、查看镜像的元数据（<code>里面的配置后面会用到</code>）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect 容器ID</span><br></pre></td></tr></table></figure>

<h2 id="容器进阶操作"><a href="#容器进阶操作" class="headerlink" title="容器进阶操作"></a><code>容器进阶操作</code></h2><p>1、进入当前正在运行的容器：（<code>通常容器都是使用后台方式运行的，需要进入容器，修改一些配置</code>）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it 容器id bashShell</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-it 表示交互模式</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">bashshell 表示使用的命令行，一般使用 /bin/bash</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">方式一：进入后开启新的终端（常用）</span></span><br><span class="line">docker exec -it 容器id /bin/bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">方式二：进入容器正在执行的终端</span></span><br><span class="line">docker attach 容器id</span><br></pre></td></tr></table></figure>

<p>2、容器内文件拷贝到容器外主机上：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp 容器id:容器内路径   目的的主机路径</span><br></pre></td></tr></table></figure>

<p>测试使用：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# cd /home</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看主机文件</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ home]# cd gaozheng</span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ gaozheng]# ls</span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ gaozheng]# ls</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看当前运行的容器</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ gaozheng]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED             STATUS             PORTS     NAMES</span><br><span class="line">b44b5d08542e   centos    &quot;/bin/bash&quot;   About an hour ago   Up About an hour             optimistic_banzai</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入容器</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ gaozheng]# docker exec -it b44b5d08542e /bin/bash</span><br><span class="line">[root@b44b5d08542e /]# ls</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">[root@b44b5d08542e /]# cd /home</span><br><span class="line">[root@b44b5d08542e home]# ls</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建测试文件</span></span><br><span class="line">[root@b44b5d08542e home]# touch test.java</span><br><span class="line">[root@b44b5d08542e home]# ls</span><br><span class="line">test.java</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">退出容器</span></span><br><span class="line">[root@b44b5d08542e home]# exit</span><br><span class="line">exit</span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ gaozheng]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED             STATUS             PORTS     NAMES</span><br><span class="line">b44b5d08542e   centos    &quot;/bin/bash&quot;   About an hour ago   Up About an hour             optimistic_banzai</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拷贝容器内文件到容器外主机上</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ gaozheng]# docker cp b44b5d08542e:/home/test.java /home/gaozheng</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看结果：拷贝成功</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ gaozheng]# ls</span><br><span class="line">test.java</span><br></pre></td></tr></table></figure>

<h2 id="命令汇总"><a href="#命令汇总" class="headerlink" title="命令汇总"></a>命令汇总</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20210720092439814.png" alt="在这里插入图片描述"></p>
<p>命令汇总：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">attach    Attach to a running container                                  #当前shell下attach连接指定运行镜像</span><br><span class="line">build     Build an image from a Dockerfile                               #通过Dockerfile定制镜像</span><br><span class="line">commit    Create a new image from a containers changes                   #提交当前容器为新的镜像</span><br><span class="line">cp          Copy files/folders from a container to a HOSTDIR or to STDOUT  #从容器中拷贝指定文件或者目录到宿主机中</span><br><span class="line">create    Create a new container                                         #创建一个新的容器，同run 但不启动容器</span><br><span class="line">diff      Inspect changes on a containers filesystem                     #查看docker容器变化</span><br><span class="line">events    Get real time events from the server                           #从docker服务获取容器实时事件</span><br><span class="line">exec      Run a command in a running container                           #在已存在的容器上运行命令</span><br><span class="line">export    Export a containers filesystem as a tar archive                #导出容器的内容流作为一个tar归档文件(对应import)</span><br><span class="line">history   Show the history of an image                                   #展示一个镜像形成历史</span><br><span class="line">images    List images                                                    #列出系统当前镜像</span><br><span class="line">import    Import the contents from a tarball to create a filesystem image  #从tar包中的内容创建一个新的文件系统映像(对应export)</span><br><span class="line">info      Display system-wide information                                #显示系统相关信息</span><br><span class="line">inspect   Return low-level information on a container or image           #查看容器详细信息</span><br><span class="line">kill      Kill a running container                                       #kill指定docker容器</span><br><span class="line">load      Load an image from a tar archive or STDIN                      #从一个tar包中加载一个镜像(对应save)</span><br><span class="line">login     Register or log in to a Docker registry                        #注册或者登陆一个docker源服务器</span><br><span class="line">logout    Log out from a Docker registry                                 # 从当前Docker registry退出</span><br><span class="line">logs      Fetch the logs of a container                                  # 输出当前容器日志信息</span><br><span class="line">pause     Pause all processes within a container                         # 暂停容器</span><br><span class="line">port      List port mappings or a specific mapping for the CONTAINER     #查看映射端口对应的容器内部源端口</span><br><span class="line">ps        List containers                                                #列出容器列表</span><br><span class="line">pull      Pull an image or a repository from a registry                  #从docker镜像源服务器拉取指定镜像或者库镜像</span><br><span class="line">push      Push an image or a repository to a registry                    #推送指定镜像或者库镜像至docker源服务器</span><br><span class="line">rename    Rename a container                                             #重命名容器</span><br><span class="line">restart   Restart a running container                                    #重启运行的容器</span><br><span class="line">rm        Remove one or more containers                                  #移除一个或者多个容器</span><br><span class="line">rmi       Remove one or more images                                      #移除一个或多个镜像(无容器使用该镜像才可以删除，否则需要删除相关容器才可以继续或者-f强制删除)</span><br><span class="line">run       Run a command in a new container                               #创建一个新的容器并运行一个命令</span><br><span class="line">save      Save an image(s) to a tar archive                              #保存一个镜像为一个tar包(对应load)</span><br><span class="line">search    Search the Docker Hub for images                               #在docker hub中搜索镜像</span><br><span class="line">start     Start one or more stopped containers                           #启动容器</span><br><span class="line">stats     Display a live stream of container(s) resource usage statistics  #统计容器使用资源</span><br><span class="line">stop      Stop a running container                                       #停止容器</span><br><span class="line">tag       Tag an image into a repository                                 #给源中镜像打标签</span><br><span class="line">top       Display the running processes of a container                   #查看容器中运行的进程信息</span><br><span class="line">unpause   Unpause all processes within a container                       #取消暂停容器</span><br><span class="line">version   Show the Docker version information                            #查看容器版本号</span><br><span class="line">wait      Block until a container stops, then print its exit code        #截取容器停止时的退出状态值</span><br></pre></td></tr></table></figure>

<h2 id="端口暴露问题"><a href="#端口暴露问题" class="headerlink" title="端口暴露问题"></a>端口暴露问题</h2><p>​		某些服务中（nginx），容器内的端口需要映射到容器外的端口上，如何映射呢？通过设置 <code>-p</code> 参数，那流程又是什么呢？</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/2021072014364032.png" alt="在这里插入图片描述"></p>
<p>​		例如启动 nginx 容器时，设置端口映射：<code> -p 3344:80</code> ，则将容器内的 80 端口映射到了主机上的 3344 端口，如果防火墙放行了 3344 端口，安全组也放行了 3344 端口，那么通过外网就也能访问到 容器内的 nginx。</p>
<h2 id="部署-Nginx"><a href="#部署-Nginx" class="headerlink" title="部署 Nginx"></a>部署 Nginx</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">搜索镜像：建议使用 dockerhub 搜索详细内容</span></span><br><span class="line">docker search nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拉取镜像</span></span><br><span class="line">docker pull nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动镜像</span></span><br><span class="line">docker run -d --name nginx01 -p 3344:80 nginx</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-d 表示后台启动</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--name 表示容器名称</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-p 表示设置映射端口，3344 是主机端口，80 是容器内的 nginx 端口（默认 80）</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试本地访问 nginx 服务</span></span><br><span class="line">curl localhost:3344</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试结果显示：</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# curl localhost:3344</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">html &#123; color-scheme: light dark; &#125;</span><br><span class="line">body &#123; width: 35em; margin: 0 auto;</span><br><span class="line">font-family: Tahoma, Verdana, Arial, sans-serif; &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">此时启动成功，开放防火墙和安全组后外网也能访问到</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入容器内查看 nginx</span></span><br><span class="line">docker exec -it nginx01 /bin/bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看 nginx 相关文件</span></span><br><span class="line">root@5eb335726b53:/# whereis nginx</span><br><span class="line">nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx</span><br><span class="line">root@5eb335726b53:/# cd /etc/nginx</span><br><span class="line">root@5eb335726b53:/etc/nginx# ls</span><br><span class="line">conf.d	fastcgi_params	mime.types  modules  nginx.conf  scgi_params  uwsgi_params</span><br></pre></td></tr></table></figure>

<blockquote>
<p>​		<code>问题</code>：现在的方式每次修改 nginx 的配置文件都需要进入容器的内部，十分麻烦，那么如何在容器外部提供一个映射文件，达到在容器外修改配置文件，容器内自动同步修改的效果呢？&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; <code>数据卷技术</code></p>
<p>​		根据 <code>4.1</code> 数据卷技术，需要在启动时设置：<code>-v /home/nginx:/usr/nginx</code>即可。</p>
</blockquote>
<h2 id="部署-Tomcat"><a href="#部署-Tomcat" class="headerlink" title="部署 Tomcat"></a>部署 Tomcat</h2><p>​		选择 Tomcat 9.0 版本。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">官方方式：使用完后立马自动删除镜像（仅测试时使用）</span></span><br><span class="line">docker run -it --rm tomcat:9.0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dockerhub 搜寻镜像</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拉取镜像</span></span><br><span class="line">docker pull tomcat:9.0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动 tomcat9</span></span><br><span class="line">docker run -d --name tomcat9 -p 3355:8080 tomcat:9.0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动后，发现访问成功，但是没有欢迎页面</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入 tomcat9</span></span><br><span class="line">docker exec -it tomcat9 /bin/bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看webapps目录文件</span></span><br><span class="line">cd webapps</span><br><span class="line">ls</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现此文件目录为空！</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>​		镜像版的 Tomcat 默认是最小的镜像，所有不必要的文件都被剔除了，因此没有欢迎页面，同时还有一些基础的 linux 命令不能使用，<code>镜像只保证 tomcat 的基本使用</code>，是阉割版的。如何解决呢？</p>
<p>​		发现存在 webapps.dist 目录，此目录下有原先的 ROOT 文件夹等欢迎页面，因此可以进入容器将 此目录下的文件拷贝到原 webapps 目录下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入容器</span></span><br><span class="line">docker exec -it tomcat9 /bin/bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入 webapps.dist 文件夹</span></span><br><span class="line">root@70c149998eb6:/usr/local/tomcat# cd webapps.dist/</span><br><span class="line">root@70c149998eb6:/usr/local/tomcat/webapps.dist# ls</span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">复制文件</span></span><br><span class="line">cp -r webapps.dist/* webapps</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><code>问题</code>：部署项目必须进入容器内部十分麻烦，如何<code>在容器外不提供一个映射路径 webapps，达到在外部放置项目，就自动同步到内部的技术</code>？&#x3D;&#x3D;&#x3D;&gt; <code>数据卷技术</code></p>
</blockquote>
<h2 id="部署-ES-和-Kibana"><a href="#部署-ES-和-Kibana" class="headerlink" title="部署 ES 和 Kibana"></a>部署 ES 和 Kibana</h2><blockquote>
<p>需要注意的是：ES暴露的端口很多，且十分耗费内存，同时 ES 的数据需要放到安全目录（<code>挂载</code>）。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载 ES 并启动，暴露端口 9200 和 9300，-e <span class="string">&quot;discovery.type=single-node&quot;</span>是集群中配置单机节点</span></span><br><span class="line">docker run -d --name es -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:7.6.2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行发现并没有成功启动 ES：</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">因此查看启动日志</span></span><br><span class="line">docker logs -f es</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现报错信息：内容大致就是内存问题 ====&gt; ES 非常耗费内存</span></span><br><span class="line">OpenJDK 64-Bit Server VM warning: Option UseConcMarkSweepGC was deprecated in version 9.0 and will likely be removed in a future release.</span><br><span class="line">OpenJDK 64-Bit Server VM warning: INFO: os::commit_memory(0x00000000d4cc0000, 724828160, 0) failed; error=&#x27;Not enough space&#x27; (errno=12)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">There is insufficient memory <span class="keyword">for</span> the Java Runtime Environment to <span class="built_in">continue</span>.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Native memory allocation (mmap) failed to map 724828160 bytes <span class="keyword">for</span> committing reserved memory.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">An error report file with more information is saved as:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">logs/hs_err_pid1.<span class="built_in">log</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">那么如何解决呢？	======&gt; 环境配置修改：限制内存，设置运行环境参数</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、先删除之前的未能成功启动的镜像</span></span><br><span class="line">docker rm es</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、启动新的 es ，同时设置内存限制</span></span><br><span class="line">docker run -d --name es -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; -e ES_JAVA_OPTS=&quot;-Xms64m -Xmx512m&quot;  elasticsearch:7.6.2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3、发现成功启动</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE                 COMMAND                  CREATED         STATUS         PORTS                                                                                  NAMES</span><br><span class="line">0323c75fccb6   elasticsearch:7.6.2   &quot;/usr/local/bin/dock…&quot;   4 seconds ago   Up 3 seconds   0.0.0.0:9200-&gt;9200/tcp, :::9200-&gt;9200/tcp, 0.0.0.0:9300-&gt;9300/tcp, :::9300-&gt;9300/tcp   es</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4、检查运行情况</span></span><br><span class="line">curl localhost:9200</span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# curl localhost:9200</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot; : &quot;0323c75fccb6&quot;,</span><br><span class="line">  &quot;cluster_name&quot; : &quot;docker-cluster&quot;,</span><br><span class="line">  &quot;cluster_uuid&quot; : &quot;A2Mux9ntSCWJlUD_mFvihg&quot;,</span><br><span class="line">  &quot;version&quot; : &#123;</span><br><span class="line">    &quot;number&quot; : &quot;7.6.2&quot;,</span><br><span class="line">    &quot;build_flavor&quot; : &quot;default&quot;,</span><br><span class="line">    &quot;build_type&quot; : &quot;docker&quot;,</span><br><span class="line">    &quot;build_hash&quot; : &quot;ef48eb35cf30adf4db14086e8aabd07ef6fb113f&quot;,</span><br><span class="line">    &quot;build_date&quot; : &quot;2020-03-26T06:34:37.794943Z&quot;,</span><br><span class="line">    &quot;build_snapshot&quot; : false,</span><br><span class="line">    &quot;lucene_version&quot; : &quot;8.4.0&quot;,</span><br><span class="line">    &quot;minimum_wire_compatibility_version&quot; : &quot;6.8.0&quot;,</span><br><span class="line">    &quot;minimum_index_compatibility_version&quot; : &quot;6.0.0-beta1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;tagline&quot; : &quot;You Know, for Search&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">此时证明运行成功</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查 CPU 状态</span></span><br><span class="line">docker stats</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现占用内存已经受到限制</span></span><br><span class="line">CONTAINER ID   NAME      CPU %     MEM USAGE / LIMIT   MEM %     NET I/O         BLOCK I/O        PIDS</span><br><span class="line">0323c75fccb6   es        0.18%     386MiB / 7.627GiB   4.94%     2.83kB / 984B   85.3MB / 862kB   46</span><br></pre></td></tr></table></figure>

<blockquote>
<p>那么如何<code>使用 kibana 连接 ES </code>呢？</p>
<p>1）容器内部互相隔离，则<code>直接通过 localhost:port 连接并不现实</code>。</p>
<p>2）Linux 存在内网 IP，则可以通过 kibana ——&gt; 内网地址 ——-&gt; ES &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; <code>Docker 网络原理</code>（后续说明）</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20210720172452779.png" alt="在这里插入图片描述"></p>
<h2 id="portainer-可视化"><a href="#portainer-可视化" class="headerlink" title="portainer 可视化"></a>portainer 可视化</h2><p>​		<code>portainer</code>：是 Docker 图形化<code>界面管理</code>工具，提供一个后台面板供我们操作。（后续更推荐使用 Rancher）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行如下命令即可 打开可视化服务</span></span><br><span class="line">docker run -d -p 8080:9000 --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-d 后台运行</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-p 指定运行端口，8080 为主机端口，9000 为内部映射端口</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-v 挂载</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--privileged 授权</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">portainer/portainer 安装控制面板</span></span><br></pre></td></tr></table></figure>

<p>访问测试：<code>http://8.142.92.222:10001/</code>，即可看到可视化面板。（第一次加载会很慢）</p>
<p>注意：平时并不会使用。</p>
<h1 id="Docker-镜像"><a href="#Docker-镜像" class="headerlink" title="Docker 镜像"></a>Docker 镜像</h1><p>​		镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的所有内容，包括<code>代码、运行时库、环境变量和配置文件</code>。&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; 所有的应用，直接打包 docker 镜像，就可以直接跑起来。</p>
<p>如何得到镜像：</p>
<ul>
<li>从远程仓库下载</li>
<li>朋友拷贝给你</li>
<li>自己制作一个镜像 <code>DockerFile</code></li>
</ul>
<h2 id="镜像加载原理"><a href="#镜像加载原理" class="headerlink" title="镜像加载原理"></a>镜像加载原理</h2><blockquote>
<p>​		<code>UnionFS（联合文件系统）</code>：Union文件系统（UnionFS）是一种<code>分层</code>、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下（unite several directories into a single virtual filesystem）。<code>Union 文件系统是 Docker 镜像的基础</code>。镜像可以<code>通过分层来进行继承</code>，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</p>
<p>​		特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把文件系统叠加起来，这样最终的文件系统包含所有底层的文件和目录。(<code>共用的就不需要重复下载</code>)</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20210721144206155.png" alt="在这里插入图片描述"></p>
<p>docker 的镜像实际上由一层一层的文件系统组成，这种层级的文件系统 UnionFS。系统启动需要引导加载。</p>
<p>​		<code>bootfs</code>（boot file system）主要包含 bootloader 和 kernel，bootloader 主要是引导加载 kernel，Linux 刚启动时会加载 bootfs 文件系统，在 Docker 镜像的最底层是 bootfs。这一层与我们电箱的 Linux&#x2F;Unix 系统是一样的，包含 boot 加载器和内核。当 boot 加载完成之后整个内核就都在内存中了，此时内存的使用权已由 bootfs 转交给内核，此时系统也会卸载 bootfs。</p>
<p>​		<code>rootfs</code>（root file system），在 bootfs 之上。包含的就是典型 Linux 系统中的 &#x2F;dev，&#x2F;proc，&#x2F;bin，&#x2F;etc 等标准目录和文件。rootfs 就是各种不同的操作系统发行版，比如 Ubuntu，Centos 等等。</p>
<p>​		而 Docker 底层直接用主机的的 kernel，自己只需要提供 rootfs 就可以了。由此可见对于不同的 Linux 发行版， boots 基本是一致的， rootfs 会有差別，因此不同的发行版可以公用 bootfs。因此 docker 启动才是非常快的。</p>
<blockquote>
<p><code>总结：</code>docker 使用联合文件系统，底层使用主机的启动引导，只需要提供不同的 rootfs，就可以搭建一个新的 linux 系统。</p>
</blockquote>
<h2 id="分层结构"><a href="#分层结构" class="headerlink" title="分层结构"></a>分层结构</h2><p>​		Docker 采用<code>分层结构</code>（下载镜像时可以看出分层下载），分层结构可以资源共享，多个镜像都从相同的 Base 镜像构建而来，那么宿主机只需在磁盘上保留一份 base 镜像，同时内存中也只需要加载一份 base 镜像，这样就可以为所有的容器服务了，而且镜像的<code>每一层都可以被共享</code>。<code>“千层饼”</code>结构，就相当于<code>后面的层都可以使用之前已经下载的资源</code>，而不需要重新下载完整的包。</p>
<p>查看镜像分层方式：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image inspect redis:latest</span><br></pre></td></tr></table></figure>

<p>举例：该镜像当前已经包含3个镜像层，第一层 Ubuntu Linux 16.04，当再添加第二 python 镜像层时，<code>镜像始终是保持当前所有镜像的组合</code>，不需要下载之前下载过的文件，只需要下载第一层没有的文件：文件4、5、6，以此类推。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/2021072115154375.png" alt="在这里插入图片描述"></p>
<p>主要目的：<code>分层复用</code>、<code>资源复用</code>。</p>
<p>特点：Docker 镜像都是只读的，当容器启动时，一个新的<code>可写层</code>（自己的东西）被加载到镜像的顶部，这一层就是我们通常说的容器层，容器之下的都叫镜像层。例如 Tomcat 原本的镜像就是镜像层，而我们后面<code>加的 war 包或者其他环境</code> + 原本的 Tomcat 镜像 合成新的容器。</p>
<h2 id="提交镜像"><a href="#提交镜像" class="headerlink" title="提交镜像"></a>提交镜像</h2><p>提交容器成为一个新的可使用的副本：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit -m=&quot;提交的描述信息&quot; -a=&quot;作者&quot; 容器ID 目标镜像名:[tag]</span><br></pre></td></tr></table></figure>

<p>实战测试：打包一个新的 Tomcat 镜像，让其 webapps 内部有欢迎页面。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、启动原本默认的 Tomcat</span></span><br><span class="line">docker run -d -p 10001:8080 tomcat</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">默认的tomcat 是没有webapps应用，官方的镜像默认webapps下面是没有文件的，欢迎页面在 webapps.dist 目录下</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、进入容器内部</span></span><br><span class="line">docker exec -it 容器ID /bin/bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3、拷贝文件到 webapps</span></span><br><span class="line">cp -r webapps.dist/* webapps</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4、提交自己修改的镜像（注意新的镜像名全部小写字母）</span></span><br><span class="line">docker commit -a=&quot;gaozheng&quot; -m=&quot;新版本Tomcat&quot; 676a90063c04 tomcat_high:1.0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">5、查看镜像</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">tomcat_high           1.0       595dd9d97756   6 seconds ago   684MB	# 发现新的镜像已经提交成功，版本 1.0，比原来的大 4M</span><br><span class="line">tomcat                9.0       bce48a218e94   8 days ago      680MB</span><br><span class="line">tomcat                latest    c795915cb678   8 days ago      680MB</span><br><span class="line">nginx                 latest    0e901e68141f   8 days ago      142MB</span><br><span class="line">portainer/portainer   latest    12b0b8dced14   3 weeks ago     75.4MB</span><br><span class="line">centos                latest    5d0da3dc9764   8 months ago    231MB</span><br><span class="line">elasticsearch         7.6.2     f29a1ee41030   2 years ago     791MB</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试检查新的镜像</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker run -d -p 10001:8080 --name tomcat tomcat_high:1.0</span><br><span class="line">c777ce34b4361b9c08945d8a80a2b04be8ff334296151e203d4bc8ada9d57936</span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE             COMMAND             CREATED         STATUS         PORTS                                         NAMES</span><br><span class="line">c777ce34b436   tomcat_high:1.0   &quot;catalina.sh run&quot;   3 seconds ago   Up 2 seconds   0.0.0.0:10001-&gt;8080/tcp, :::10001-&gt;8080/tcp   tomcat</span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker exec -it tomcat /bin/bash</span><br><span class="line">root@c777ce34b436:/usr/local/tomcat# ls</span><br><span class="line">BUILDING.txt	 LICENSE  README.md	 RUNNING.txt  conf  logs	    temp     webapps.dist</span><br><span class="line">CONTRIBUTING.md  NOTICE   RELEASE-NOTES  bin	      lib   native-jni-lib  webapps  work</span><br><span class="line">root@c777ce34b436:/usr/local/tomcat# cd webapps</span><br><span class="line">root@c777ce34b436:/usr/local/tomcat/webapps# ls</span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现新的镜像的 webapps 目录已经有了 欢迎页面文件</span></span><br></pre></td></tr></table></figure>

<h1 id="容器数据卷"><a href="#容器数据卷" class="headerlink" title="容器数据卷"></a>容器数据卷</h1><p>​		Docker 理念：将应用和环境打包成一个镜像。但是如果数据都在容器中，那么我们容器删除，数据就会丢失 &#x3D;&#x3D;&#x3D;&gt; <code>数据需要持久化</code>。</p>
<p>举例：MySQL 数据库的数据需要能够存储在本地。&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;  <code>数据卷技术</code>：数据共享，将容器产生的数据同步到本地。</p>
<blockquote>
<p>数据卷技术的实现：容器之间、容器和主机文件系统隔离，需要使用<code>目录的挂载</code>，将我们容器内的目录，挂载到主机 Linux 目录上。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20210721201603322.png" alt="在这里插入图片描述"></p>
<p>总结：容器的<code>持久化</code>和<code>同步</code>操作，容器间也是可以<code>数据共享</code>的（<code>挂载到同一个目录</code>）。</p>
</blockquote>
<h2 id="数据卷使用"><a href="#数据卷使用" class="headerlink" title="数据卷使用"></a>数据卷使用</h2><p>​		数据卷技术的挂载如何实现呢？&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; <code>-v</code> 挂载</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-v 主机目录:容器内目录</span><br><span class="line">--volume 主机目录:容器内目录</span><br></pre></td></tr></table></figure>

<p>以 centos 卷目录挂载示例：</p>
<p>​		注意：<code>主机挂载的目录需要不存在</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动 centos 并挂载目录</span></span><br><span class="line">docker run -it -v /home/gaozheng/ceshi:/home --name centos centos /bin/bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看 centos 容器的详情（关注挂载位置设置）</span></span><br><span class="line">docker inspect centos</span><br></pre></td></tr></table></figure>

<p>![](D:\NoteBook\核心笔记\Linux\image\docker 挂载.png)</p>
<p>发现挂载成功，已经配置，进行以下测试：</p>
<p>1）进入 centos 容器内部创建文件，查看外部是否同步。</p>
<p>2）关闭容器，主机创建文件，测试容器内是否新增该文件。</p>
<p>3）删除容器，查看容器外文件是否消失。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试（1）</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">容器内创建 love.txt 文件</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ gaozheng]# docker exec -it centos /bin/bash</span><br><span class="line">[root@f16f608d2067 /]# cd /home</span><br><span class="line">[root@f16f608d2067 home]# ls</span><br><span class="line">[root@f16f608d2067 home]# touch love.txt</span><br><span class="line">[root@f16f608d2067 home]# ls</span><br><span class="line">love.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">主机查看挂载目录文件</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# cd /home/gaozheng/ceshi</span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ceshi]# ls</span><br><span class="line">love.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试（2）</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭容器</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ gaozheng]# docker stop centos</span><br><span class="line">centos</span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ gaozheng]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">主机增加文件</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ceshi]# touch test111.txt</span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ceshi]# ls</span><br><span class="line">love.txt  test111.txt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动容器</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ gaozheng]# docker restart centos</span><br><span class="line">centos</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入容器内部查看</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ gaozheng]# docker exec -it centos /bin/bash</span><br><span class="line">[root@f16f608d2067 /]# cd /home</span><br><span class="line">[root@f16f608d2067 home]# ls</span><br><span class="line">love.txt  test111.txt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现文件自动同步</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试（3）</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除容器</span></span><br><span class="line">docker rm -f centos</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">主机查看文件目录</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ceshi]# ls</span><br><span class="line">love.txt  test111.txt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现并没有消失</span></span><br></pre></td></tr></table></figure>

<p>同步规则：<code>不管容器是否是运行状态，主机和容器的挂载文件都是保持同步的</code>（相当于是<code>同一个目录位置</code>）。&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; <code>双向绑定</code></p>
<h2 id="MySQL-案例"><a href="#MySQL-案例" class="headerlink" title="MySQL 案例"></a>MySQL 案例</h2><p>实例：部署一个 MySQL，但 MySQL 数据肯定需要持久化，放在主机上，就需要通过挂载。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拉取 MySQL5.7 镜像</span></span><br><span class="line">docker pull mysql:5.7</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行容器，需要做数据挂载</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注意：安装启动 mysql，需要配置密码</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">官方用法：docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动容器</span></span><br><span class="line">docker run -d -p 10001:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-d 后台运行</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-p 端口映射</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-v 数据卷挂载</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-e 环境配置</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--name 容器名称</span></span><br></pre></td></tr></table></figure>

<p>启动后，使用 navicat 测试连接：发现<code>连接成功</code>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic1.imgdb.cn/item/63369d2d16f2c2beb16bea46.png"></p>
<p>检查数据文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ data]# ls</span><br><span class="line">auto.cnf    ca.pem           client-key.pem  ibdata1      ib_logfile1  mysql               private_key.pem  server-cert.pem  sys</span><br><span class="line">ca-key.pem  client-cert.pem  ib_buffer_pool  ib_logfile0  ibtmp1       performance_schema  public_key.pem   server-key.pem</span><br></pre></td></tr></table></figure>

<p><code>当容器删除后，挂载到本地的数据卷依旧没有丢失</code>。</p>
<h2 id="挂载方式"><a href="#挂载方式" class="headerlink" title="挂载方式"></a>挂载方式</h2><p>​		挂载方式分为：<code>具名挂载</code> 和 <code>匿名挂载</code>。</p>
<p>1、匿名挂载：不指定<code>主机</code>上的映射文件位置。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-v 容器内的目录位置</span></span><br><span class="line">docker run -d --name nginx01 -v /etc/nginx nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看所有卷 volume 的情况</span></span><br><span class="line">docker volume ls</span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ data]# docker volume ls</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试效果：后面的就是匿名的卷 volume</span></span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     2d6f03c8c5dc2b97631990bd8d322664d8c4cc5ec51a04dfc6c7c4030fbf992a</span><br><span class="line">local     5d9cdeab3888e3a84d5e0f8a4a477082514e1db5406b4043651bee09df818de3</span><br><span class="line">local     6c5417becd49af474d2a8ab3061645706f4b45dcfebde4fdeb56fb253c969581</span><br><span class="line">local     44dfa0647e01c741d0f97e6d5b1487efa9253d7fcf7411f96d4cc306bac7b4cd</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这种就是匿名挂载，我们在 -v 只写了容器内的路径，没有写容器外的路径！</span></span><br></pre></td></tr></table></figure>

<p>2、具名挂载</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-v 主机目录位置：容器内目录位置</span></span><br><span class="line">docker run -d --name nginx02 -v juming-nginx:/etc/nginx nginx</span><br><span class="line"></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ home]# docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     2d6f03c8c5dc2b97631990bd8d322664d8c4cc5ec51a04dfc6c7c4030fbf992a</span><br><span class="line">local     5d9cdeab3888e3a84d5e0f8a4a477082514e1db5406b4043651bee09df818de3</span><br><span class="line">local     6c5417becd49af474d2a8ab3061645706f4b45dcfebde4fdeb56fb253c969581</span><br><span class="line">local     44dfa0647e01c741d0f97e6d5b1487efa9253d7fcf7411f96d4cc306bac7b4cd</span><br><span class="line">local     juming-nginx</span><br></pre></td></tr></table></figure>

<p>查看详细信息：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ home]# docker volume inspect juming-nginx</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;CreatedAt&quot;: &quot;2022-06-06T14:01:57+08:00&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Labels&quot;: null,</span><br><span class="line">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/juming-nginx/_data&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;juming-nginx&quot;,</span><br><span class="line">        &quot;Options&quot;: null,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>所有的 docker 容器内的卷，没有指定目录的情况下都是在 <code>/var/lib/docker/volumes/xxx/_data</code></p>
<p>我们通过具名挂载可以方便的找到我们的 一个卷，<code>大多数情况使用的是 具名挂载</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如何确定是具名挂载还是匿名挂载，还是指定路径挂载！</span></span><br><span class="line">-v 容器内路径         	# 匿名挂载</span><br><span class="line">-v 卷名:容器内路径        # 具名挂载</span><br><span class="line">-v /宿主机路径:容器路径   # 指定路径挂载！</span><br></pre></td></tr></table></figure>

<p>拓展：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过 -v 容器内路径： ro rw 改变读写权限</span></span><br><span class="line">ro readonly  	# 只读</span><br><span class="line">rw readwrite 	# 可读可写</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">一旦设置了容器权限，容器对我们挂载出来的内容就有限定了！</span></span><br><span class="line">docker run -d -P --name nginx05 -v juming:/etc/nginx:ro nginx</span><br><span class="line">docker run -d -P --name nginx05 -v juming:/etc/nginx:rw nginx</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ro 只要看到ro就说明这个路径只能通过宿主机来操作，容器内部是无法操作！</span></span><br></pre></td></tr></table></figure>

<h2 id="DockerFile-挂载"><a href="#DockerFile-挂载" class="headerlink" title="DockerFile 挂载"></a>DockerFile 挂载</h2><p>测试在创建镜像的时候就进行数据卷的挂载</p>
<p>​		<code>Dockerfile</code> 就是用来构建 docker 镜像的构建文件：命令脚本手动构建镜像。</p>
<p>1、<code>/home/gaozheng</code> 用于存放测试的脚本文件和映射数据卷位置。</p>
<p>2、创建一个 dockerFile 文件，名字随意，建议使用 dockerfile 命名。（dockerfile01）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">VOLUME [&quot;/volume01&quot;, &quot;/volume02&quot;]</span><br><span class="line"></span><br><span class="line">CMD echo &quot;------end------&quot;</span><br><span class="line">CMD /bin/bash</span><br></pre></td></tr></table></figure>

<p>3、构建镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注意</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、命令最后的那个点 .</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、镜像名前面不能有 /</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3、dockerfile 建议使用全路径</span></span><br><span class="line">docker build -f /home/gaozheng/dockerfile01 -t gaozheng/centos .</span><br><span class="line"></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ gaozheng]# docker build -f /home/gaozheng/dockerfile01 -t gaozheng-centos .</span><br><span class="line">Sending build context to Docker daemon  6.144kB</span><br><span class="line">Step 1/4 : FROM centos</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">5d0da3dc9764</span></span><br><span class="line">Step 2/4 : VOLUME [&quot;/volume01&quot;, &quot;/volume02&quot;]</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 19bba0050263</span></span><br><span class="line">Removing intermediate container 19bba0050263</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">7ba109a7121b</span></span><br><span class="line">Step 3/4 : CMD echo &quot;------end------&quot;</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 3f934f2d2490</span></span><br><span class="line">Removing intermediate container 3f934f2d2490</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">bd49f0821c30</span></span><br><span class="line">Step 4/4 : CMD /bin/bash</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> b6d2b2c138b5</span></span><br><span class="line">Removing intermediate container b6d2b2c138b5</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">4ef680cee27a</span></span><br><span class="line">Successfully built 4ef680cee27a</span><br><span class="line">Successfully tagged gaozheng-centos:latest</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看当前镜像，出现 gaozheng/centos</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ gaozheng]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">gaozheng-centos       latest    4ef680cee27a   4 seconds ago   231MB</span><br><span class="line">tomcat_high           1.0       595dd9d97756   4 hours ago     684MB</span><br></pre></td></tr></table></figure>

<p>4、启动自己构建的镜像后，进入其中发现：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20210722153212255.png" alt="在这里插入图片描述"></p>
<p>5、根据上图可知，则主机上一定有一个位置和容器内进行同步的目录。</p>
<p>查看数据卷挂载的路径：可以通过在内部创建文件进行测试。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">docker inspect 容器ID</span><br><span class="line"></span><br><span class="line">&quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;adbd313822d6e2267b7116c14a92c82f14f892e94a601c28348d79cd6b8249ea&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/adbd313822d6e2267b7116c14a92c82f14f892e94a601c28348d79cd6b8249ea/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;volume02&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;57bcdecf0e157033888c0371c4f030845fa37ced9d50996c2ac8b56daaa09c97&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/57bcdecf0e157033888c0371c4f030845fa37ced9d50996c2ac8b56daaa09c97/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;volume01,&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br></pre></td></tr></table></figure>

<p>这种方式使用的十分多，因为我们通常会构建自己的镜像，假设构建镜像时候没有挂载卷，要手动镜像挂载 -v 卷名：容器内路径。</p>
<h2 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h2><p>假设需求：多个 centos 需要共享数据。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--volumes-from</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/img_convert/509123ae482041b594dff90c81dd799c.png" alt="在这里插入图片描述"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动 centos01 父容器</span></span><br><span class="line">docker run -it --name centos01 gaozheng-centos</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动 centos02，并绑定数据卷到 centos01</span></span><br><span class="line">docker run -it --name centos02 --volumes-from centos01 gaozheng-centos</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试：在 centos01 中的 volume01 目录创建文件 centos01Build，在 centos 02 是否可以拿到？</span></span><br><span class="line">[root@3573ac0b9e0b /]# cd volume01</span><br><span class="line">[root@3573ac0b9e0b volume01]# ls</span><br><span class="line">[root@3573ac0b9e0b volume01]# touch centos01Build</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">CTRL + P + Q</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ gaozheng]# docker exec -it centos02 /bin/bash</span><br><span class="line">[root@38d1c9649e8c /]# cd volume01</span><br><span class="line">[root@38d1c9649e8c volume01]# ls</span><br><span class="line">centos01Build</span><br></pre></td></tr></table></figure>

<p>被实现数据同步的容器（父容器）就叫做：<code>数据卷容器</code>。</p>
<p>当该数据卷容器被删除后，其余容器里面的文件依旧存在。（<code>备份机制</code>：<code>拷贝</code>而非共享）</p>
<p>案例：多个 MySQL 实现数据共享</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 3306:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line">docker run -d -p 3307:3306 -e MYSQL_ROOT_PASSWORD=123456 --name mysql02 --volumes-from mysql01 mysql:5.7</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这个时候，可以实现两个容器数据同步！</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>结论</code>：容器之间的<code>配置信息</code>的传递，数据卷容器的生命周期持续到没有容器使用为止，但是一旦持久化到了本地，这个时候，本地的数据是不会删除的。</p>
</blockquote>
<h1 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h1><p>​		dockerfile 是用来<code>构建 docker 镜像</code>的文件，是一个命令参数脚本。官方镜像都是基础包，很多功能没有，<code>通常会搭建自己的镜像</code>。</p>
<h2 id="DockerFile-构建过程"><a href="#DockerFile-构建过程" class="headerlink" title="DockerFile 构建过程"></a>DockerFile 构建过程</h2><p>​		DockerFile 是一个脚本文件，首先需要了解 Docker 脚本的规则：</p>
<p>1）每个保留关键字(指令）都是必须是大写字母。</p>
<p>2）执行从上到下顺序。</p>
<p>3）# 表示注释。</p>
<p>4）每一个指令都会创建提交一个新的镜像层，并提交。</p>
<p><code>DockerFile</code>：面向开发，构建文件，定义了一切的步骤，源代码，<code>发布项目的必须</code>。</p>
<p><code>DockerImages</code>：通过 DockerFile 构建生成的镜像，最终发布和运行的产品。</p>
<p><code>Docker容器</code>：容器就是镜像运行起来提供服务。</p>
<p>​		DockerFile ——&gt; DockerImages ——–&gt; Docker 容器</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/c40a1beeb33140e687c92a3ef54a0680.png" alt="在这里插入图片描述"></p>
<h2 id="DockerFile-指令"><a href="#DockerFile-指令" class="headerlink" title="DockerFile 指令"></a>DockerFile 指令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">FROM             # 基础镜像，一切从这里开始构建，例如 centos</span><br><span class="line">MAINTAINER        # 镜像是谁写的， 姓名 + 邮箱（官方标准）</span><br><span class="line">RUN             # 镜像构建的时候需要运行的命令</span><br><span class="line">ADD             # 步骤，tomcat镜像，这个tomcat压缩包！添加内容 添加同目录</span><br><span class="line">WORKDIR         # 镜像的工作目录</span><br><span class="line">VOLUME             # 挂载的目录</span><br><span class="line">EXPOSE             # 保留端口配置，-p 设置</span><br><span class="line"></span><br><span class="line">CMD             # 指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代。</span><br><span class="line">ENTRYPOINT         # 和 cmd 类似，指定这个容器启动的时候要运行的命令，可以追加命令。</span><br><span class="line">ONBUILD         # 当构建一个被继承 DockerFile 这个时候就会运行 ONBUILD 的指令，触发指令。（了解）</span><br><span class="line">COPY             # 类似ADD，将我们文件拷贝到镜像中</span><br><span class="line">ENV             # 构建的时候设置环境变量！ES，MySQL 使用到了</span><br></pre></td></tr></table></figure>

<h2 id="实战-centos-镜像"><a href="#实战-centos-镜像" class="headerlink" title="实战 centos 镜像"></a>实战 centos 镜像</h2><p>​		Docker Hub中 99% 镜像都是从这个基础镜像过来的<code>FROM scratch</code> , 然后配置需要的软件和配置来进行的构建。</p>
<p>​		本次实战创建自己的 centos 系统镜像，以上面的图为参考，同时增加官方 centos 没有的<code>命令依赖</code>。</p>
<p>官方的 centos 镜像：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/1e323c4feaf9415cbc0a79e7e2418c90.png" alt="在这里插入图片描述"></p>
<p>1、创建自己的 centos 的 dockerfile 文件：dockerfile-centos</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ gaozheng]# cat dockerfile-centos </span><br><span class="line">FROM centos:7</span><br><span class="line">MAINTAINER gaozheng&lt;1963885633@qq.com&gt;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置工作目录：一进入容器就到工作目录（官方的镜像默认工作目录是根目录）</span></span><br><span class="line">ENV MYPATH /home/gaozheng/myCentos</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装一些官方没有的命令</span></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">暴露默认端口</span></span><br><span class="line">EXPOSE 80</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出信息</span></span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo &quot;------构建镜像完毕&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">默认控制台</span></span><br><span class="line">CMD /bin/bash</span><br></pre></td></tr></table></figure>

<p>2、构建镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker build -f /home/gaozheng/dockerfile-centos -t centos-gaozheng:1.0 .</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-f 指定 dockerfile 文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-t 指定镜像名称</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查镜像构建完成</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ gaozheng]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED              SIZE</span><br><span class="line">centos-gaozheng       1.0       de22ed9a477e   About a minute ago   601MB</span><br></pre></td></tr></table></figure>

<p>3、运行这个镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ gaozheng]# docker run -it --name centos centos-gaozheng:1.0</span><br><span class="line">[root@c7a0bd585b55 myCentos]# ls</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现当前处于设定的工作目录</span></span><br><span class="line">[root@c7a0bd585b55 myCentos]# pwd</span><br><span class="line">/home/gaozheng/myCentos</span><br><span class="line">[root@c7a0bd585b55 myCentos]# vim test.txt</span><br><span class="line">[root@c7a0bd585b55 myCentos]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.2  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ether 02:42:ac:11:00:02  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 25  bytes 2191 (2.1 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现 vim 和 ifconfig 命令可以使用了，在官方基础上做了增强</span></span><br></pre></td></tr></table></figure>

<p>4、查看自定义镜像的<code>构建过程</code>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看镜像的构建过程</span></span><br><span class="line">docker history 镜像ID/镜像名:tag</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ gaozheng]# docker history centos-gaozheng:1.0</span><br><span class="line">IMAGE          CREATED          CREATED BY                                      SIZE      COMMENT</span><br><span class="line">de22ed9a477e   15 minutes ago   /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;/bin…   0B        </span><br><span class="line">d58a71b14d95   15 minutes ago   /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;echo…   0B        </span><br><span class="line">2b1814b52c42   15 minutes ago   /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;echo…   0B        </span><br><span class="line">4270becf57b3   15 minutes ago   /bin/sh -c #(nop)  EXPOSE 80                    0B        </span><br><span class="line">3c8a3388efb8   15 minutes ago   /bin/sh -c yum -y install net-tools             171MB     </span><br><span class="line">c23449816b96   15 minutes ago   /bin/sh -c yum -y install vim                   226MB     </span><br><span class="line">42af61bb10e2   15 minutes ago   /bin/sh -c #(nop) WORKDIR /home/gaozheng/myC…   0B        </span><br><span class="line">62f9150d0f0b   15 minutes ago   /bin/sh -c #(nop)  ENV MYPATH=/home/gaozheng…   0B        </span><br><span class="line">1a0bb47491bc   15 minutes ago   /bin/sh -c #(nop)  MAINTAINER gaozheng&lt;19638…   0B        </span><br><span class="line">eeb6ee3f44bd   8 months ago     /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0B        </span><br><span class="line">&lt;missing&gt;      8 months ago     /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B        </span><br><span class="line">&lt;missing&gt;      8 months ago     /bin/sh -c #(nop) ADD file:b3ebbe8bd304723d4…   204MB</span><br></pre></td></tr></table></figure>

<p>通过这个命令来<code>研究别人的镜像的构建</code>。</p>
<blockquote>
<p>CMD 和 ENTRYPOINT 区别：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注意 cmd 只有最后一条命令会生效</span></span><br><span class="line">CMD             # 指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代。</span><br><span class="line">ENTRYPOINT         # 指定这个容器启动的时候要运行的命令，可以追加命令</span><br></pre></td></tr></table></figure>
</blockquote>
<p>1）测试 CMD 命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编写 dockerfile 文件</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vim dockerfile-test-cmd</span></span><br><span class="line">FROM centos</span><br><span class="line">CMD [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">构建镜像</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker build -f dockerfile-test-cmd -t cmd-test:0.1 .</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行镜像，发现 <span class="built_in">ls</span> -a 命令生效</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run cmd-test:0.1</span></span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">......</span><br><span class="line">dev</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">想`追加`一个命令 -l 成为<span class="built_in">ls</span> -al</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run cmd-test:0.1 -l</span></span><br><span class="line">docker: Error response from daemon: OCI runtime create failed:container_linux.go:349: starting container process caused &quot;exec: \&quot;-l\&quot;:executable file not found in $PATH&quot;: unknown.</span><br><span class="line">ERRO[0000] error waiting for container: context canceled</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">原因：cmd 命令的情况下 -l 替换了 CMD[<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;-l&quot;</span>]。 -l 不是命令所有报错</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">那么如何解决呢？=====&gt; 只能写一条完整的命令使其覆盖执行</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run cmd-test:0.1 <span class="built_in">ls</span> -l</span></span><br></pre></td></tr></table></figure>

<p>2）测试 ENTRYPOINT 命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编写dockerfile文件</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vim dockerfile-test-entrypoint</span></span><br><span class="line">FROM centos</span><br><span class="line">ENTRYPOINT [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run entrypoint-test:0.1</span></span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">......</span><br><span class="line">lost+found</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现：我们的命令，是直接拼接在我们得 ENTRYPOINT 命令后面的（追加方式）</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run entrypoint-test:0.1 -l</span></span><br><span class="line">total 56</span><br><span class="line">drwxr-xr-x 1 root root 4096 May 16 06:32 .</span><br><span class="line">drwxr-xr-x 1 root root 4096 May 16 06:32 ..</span><br><span class="line">-rwxr-xr-x 1 root root 0 May 16 06:32 .dockerenv</span><br><span class="line">lrwxrwxrwx 1 root root 7 May 11 2019 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x 5 root root 340 May 16 06:32 dev</span><br><span class="line">drwxr-xr-x 1 root root 4096 May 16 06:32 etc</span><br><span class="line">drwxr-xr-x 2 root root 4096 May 11 2019 home</span><br><span class="line">lrwxrwxrwx 1 root root 7 May 11 2019 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx 1 root root 9 May 11 2019 lib64 -&gt; usr/lib64 </span><br><span class="line">........</span><br></pre></td></tr></table></figure>

<h2 id="实战-Tomcat-镜像"><a href="#实战-Tomcat-镜像" class="headerlink" title="实战 Tomcat 镜像"></a>实战 Tomcat 镜像</h2><p>1、准备镜像文件：准备 <code>tomcat 压缩包 和 jdk压缩包</code> 到当前目录，编写好 README 。</p>
<p>2、编写 dockerfile 脚本：<code>命名为 Dockerfile（官方命名</code>，build 时会自动寻找这个文件，不需要指定）。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">从 centos7 开始构建</span></span><br><span class="line">FROM centos:7</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置构建者信息</span></span><br><span class="line">MAINTAINER gaozheng&lt;1963885633@qq.com&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">复制 readme 文件到容器内</span></span><br><span class="line">COPY readme.txt /usr/local/readme.txt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">add 命令添加的东西会自动解压，解压到 /usr/local</span></span><br><span class="line">ADD jdk-8u311-linux-x64.tar.gz /usr/local/</span><br><span class="line">ADD apache-tomcat-8.5.72.tar.gz /usr/local/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载 vim 命令工具</span></span><br><span class="line">RUN yum -y install vim</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置工作目录</span></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置环境变量（类似于 windows 安装 jdk 和 tomcat 时的配置）</span></span><br><span class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_311</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-8.5.72</span><br><span class="line">ENV CATALINA_BASE /usr/local/apache-tomcat-8.5.72</span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">暴露端口 8080</span></span><br><span class="line">EXPOSE 8080</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置 tomcat 在容器启动时自动启动</span></span><br><span class="line">CMD /usr/local/apache-tomcat-8.5.72/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-8.5.72/bin/logs/catalina.out</span><br></pre></td></tr></table></figure>

<p>3、构建镜像：由于命名为 Dockerfile，则不需要指定 Dockerfile 目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t tomcat-gaozheng</span><br></pre></td></tr></table></figure>

<p>4、显示镜像：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ gaozheng]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED              SIZE</span><br><span class="line">tomcat-gaozheng       latest    472f0f0c1970   About a minute ago   810MB</span><br><span class="line">centos-gaozheng       1.0       de22ed9a477e   2 hours ago          601MB</span><br></pre></td></tr></table></figure>

<p>5、启动镜像，构建容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 10001:8080 --name tomcat-gaozheng -v /home/gaozheng/build/tomcat/test:/usr/local/apache-tomcat-8.5.72/webapps/test -v /home/gaozheng/build/tomcat/tomcat-log/:/usr/local/apache-tomcat-8.5.72/logs tomcat-gaozheng</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">端口映射 10001：8080</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">name：tomcat-gaozheng</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">webapps 文件目录挂载</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">日志文件挂载</span></span><br></pre></td></tr></table></figure>

<p>6、进入容器查看文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ gaozheng]# docker exec -it tomcat-gaozheng /bin/bash</span><br><span class="line">[root@23a64bda4137 local]# ls</span><br><span class="line">apache-tomcat-8.5.72  bin  etc  games  include  jdk1.8.0_311  lib  lib64  libexec  readme.txt  sbin  share  src</span><br><span class="line">[root@23a64bda4137 local]# cd apache-tomcat-8.5.72/</span><br><span class="line">[root@23a64bda4137 apache-tomcat-8.5.72]# ls</span><br><span class="line">BUILDING.txt  CONTRIBUTING.md  LICENSE  NOTICE  README.md  RELEASE-NOTES  RUNNING.txt  bin  conf  lib  logs  temp  webapps  work</span><br><span class="line">[root@23a64bda4137 apache-tomcat-8.5.72]# cd webapps</span><br><span class="line">[root@23a64bda4137 webapps]# ls</span><br><span class="line">ROOT  docs  examples  host-manager  manager  test</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现 tomcat 的webapps 目录下欢迎页面存在（使用的时本地的压缩包），同时还存在 <span class="built_in">test</span> 文件夹</span></span><br></pre></td></tr></table></figure>

<p>7、容器外部测试访问：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:10001</span><br></pre></td></tr></table></figure>

<p>测试远程外网访问：访问 <code>http://8.142.92.222:10001</code>，发现出现 Tomcat 的欢迎页面。</p>
<p>8、发布项目（由于做了数据卷的挂载，只需要将项目放到<code>主机上的 /home/gaozheng/build/tomcat/test</code> 文件夹即可）</p>
<p>​		编写一个基本的项目：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ test]# mkdir WEB-INF</span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ test]# cd WEB-INF/</span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ WEB-INF]# ls</span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ WEB-INF]# vim web.xml</span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ WEB-INF]# cd ..</span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ test]# vim index.jsp</span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ test]# ls</span><br><span class="line">index.jsp  WEB-INF</span><br></pre></td></tr></table></figure>

<p>web.xml 文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">id</span>=<span class="string">&quot;WebApp_ID&quot;</span> <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>index.jsp 页面：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;Hello DockerFile&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">Hello World!&lt;br/&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    out.println(<span class="string">&quot;你的 IP 地址 &quot;</span> + request.getRemoteAddr());</span><br><span class="line">	System.out.println(<span class="string">&quot;-----这是我自己的Tomcat 镜像搭建------&quot;</span>)</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>访问测试：发现成功访问到。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="D:\NoteBook\核心笔记\Linux\image\dockerfile镜像.png"></p>
<p>9、查看日志：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ tomcat]# cd tomcat-log/</span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ tomcat-log]# ls</span><br><span class="line">catalina.2022-06-06.log  host-manager.2022-06-06.log  localhost_access_log.2022-06-06.txt</span><br><span class="line">catalina.out             localhost.2022-06-06.log     manager.2022-06-06.log</span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ tomcat-log]# cat catalina.out </span><br><span class="line">06-Jun-2022 13:13:03.608 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server version name:   Apache Tomcat/8.5.72</span><br><span class="line">06-Jun-2022 13:13:03.610 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server built:          Oct 1 2021 15:15:33 UTC</span><br><span class="line">06-Jun-2022 13:13:03.610 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server version number: 8.5.72.0</span><br><span class="line">06-Jun-2022 13:13:03.610 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log OS Name:               Linux</span><br><span class="line">06-Jun-2022 13:13:03.610 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log OS Version:            4.18.0-193.28.1.el8_2.x86_64</span><br><span class="line">06-Jun-2022 13:13:03.610 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Architecture:          amd64</span><br><span class="line">06-Jun-2022 13:13:03.610 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Java Home:             /usr/local/jdk1.8.0_311/jre</span><br><span class="line">...........................</span><br></pre></td></tr></table></figure>

<h2 id="发布镜像"><a href="#发布镜像" class="headerlink" title="发布镜像"></a>发布镜像</h2><h3 id="发布到-DockerHub"><a href="#发布到-DockerHub" class="headerlink" title="发布到 DockerHub"></a>发布到 DockerHub</h3><p>1、在DockerHub 注册一个账号 gaozheng1998（密码 gaozheng1998） ，并登录。</p>
<p>2、在服务器主机上提交镜像：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">登录 docker</span></span><br><span class="line">docker login -u gaozheng1998 -p gaozheng1998</span><br><span class="line"></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ tomcat-log]# docker login -u gaozheng1998 -p gaozheng1998</span><br><span class="line">WARNING! Using --password via the CLI is insecure. Use --password-stdin.</span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure>

<p>3、提交镜像：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">docker push 镜像名:tag</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">直接 push 会被拒绝</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ tomcat-log]# docker push tomcat-gaozheng</span><br><span class="line">Using default tag: latest</span><br><span class="line">The push refers to repository [docker.io/library/tomcat-gaozheng]</span><br><span class="line">80c6f89de9c4: Preparing </span><br><span class="line">51c23c1501c0: Preparing </span><br><span class="line">84ecaa5f6aa8: Preparing </span><br><span class="line">730d3dc62dc7: Preparing </span><br><span class="line">174f56854903: Preparing </span><br><span class="line">denied: requested access to the resource is denied</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">此时是由于没有加版本号（同时建议加上个人信息，放在镜像名上，且需要和注册的账号保持一致）</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">原镜像名</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ gaozheng]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED              SIZE</span><br><span class="line">tomcat-gaozheng       latest    472f0f0c1970   About a minute ago   810MB</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改镜像名</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ tomcat-log]# docker tag tomcat-gaozheng gaozheng1998/tomcat:1.0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改后镜像名</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ tomcat-log]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">gaozheng1998/tomcat   1.0       472f0f0c1970   40 minutes ago   810MB</span><br><span class="line">tomcat-gaozheng       latest    472f0f0c1970   40 minutes ago   810MB</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">此时再进行提交（镜像名:版本号），便没有问题了</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ tomcat-log]# docker push gaozheng1998/tomcat:1.0</span><br><span class="line">The push refers to repository [docker.io/gaozheng1998/tomcat]</span><br><span class="line">80c6f89de9c4: Pushing [==========&gt;                                        ]  49.37MB/226.1MB</span><br><span class="line">51c23c1501c0: Pushed </span><br><span class="line">84ecaa5f6aa8: Pushing [====&gt;                                              ]   31.4MB/365.3MB</span><br><span class="line">730d3dc62dc7: Pushed </span><br><span class="line">174f56854903: Pushing [========&gt;                                          ]  36.41MB/203.9MB</span><br></pre></td></tr></table></figure>

<p>提交的时候也是按照镜像的层级来提交的！</p>
<h3 id="发布到阿里云容器服务"><a href="#发布到阿里云容器服务" class="headerlink" title="发布到阿里云容器服务"></a>发布到阿里云容器服务</h3><p>1、登录阿里云官网，进入容器镜像服务。</p>
<p>2、创建个人版实例，进入实例，创建命名空间。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic1.imgdb.cn/item/63369d7b16f2c2beb16c3d57.png"></p>
<p>3、创建镜像仓库。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic1.imgdb.cn/item/63369d9616f2c2beb16c58ea.png"></p>
<p>4、浏览阿里云信息，根据提示提交镜像。（参考官方文档即可）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic1.imgdb.cn/item/63369da616f2c2beb16c69e1.png"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ tomcat-log]# docker tag 472f0f0c1970 registry.cn-zhangjiakou.aliyuncs.com/gaozheng-test/gaozheng-test2022:1.0</span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ tomcat-log]# docker push registry.cn-zhangjiakou.aliyuncs.com/gaozheng-test/gaozheng-test2022:1.0</span><br><span class="line">The push refers to repository [registry.cn-zhangjiakou.aliyuncs.com/gaozheng-test/gaozheng-test2022]</span><br><span class="line">80c6f89de9c4: Pushing [&gt;                                                  ]  3.275MB/226.1MB</span><br><span class="line">51c23c1501c0: Pushing [========&gt;                                          ]  2.621MB/14.78MB</span><br><span class="line">84ecaa5f6aa8: Pushing [&gt;                                                  ]  2.751MB/365.3MB</span><br><span class="line">730d3dc62dc7: Pushed </span><br><span class="line">174f56854903: Pushing [=&gt;                                                 ]  4.875MB/203.9MB</span><br></pre></td></tr></table></figure>

<h1 id="Docker-网络"><a href="#Docker-网络" class="headerlink" title="Docker 网络"></a>Docker 网络</h1><p>​		Docker 网络：也叫 <code>Docker0</code>。</p>
<p>查看基本 IP：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# ip address</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">lo：本地回环地址 127.0.0.1</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">eth0：阿里云内网地址 172.21.218.169</span></span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:16:99:95 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.21.218.169/20 brd 172.21.223.255 scope global dynamic noprefixroute eth0</span><br><span class="line">       valid_lft 301453785sec preferred_lft 301453785sec</span><br><span class="line">    inet6 fe80::216:3eff:fe16:9995/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker0：docker 生成的网卡 172.17.0.1</span></span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    link/ether 02:42:a1:41:ea:ce brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:a1ff:fe41:eace/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p><code>问题</code>：docker 是如何处理容器网络访问的呢？</p>
<h2 id="主机容器通信"><a href="#主机容器通信" class="headerlink" title="主机容器通信"></a>主机容器通信</h2><blockquote>
<p>测试：使用一个 Tomcat 容器测试<code>容器外能不能 ping 通 容器内</code>呢？</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拉取 tomcat 镜像并启动</span></span><br><span class="line">docker run -d  -p 10001:8080 --name tomcat tomcat</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入 tomcat 容器，并打印 ip 地址</span></span><br><span class="line">docker exec -it tomcat ip addr</span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker  exec -it tomcat ip addr</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">lo：本地回环地址 127.0.0.1</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">eth0@if111 地址是 docker 分配的</span></span><br><span class="line">110: eth0@if111: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">那么 linux 主机能不能 ping 通容器内部呢？ ======&gt; 可以 ping 通</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.052 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.055 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=3 ttl=64 time=0.055 ms</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现一个奇特之处：docker 本身地址是 172.17.0.1（类似于生活中路由器的地址），给 tomcat 容器分配的是 172.17.0.2，二者在同一网段</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>此处使用 ipaddr 时可能会有问题：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker exec -it tomcat ip addr</span><br><span class="line">OCI runtime exec failed: exec failed: container_linux.go:380: starting container process caused: exec: &quot;ip&quot;: executable file not found in $PATH: unknown</span><br></pre></td></tr></table></figure>

<p>​		这是由于 docker 内部的 tomcat 容器是精简版的，并没有 ip addr 命令可以使用。&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; <code>安装 iproute2 工具</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、进入容器内部</span></span><br><span class="line">docker  exec -it tomcat /bin/bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、安装工具</span></span><br><span class="line">apt install -y iproute2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3、发现下载不成功：是由于镜像过慢导致，因此需要更改系统镜像配置</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入配置文件</span></span><br><span class="line">cd /etc/apt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看目录信息</span></span><br><span class="line">ls</span><br><span class="line">cat sources.list</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">备份</span></span><br><span class="line">mkdir cat sources.list.backup</span><br><span class="line">cp sources.list ./sources.list.backup</span><br><span class="line">cd ../</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">以覆盖+追加的方式替换掉sources.list文件</span></span><br><span class="line">echo &#x27;deb https://mirrors.aliyun.com/debian bullseye main&#x27;&gt;sources.list</span><br><span class="line">echo &#x27;deb https://mirrors.aliyun.com/debian-security bullseye-security main&#x27;&gt;&gt;sources.list</span><br><span class="line">echo &#x27;deb https://mirrors.aliyun.com/debian bullseye-updates main&#x27;&gt;&gt;sources.list</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行一下更新命令：</span></span><br><span class="line">apt-get update -y</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行下载 iproute2命令：</span></span><br><span class="line">apt install -y iproute2</span><br></pre></td></tr></table></figure>
</blockquote>
<p><code>发现</code>：</p>
<p>1）只要安装了 docker，就会有一个网卡 <code>docker0</code>，采用的桥接模式，使用的是 veth-pair 技术。</p>
<p>2）当我们启动一个 docker 容器时，docker 就会给该容器分配一个 ip。</p>
<p>3）再次查看 ip addr 发现多了一个地址 <code>111: vethb003a6f@if110</code>，和该容器内部的那个 ip 有一定关系。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:16:99:95 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.21.218.169/20 brd 172.21.223.255 scope global dynamic noprefixroute eth0</span><br><span class="line">       valid_lft 301452124sec preferred_lft 301452124sec</span><br><span class="line">    inet6 fe80::216:3eff:fe16:9995/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:a1:41:ea:ce brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:a1ff:fe41:eace/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">111: vethb003a6f@if110: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether ea:7e:3b:85:26:c4 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet6 fe80::e87e:3bff:fe85:26c4/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<blockquote>
<p>发现容器启动时分配的网卡都是一对一对的：容器内 110: eth0@if111，容器外 111: vethb003a6f@if110</p>
<p>这就是 veth-pair 技术的体现：veth-pair 就是一对的虚拟设备接口，因此都是成对出现，一端连着协议，一端彼此相连。</p>
<p>正因为有这个特性，veth-pair 就能充当一个桥梁，连接各种虚拟网络设备。</p>
<p>举例：上面<code>主机分配的是 111，容器内部分配的 110，而 110 和 111 又通过接口进行了绑定，因此可以 ping 通</code>。</p>
</blockquote>
<h2 id="容器间通信"><a href="#容器间通信" class="headerlink" title="容器间通信"></a>容器间通信</h2><p>​		此时再启动一个 tomcat，那么两个 tomcat 之间可以直接 ping 通吗？</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动tomcat02</span></span><br><span class="line">docker run -d  -P --name tomcat02 tomcat</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查 ip addr，发现又分配了一对新的 ip</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# ip addr</span><br><span class="line">......</span><br><span class="line">113: veth7d69004@if112: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether 12:0a:61:f7:d6:6f brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br><span class="line">    inet6 fe80::100a:61ff:fef7:d66f/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br></pre></td></tr></table></figure>

<p>进入容器内部，检查 ip 发现 tomcat02 ip为：172.17.0.3，和 tomcat 172.17.0.2，以及主机 docker 路由 172.17.0.1 都处于同一个网段。</p>
<p>因此：<code>容器和容器间都是可以 ping 通的</code>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/cce22e1584b349f69aa07c6a01ad9d1e.png" alt="在这里插入图片描述"></p>
<blockquote>
<p><code>备注</code>：上图为网络简图，对应自己的网络 ip 关系为：</p>
<p>1）264: veth2d06abc@if263 对应 113: veth7d69004@if112</p>
<p>2）261: eth0@if262 对应 110: eth0@if111</p>
<p>3）以此类推 . . . . . . </p>
</blockquote>
<p>结论：</p>
<p>1）tomcat01 和 tomcat02公用一个路由器，docker0。</p>
<p>所有的容器不指定网络的情况下，都是 docker0 路由的，docker 会给我们的容器分配一个默认的可用ip（最多 65535 个）。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/16e851ba1eb142059cb0461d5ecc2f30.png" alt="在这里插入图片描述"></p>
<p>小结： <code>Docker使用的是Linux的桥接</code>，<code>宿主机是一个 Docker 容器的网桥 docker0</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/690de016b877403296c0ec5edd23e370.png" alt="在这里插入图片描述"></p>
<p>Docker 中的所有的网络接口都是虚拟的 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; 虚拟的转发效率高，只要容器删除，对应网桥一对就消失。</p>
<h2 id="容器互联"><a href="#容器互联" class="headerlink" title="容器互联"></a>容器互联</h2><p>思考：我们编写了一个微服务，database url&#x3D;ip: ，项目不重启，但数据库 ip 地址换了，我们希望可以处理这个问题，可以通过服务名字来进行访问容器？</p>
<p>即<code>直接通过网路，直接通过服务名，而不通过 IP 直接就 ping 通</code>，如何做到呢？	&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;》 <code>--link</code>技术</p>
<blockquote>
<p><code>解决 docker 容器内部没有 ifconfig 或 ping 命令</code>：ping 命令的使用需要安装，而阉割版的并没有安装。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt install net-tools</span><br></pre></td></tr></table></figure>

<p>此种方法可以解决 ifconfig 命令（查看 ip addr 地址）的使用，但是 ping 命令安装由于镜像再次出现问题。&#x3D;&#x3D;&#x3D;&gt; <code>配置镜像</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入配置文件</span></span><br><span class="line">cd /etc/apt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看目录信息</span></span><br><span class="line">ls</span><br><span class="line">cat sources.list</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">备份</span></span><br><span class="line">mkdir cat sources.list.backup</span><br><span class="line">cp sources.list ./sources.list.backup</span><br><span class="line">cd ../</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">以覆盖+追加的方式替换掉sources.list文件</span></span><br><span class="line">echo &#x27;deb https://mirrors.aliyun.com/debian bullseye main&#x27;&gt;sources.list</span><br><span class="line">echo &#x27;deb https://mirrors.aliyun.com/debian-security bullseye-security main&#x27;&gt;&gt;sources.list</span><br><span class="line">echo &#x27;deb https://mirrors.aliyun.com/debian bullseye-updates main&#x27;&gt;&gt;sources.list</span><br></pre></td></tr></table></figure>

<p>再进行 ping 命令工具的安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install iputils-ping</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">直接通过 tomcat ping tomcat02 的服务名</span></span><br><span class="line">docker exec -it tomcat ping tomca02</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现报错信息：</span></span><br><span class="line">tomca02: Name or service not known</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行一个 tomcat03 同时使用 --<span class="built_in">link</span> 到 tomcat 上</span></span><br><span class="line">docker run -d -P --name tomcat03 --link tomcat tomcat</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">再次用 tomcat03 ping tomcat ，发现可以 ping 通</span></span><br><span class="line">docker exec -it tomcat03 ping tomcat </span><br><span class="line">PING tomcat (172.17.0.4) 56(84) bytes of data.64 bytes from tomcat (172.17.0.2): icmp_seq=1 ttl=64 time=0.115 ms64 bytes from tomcat02 (172.17.0.3): icmp_seq=2 ttl=64 time=0.080 ms</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">再用 tomcat ping tomcat03 ，发现 ping 不通？反向并不能 ping 通 =====&gt; 需要重启 tomcat 并设置 --<span class="built_in">link</span> 连接到 tomcat03 上才行</span></span><br></pre></td></tr></table></figure>

<p>探究：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用 docker network inspect 命令可以查看 docker 的网络互连情况</span></span><br><span class="line">docker network inspect</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看某个容器具体的情况配置：</span></span><br><span class="line">docker inspect tomcat03</span><br></pre></td></tr></table></figure>

<p>发现：实际上 <code>--link</code> 原理就是在该容器内的 <code>hosts 配置文件中加入了 服务名映射成地址的配置</code>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/ac76669d0bae4229914b73e2ffdf98a9.png" alt="在这里插入图片描述"></p>
<p>注意：现在使用 Docker已经不建议使用 –link了，而<code>推荐使用自定义网络</code>，不使用 docker0 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; docker0 问题：不支持容器名连接访问。</p>
<h2 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a>自定义网络</h2><p>​		<code>容器互联</code>方式：–link 和 自定义网络。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看网络设置帮助信息</span></span><br><span class="line">docker network --help</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看所有的当前网络</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">288ccd8ca3a1   bridge    bridge    local</span><br><span class="line">23b1f23a2f96   host      host      local</span><br><span class="line">8e93e74e8004   none      null      local</span><br></pre></td></tr></table></figure>

<blockquote>
<p>网络模式：</p>
<p>1）桥接（bridge）默认的设置：自己创建的也使用桥接模式</p>
<p>2）不配置网络（none）</p>
<p>3）和宿主共享网络（host）</p>
<p>4）docker 内还提供了 container 模式：容器内网络联通（不建议使用，局限很大）</p>
</blockquote>
<p>原来的启动方式：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -P --name tomcat01 tomcat</span><br></pre></td></tr></table></figure>

<p>实际上此处是省略了网络默认参数（等价于）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -P --name tomcat01 --net bridge tomcat</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker0 特点：默认，域名不能访问。 --<span class="built_in">link</span> 可以打通连接，但是很麻烦，一般不会使用</span></span><br></pre></td></tr></table></figure>

<p>自定义网络：<code>create</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--driver bridge，默认的，桥接</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--subnet 192.168.0.0/16  子网，65535 个：192.168.0.2 ~ 192.168.255.255</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--gateway 192.168.0.1  网关，相当于路由器地址</span></span><br><span class="line">docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span><br><span class="line"></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">288ccd8ca3a1   bridge    bridge    local</span><br><span class="line">23b1f23a2f96   host      host      local</span><br><span class="line">c616824ae5a6   mynet     bridge    local</span><br><span class="line">8e93e74e8004   none      null      local</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看自己网络的配置</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;mynet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;c616824ae5a61e76502dfe2a9835fd9e163854311894f471c260f632954f1fef&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2022-06-07T13:23:38.461668942+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>之后的服务便可以放在自己的网络里面，例如测试启动 tomcat，使用自己的网络：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动 tomcat-net-01</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker run -d -P --name tomcat-net-01 --net mynet tomcat</span><br><span class="line">7c7679fa22912920c31bf69e870b4d3d4ab40ee9e06b1e816ec97ae7ac3b3dd3</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动 tomcat-net-02</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker run -d -P --name tomcat-net-02 --net mynet tomcat</span><br><span class="line">7c57392ad52f5a429a5cd1e41468e8c9e03881773a346b4223203f7efd920b5e</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">再查看网络，发现自己的网络下有两个容器</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;mynet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;c616824ae5a61e76502dfe2a9835fd9e163854311894f471c260f632954f1fef&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2022-06-07T13:23:38.461668942+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        # 具体的容器实例，分配的 IP 是之前使用的。</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;7c57392ad52f5a429a5cd1e41468e8c9e03881773a346b4223203f7efd920b5e&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-net-02&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;a32d75da1f219aab73a2be733029096e5f2149ddf26edc20076b6746e1e8566d&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;7c7679fa22912920c31bf69e870b4d3d4ab40ee9e06b1e816ec97ae7ac3b3dd3&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-net-01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;f7fd34737778a32a0d1246bbdd3def0cb33fef8b71fbd3ee1a9c96ec95259a60&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>此时便可以是直接 ping 通其他的容器：</p>
<p>1）通过 IP ping，可以 ping 通。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it tomcat-net-01 ping 192.168.0.3</span><br></pre></td></tr></table></figure>

<p>2）直接通过容器名称 ping，可以 ping 通。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it tomcat-net-01 ping tomcat-net-02</span><br></pre></td></tr></table></figure>

<p>现在不使用 –link 就可以使用容器名称访问。	&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; 自定义网络已经维护好了对应的关系，因此<code>推荐使用这种方式</code>。</p>
<blockquote>
<p>优点之处：</p>
<ul>
<li>redis ： 不同的集群使用不同的网络，保证集群是安全和健康的。</li>
<li>mysql：不同的集群使用不同的网络，保证集群是安全和健康的。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/6184a7c2d3b3460983a5463dafb0f05f.png" alt="在这里插入图片描述"></p>
</blockquote>
<h2 id="网络联通"><a href="#网络联通" class="headerlink" title="网络联通"></a>网络联通</h2><p>​		现在已经有两个网络：默认的 docker0、自己定义的 mynet，那么不同的网络内的应用怎么 ping 通呢？&#x3D;&#x3D;&#x3D;&#x3D;&gt; <code>直接连是不可能的</code>（ping 不通，<code>不同网段</code>）</p>
<p>这个时候就希望 <code>docker0 里面具体的应用</code> 和 mynet 联通（因为正常情况两个网络直接进行联通是不可能的），此时就需要使用到 <code>connect</code> 操作。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker network --help</span><br><span class="line"></span><br><span class="line">Usage:  docker network COMMAND</span><br><span class="line"></span><br><span class="line">Manage networks</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">connect 操作就可以实现一个网络内部容器联通到另一个网络</span></span><br><span class="line">  connect     Connect a container to a network</span><br><span class="line">  create      Create a network</span><br><span class="line">  disconnect  Disconnect a container from a network</span><br><span class="line">  inspect     Display detailed information on one or more networks</span><br><span class="line">  ls          List networks</span><br><span class="line">  prune       Remove all unused networks</span><br><span class="line">  rm          Remove one or more networks</span><br><span class="line"></span><br><span class="line">Run &#x27;docker network COMMAND --help&#x27; for more information on a command.</span><br></pre></td></tr></table></figure>

<p>测试：联通 docker0 网络里的 tomcat01 联通到 mynet。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动一个默认网络（docker0）的 tomcat 容器</span></span><br><span class="line">docker run -d -P --name tomcat01 tomcat</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">直接 ping 另一个网络里面的容器 （ping 不通）</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker exec -it tomcat01 ping 192.168.0.2</span><br><span class="line">PING 192.168.0.2 (192.168.0.2) 56(84) bytes of data.</span><br><span class="line">--- 192.168.0.2 ping statistics ---</span><br><span class="line">53 packets transmitted, 0 received, 100% packet loss, time 53254ms</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">联通 tomcat01 和 mynet</span></span><br><span class="line">docker network connect mynet tomcat01</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">再次查看 mynet 内部的容器信息</span></span><br><span class="line">docker network inspect mynet</span><br><span class="line">......</span><br><span class="line">&quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;6b1f8aa8ff7ffeb8ffd47a2134943ad641bb90709ddbb3f3d2bee397e195d7b0&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;2612fb3b4ac0bd1c67ee5106d33f9bd74694cbf1822cc95d31186145d31a442e&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:04&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.4/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;7c57392ad52f5a429a5cd1e41468e8c9e03881773a346b4223203f7efd920b5e&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-net-02&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;a32d75da1f219aab73a2be733029096e5f2149ddf26edc20076b6746e1e8566d&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;7c7679fa22912920c31bf69e870b4d3d4ab40ee9e06b1e816ec97ae7ac3b3dd3&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-net-01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;f7fd34737778a32a0d1246bbdd3def0cb33fef8b71fbd3ee1a9c96ec95259a60&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">......</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现联通之后直接将 tomcat01 放到了 mynet 网络下 ======&gt; 一个容器有两个 IP ：类似于阿里云服务器，一个公网 IP，一个私网 IP</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">再次 ping 测试，ping 通</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker exec -it tomcat01 ping 192.168.0.2</span><br><span class="line">PING 192.168.0.2 (192.168.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.0.2: icmp_seq=1 ttl=64 time=0.138 ms</span><br><span class="line">64 bytes from 192.168.0.2: icmp_seq=2 ttl=64 time=0.078 ms</span><br><span class="line">......</span><br><span class="line">--- 192.168.0.2 ping statistics ---</span><br><span class="line">6 packets transmitted, 6 received, 0% packet loss, time 5079ms</span><br></pre></td></tr></table></figure>

<p><code>结论</code>：假设要跨网络操作别人，就需要使用 docker network connect 连通。</p>
<h1 id="Redis-集群"><a href="#Redis-集群" class="headerlink" title="Redis 集群"></a>Redis 集群</h1><p>​		实战测试：搭建一个分片的 Redis 集群（一主一从，主机宕机从机顶替），需要一个 redis 的单独网卡（网络）。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/5d90a471e0a34f2bafd51a05be204bf9.png" alt="在这里插入图片描述"></p>
<p>1、搭建 redis 集群：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建 redis 单独的网络</span></span><br><span class="line">docker network create redis --subnet 172.38.0.0/16</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">redis 是需要设置配置文件的，利用脚本一次性配置六个redis配置文件（直接命令行执行）</span></span><br><span class="line">for port in $(seq 1 6);\</span><br><span class="line">do \</span><br><span class="line">mkdir -p /mydata/redis/node-$&#123;port&#125;/conf</span><br><span class="line">touch /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">cat &lt;&lt; EOF &gt;&gt; /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">port 6379</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.38.0.1$&#123;port&#125;</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br><span class="line">appendonly yes</span><br><span class="line">EOF</span><br><span class="line">done</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">此时六个 redis 的配置文件已经配置</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# cd /mydata/redis</span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ redis]# ls</span><br><span class="line">node-1  node-2  node-3  node-4  node-5  node-6</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建 redis 容器</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-p 6371:6379 -p 16671:16379 端口映射</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--name redis-1 容器名</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-v 挂载数据卷</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--net 设置自己的 redis 网络</span></span><br><span class="line">docker run -p 6371:6379 -p 16671:16379 --name redis-1 \</span><br><span class="line">-v /mydata/redis/node-1/data:/data \</span><br><span class="line">-v /mydata/redis/node-1/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.11 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6376:6379 -p 16676:16379 --name redis-6 \</span><br><span class="line">-v /mydata/redis/node-6/data:/data \</span><br><span class="line">-v /mydata/redis/node-6/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.16 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">也可以通过脚本运行六个redis 容器</span></span><br><span class="line">for port in $(seq 1 6);\</span><br><span class="line">docker run -p 637$&#123;port&#125;:6379 -p 1667$&#123;port&#125;:16379 --name redis-$&#123;port&#125; \</span><br><span class="line">-v /mydata/redis/node-$&#123;port&#125;/data:/data \</span><br><span class="line">-v /mydata/redis/node-$&#123;port&#125;/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.1$&#123;port&#125; redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查启动情况</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ conf]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE                    COMMAND                  CREATED              STATUS              PORTS                                                                                      NAMES</span><br><span class="line">88f54f6d602f   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   3 seconds ago        Up 2 seconds        0.0.0.0:6376-&gt;6379/tcp, :::6376-&gt;6379/tcp, 0.0.0.0:16676-&gt;16379/tcp, :::16676-&gt;16379/tcp   redis-6</span><br><span class="line">5befb3e34787   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   26 seconds ago       Up 25 seconds       0.0.0.0:6375-&gt;6379/tcp, :::6375-&gt;6379/tcp, 0.0.0.0:16675-&gt;16379/tcp, :::16675-&gt;16379/tcp   redis-5</span><br><span class="line">614913cf587d   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   About a minute ago   Up 59 seconds       0.0.0.0:6374-&gt;6379/tcp, :::6374-&gt;6379/tcp, 0.0.0.0:16674-&gt;16379/tcp, :::16674-&gt;16379/tcp   redis-4</span><br><span class="line">a692733820e6   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   About a minute ago   Up About a minute   0.0.0.0:6373-&gt;6379/tcp, :::6373-&gt;6379/tcp, 0.0.0.0:16673-&gt;16379/tcp, :::16673-&gt;16379/tcp   redis-3</span><br><span class="line">d9acd17b3d86   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   2 minutes ago        Up 2 minutes        0.0.0.0:6372-&gt;6379/tcp, :::6372-&gt;6379/tcp, 0.0.0.0:16672-&gt;16379/tcp, :::16672-&gt;16379/tcp   redis-2</span><br><span class="line">c827cb1cbedc   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   3 minutes ago        Up 3 minutes        0.0.0.0:6371-&gt;6379/tcp, :::6371-&gt;6379/tcp, 0.0.0.0:16671-&gt;16379/tcp, :::16671-&gt;16379/tcp   redis-1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建集群，注意 redis 里面没有 bash 命令，只有 sh 命令</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、进入redis-1</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ conf]# docker exec -it redis-1 /bin/sh</span><br><span class="line">/data # ls</span><br><span class="line">appendonly.aof  nodes.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">appendonly.aof 为 aof 持久化配置</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nodes.conf 为节点配置</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、创建集群</span></span><br><span class="line">/data # redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span></span><br><span class="line">Master[0] -&gt; Slots 0 - 5460</span><br><span class="line">Master[1] -&gt; Slots 5461 - 10922</span><br><span class="line">Master[2] -&gt; Slots 10923 - 16383</span><br><span class="line">Adding replica 172.38.0.15:6379 to 172.38.0.11:6379</span><br><span class="line">Adding replica 172.38.0.16:6379 to 172.38.0.12:6379</span><br><span class="line">Adding replica 172.38.0.14:6379 to 172.38.0.13:6379</span><br><span class="line">M: 0231dff34b823d8dde232677ec64fe1558771b7d 172.38.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">M: 1b23cb1f6ce963ce9a348f6982c2e33cd0488bc5 172.38.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">M: 6cef12e5bd1836dda4951321b7599f01bc60bfec 172.38.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">S: 4d2d9a42da3629aee577770857df04d0fc733136 172.38.0.14:6379</span><br><span class="line">   replicates 6cef12e5bd1836dda4951321b7599f01bc60bfec</span><br><span class="line">S: 982a6a404d29df12eab71d2a05d4d1d0c248af88 172.38.0.15:6379</span><br><span class="line">   replicates 0231dff34b823d8dde232677ec64fe1558771b7d</span><br><span class="line">S: a9ca8b55cc795f2a0f5e6dd20e8183287a068b47 172.38.0.16:6379</span><br><span class="line">   replicates 1b23cb1f6ce963ce9a348f6982c2e33cd0488bc5</span><br><span class="line">Can I set the above configuration? (type &#x27;yes&#x27; to accept): yes</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Nodes configuration updated</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Assign a different config epoch to each node</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Sending CLUSTER MEET messages to <span class="built_in">join</span> the cluster</span></span><br><span class="line">Waiting for the cluster to join</span><br><span class="line">...</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Performing Cluster Check (using node 172.38.0.11:6379)</span></span><br><span class="line">M: 0231dff34b823d8dde232677ec64fe1558771b7d 172.38.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: a9ca8b55cc795f2a0f5e6dd20e8183287a068b47 172.38.0.16:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 1b23cb1f6ce963ce9a348f6982c2e33cd0488bc5</span><br><span class="line">M: 1b23cb1f6ce963ce9a348f6982c2e33cd0488bc5 172.38.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 982a6a404d29df12eab71d2a05d4d1d0c248af88 172.38.0.15:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 0231dff34b823d8dde232677ec64fe1558771b7d</span><br><span class="line">S: 4d2d9a42da3629aee577770857df04d0fc733136 172.38.0.14:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 6cef12e5bd1836dda4951321b7599f01bc60bfec</span><br><span class="line">M: 6cef12e5bd1836dda4951321b7599f01bc60bfec 172.38.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">此时证明集群创建成功</span></span><br></pre></td></tr></table></figure>

<p>2、redis 集群的使用：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">连接到集群客户端</span></span><br><span class="line">/data # redis-cli -c</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看集群信息</span></span><br><span class="line">127.0.0.1:6379&gt; cluster info</span><br><span class="line">cluster_state:ok</span><br><span class="line">cluster_slots_assigned:16384</span><br><span class="line">cluster_slots_ok:16384</span><br><span class="line">cluster_slots_pfail:0</span><br><span class="line">cluster_slots_fail:0</span><br><span class="line">cluster_known_nodes:6</span><br><span class="line">cluster_size:3		# 集群主机数量</span><br><span class="line">cluster_current_epoch:6</span><br><span class="line">cluster_my_epoch:1</span><br><span class="line">cluster_stats_messages_ping_sent:287</span><br><span class="line">cluster_stats_messages_pong_sent:303</span><br><span class="line">cluster_stats_messages_sent:590</span><br><span class="line">cluster_stats_messages_ping_received:298</span><br><span class="line">cluster_stats_messages_pong_received:287</span><br><span class="line">cluster_stats_messages_meet_received:5</span><br><span class="line">cluster_stats_messages_received:590</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看集群节点信息：三主三从</span></span><br><span class="line">127.0.0.1:6379&gt; cluster nodes</span><br><span class="line">0231dff34b823d8dde232677ec64fe1558771b7d 172.38.0.11:6379@16379 myself,master - 0 1654582806000 1 connected 0-5460</span><br><span class="line">a9ca8b55cc795f2a0f5e6dd20e8183287a068b47 172.38.0.16:6379@16379 slave 1b23cb1f6ce963ce9a348f6982c2e33cd0488bc5 0 1654582807596 6 connected</span><br><span class="line">1b23cb1f6ce963ce9a348f6982c2e33cd0488bc5 172.38.0.12:6379@16379 master - 0 1654582808596 2 connected 5461-10922</span><br><span class="line">982a6a404d29df12eab71d2a05d4d1d0c248af88 172.38.0.15:6379@16379 slave 0231dff34b823d8dde232677ec64fe1558771b7d 0 1654582807000 5 connected</span><br><span class="line">4d2d9a42da3629aee577770857df04d0fc733136 172.38.0.14:6379@16379 slave 6cef12e5bd1836dda4951321b7599f01bc60bfec 0 1654582808000 4 connected</span><br><span class="line">6cef12e5bd1836dda4951321b7599f01bc60bfec 172.38.0.13:6379@16379 master - 0 1654582808596 3 connected 10923-16383</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">目前集群都是正常的</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">插入数据测试</span></span><br><span class="line">127.0.0.1:6379&gt; set a &quot;b&quot;</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">Redirected to slot [15495] located at 172.38.0.13:6379</span></span><br><span class="line">OK</span><br><span class="line">172.38.0.13:6379&gt; set aa &quot;bb&quot;</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">Redirected to slot [1180] located at 172.38.0.11:6379</span></span><br><span class="line">OK</span><br><span class="line">172.38.0.11:6379&gt; set aaa &quot;bbb&quot;</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">Redirected to slot [10439] located at 172.38.0.12:6379</span></span><br><span class="line">OK</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">插入数据被分发到各个主机</span></span><br></pre></td></tr></table></figure>

<p>3、redis 高可用性测试：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">停止 172.38.0.13:6379 的 redis 容器</span></span><br><span class="line">docker stop redis-3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">此时测试能否得到 key=a 的值</span></span><br><span class="line">127.0.0.1:6379&gt; get a</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">Redirected to slot [15495] located at 172.38.0.14:6379</span></span><br><span class="line">&quot;b&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现从机 redis-4 顶替了主机 redis-3</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">此时查看节点信息，发现 redis-3处于：fail 状态，同时 redis-4 变成了 master</span></span><br><span class="line">127.0.0.1:6379&gt; cluster nodes</span><br><span class="line">0231dff34b823d8dde232677ec64fe1558771b7d 172.38.0.11:6379@16379 myself,master - 0 1654583289000 1 connected 0-5460</span><br><span class="line">a9ca8b55cc795f2a0f5e6dd20e8183287a068b47 172.38.0.16:6379@16379 slave 1b23cb1f6ce963ce9a348f6982c2e33cd0488bc5 0 1654583289495 6 connected</span><br><span class="line">1b23cb1f6ce963ce9a348f6982c2e33cd0488bc5 172.38.0.12:6379@16379 master - 0 1654583289997 2 connected 5461-10922</span><br><span class="line">982a6a404d29df12eab71d2a05d4d1d0c248af88 172.38.0.15:6379@16379 slave 0231dff34b823d8dde232677ec64fe1558771b7d 0 1654583290498 5 connected</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">redis-4 变成了 master</span></span><br><span class="line">4d2d9a42da3629aee577770857df04d0fc733136 172.38.0.14:6379@16379 `master` - 0 1654583289000 7 connected 10923-16383</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">redis-3处于：fail 状态</span></span><br><span class="line">6cef12e5bd1836dda4951321b7599f01bc60bfec 172.38.0.13:6379@16379 `master,fail` - 1654583239508 1654583238507 3 connected</span><br></pre></td></tr></table></figure>

<h1 id="Boot-项目打包镜像"><a href="#Boot-项目打包镜像" class="headerlink" title="Boot 项目打包镜像"></a>Boot 项目打包镜像</h1><p>1、构建 SpringBoot 项目：demo，当前版本：2.7.0 版本，编写一个基本的 controller，本地测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello,Dockerfile&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、利用 IDEA 的 maven 工具栏打包，或者使用命令打包：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn package</span><br></pre></td></tr></table></figure>

<p>同时，将 jar 包命令行运行测试，验证成功启动。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar demo-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>

<p>3、编写 Dockerfile 文件，此时需要在 IDEA 中装一个插件：Docker （默认已安装），此时在根目录下创建文件 Dockerfile，会有一个专属图标。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发布时只发布 jar 包 和 Dockerfile 文件</span></span><br><span class="line">FROM java:8</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">复制 jar 包并重命名</span></span><br><span class="line">COPY *.jar /demo.jar</span><br><span class="line">CMD [&quot;--server.port=8080&quot;]</span><br><span class="line">EXPOSE 8080</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行命令</span></span><br><span class="line">ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;demo.jar&quot;]</span><br></pre></td></tr></table></figure>

<p>4、上传 Dockerfile 脚本文件和 jar 包到服务器 <code>/home/gaozheng/idea</code>目录（只需要这两个文件），再进行镜像的构建。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看文件</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ idea]# ls</span><br><span class="line">demo-0.0.1-SNAPSHOT.jar  Dockerfile</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">构建镜像</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ idea]# docker build -t gaozheng/hellodemo:1.0 .</span><br><span class="line">Sending build context to Docker daemon  17.61MB</span><br><span class="line">Step 1/5 : FROM java:8</span><br><span class="line">8: Pulling from library/java</span><br><span class="line">..................</span><br><span class="line">Successfully built a9deee2d9e96</span><br><span class="line">Successfully tagged gaozheng/hellodemo:1.0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看镜像</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ idea]# docker images</span><br><span class="line">REPOSITORY           TAG                IMAGE ID       CREATED         SIZE</span><br><span class="line">gaozheng/hellodemo   1.0                a9deee2d9e96   7 seconds ago   661MB</span><br><span class="line">java                 8                  d23bdf5b1b1b   5 years ago     643MB</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>5、发布运行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动容器</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ idea]# docker run -d -p 10001:8080 --name gaozheng-hello-demo gaozheng/hellodemo:1.0</span><br><span class="line">0aaf1f30627d8a08ccb1e75209e8dc39534f20bf2d06013da4e1e5b44668738d</span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ idea]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE                    COMMAND                  CREATED         STATUS         PORTS                                         NAMES</span><br><span class="line">0aaf1f30627d   gaozheng/hellodemo:1.0   &quot;java -jar demo.jar …&quot;   4 seconds ago   Up 2 seconds   0.0.0.0:10001-&gt;8080/tcp, :::10001-&gt;8080/tcp   gaozheng-hello-demo</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">访问测试：证实项目部署成功</span></span><br><span class="line">root@iZ8vb0l7sqdpurpvy5e77xZ idea]# curl localhost:10001/hello</span><br><span class="line">Hello,Dockerfile</span><br></pre></td></tr></table></figure>

<p>本地测试访问远程：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="D:\NoteBook\核心笔记\Linux\image\docker部署项目.png"></p>
<p>因此，以后可以直接<code>交付 镜像 </code>即可，但是微服务一次部署很多 jar 包（镜像），那该怎么解决呢？有没有一键部署方案呢？ &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; <code>Docker Compose</code></p>
<h1 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h1><p>​		之前的<code>单个服务</code>的部署方式：Dockerfile ——-&gt; build ——–&gt; run ，需要手动操作，构建、运行。但是一个整体的微服务项目包含很多个微服务模块，同时每个模块之间还有依赖关系，这又该怎么解决呢？<code>不可能一个个部署</code>！ &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; <code>Docker Compose 高效的管理容器，定义运行多个容器</code>。</p>
<p>1）使用 <code>Yaml</code> 作为配置文件，定义、运行多个容器的工具。</p>
<p>2）所有的环境（开发、测试等）都可以使用 Compose。</p>
<p>3）使用三步骤：Dockerfile(保证程序在任何位置能够运行)、docker-compose.yml 配置服务(容器)、docker-compose up 命令启动。</p>
<p>总结：<code>批量容器编排</code>。</p>
<blockquote>
<p>注意：Docker Compose 是 Docker 官方开源的项目，需要单独进行安装。</p>
</blockquote>
<h2 id="安装-Compose"><a href="#安装-Compose" class="headerlink" title="安装 Compose"></a>安装 Compose</h2><p>1、下载 Compose，等待下载完毕：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">官网下载地址 github</span></span><br><span class="line">sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">镜像下载地址：建议使用</span></span><br><span class="line">curl -L https://get.daocloud.io/docker/compose/releases/download/1.29.2/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<p>2、文件授权，未授权时文件夹为白色，授权后变为绿色：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">实际上就是一个二进制文件，由于放在 bin 目录，全局可以使用</span></span><br><span class="line">sudo chmod 777 /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者：<span class="built_in">chmod</span> +x /usr/local/bin/docker-compose</span></span><br></pre></td></tr></table></figure>

<p>3、安装检查：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ bin]# docker-compose version</span><br><span class="line">docker-compose version 1.29.2, build 5becea4c</span><br><span class="line">docker-py version: 5.0.0</span><br><span class="line">CPython version: 3.7.10</span><br><span class="line">OpenSSL version: OpenSSL 1.1.0l  10 Sep 2019</span><br></pre></td></tr></table></figure>

<h2 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h2><p>​		官方应用体验：python 的计数器应用，使用 redis 记录。</p>
<p>1、<code>/home</code>下创建存放文件夹：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir composetest</span><br><span class="line">cd composetest</span><br></pre></td></tr></table></figure>

<p>2、编写一个 python 脚本文件：<code>app.py</code></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">cache = redis.Redis(host=<span class="string">&#x27;redis&#x27;</span>, port=<span class="number">6379</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_hit_count</span>():</span><br><span class="line">    retries = <span class="number">5</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> cache.incr(<span class="string">&#x27;hits&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span> redis.exceptions.ConnectionError <span class="keyword">as</span> exc:</span><br><span class="line">            <span class="keyword">if</span> retries == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">raise</span> exc</span><br><span class="line">            retries -= <span class="number">1</span></span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>():</span><br><span class="line">    count = get_hit_count()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World! I have been seen &#123;&#125; times.\n&#x27;</span>.<span class="built_in">format</span>(count)</span><br></pre></td></tr></table></figure>

<p>3、创建一个依赖包文件：<code>requirements.txt</code></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flask</span><br><span class="line">redis</span><br></pre></td></tr></table></figure>

<p>4、创建 Dockerfile 脚本文件：<code>Dockerfile</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">syntax=docker/dockerfile:1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置基本环境包</span></span><br><span class="line">FROM python:3.7-alpine</span><br><span class="line">WORKDIR /code</span><br><span class="line">ENV FLASK_APP=app.py</span><br><span class="line">ENV FLASK_RUN_HOST=0.0.0.0</span><br><span class="line">RUN apk add --no-cache gcc musl-dev linux-headers</span><br><span class="line">COPY requirements.txt requirements.txt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装依赖包</span></span><br><span class="line">RUN pip install -r requirements.txt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">暴露端口</span></span><br><span class="line">EXPOSE 5000</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拷贝当前目录</span></span><br><span class="line">COPY . .</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行命令： flask run</span></span><br><span class="line">CMD [&quot;flask&quot;, &quot;run&quot;]</span><br></pre></td></tr></table></figure>

<p>5、编写 <code>docker-compose.yaml</code> 配置文件</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.9&quot;</span></span><br><span class="line"><span class="comment"># 包含服务：web 和 redis</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">  	<span class="comment"># 通过 dockerfile 文件构建镜像方式</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5000:5000&quot;</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="comment"># 通过官方镜像</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">&quot;redis:alpine&quot;</span></span><br></pre></td></tr></table></figure>

<p>6、当前文件夹下执行 <code>docker-compose up</code>启动。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">后台运行</span></span><br><span class="line">docker-compose up -d </span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/06/17/kuangstudy4aef27a5-1b11-4e7a-baeb-67e5ed689af4.png" alt="img"></p>
<p>7、检查运行测试效果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# curl localhost:5000</span><br><span class="line">Hello World! I have been seen 1 times.</span><br></pre></td></tr></table></figure>

<p>7、当前文件夹下执行 <code>docker-compose dowm</code> 或 <code>docker-compose stop</code> 停止所有服务。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose down</span><br><span class="line">docker-compose stop</span><br></pre></td></tr></table></figure>

<h2 id="执行流程"><a href="#执行流程" class="headerlink" title="执行流程"></a>执行流程</h2><p>1、创建网络：composetest_default（默认创建的）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker network ls</span><br><span class="line">NETWORK ID     NAME                  DRIVER    SCOPE</span><br><span class="line">288ccd8ca3a1   bridge                bridge    local</span><br><span class="line">35e6cb23a378   composetest_default   bridge    local</span><br><span class="line">23b1f23a2f96   host                  host      local</span><br><span class="line">8e93e74e8004   none                  null      local</span><br></pre></td></tr></table></figure>

<p>此时查看该网络内部细节发现：web 和 redis 两个容器已经添加到了该网络内，因此可以实现<code>通过域名访问</code>。（<code>项目部署的关键</code>）</p>
<blockquote>
<p>当未来部署多个微服务时，项目内部的依赖关系需要通过<code>服务名（域名）</code>进行访问，以避免在重启容器时，某些容器 IP 发生变化，导致系统不可用。而此处的创建默认网络，<code>实现容器之间互联</code>，则保证了<code>通过域名访问到具体的服务（容器）</code>。（Docker 网络原理）</p>
<p>例如，10 个实例都需要连接 mysql:3306 容器，这个时候就应该写成 mysql 作为连接，而<code>不是具体的 IP </code>。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker network inspect composetest_default</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;composetest_default&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;35e6cb23a37864bf4dbe2fb0116359bba7f7622ca16f34dc8496c9ab2e997002&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2022-06-07T16:00:09.792363205+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: null,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;172.18.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.18.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: true,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;1ba4b5a536e4fb8a85db06a76be18548afd7ce97052a4897274272119f4628da&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;composetest_redis_1&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;ea8d7f077431723b98a75b0cd6b9632118190fb8e1df31e73a63166667277822&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:12:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.18.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;7087704e057a8e56ee41de9026d6f3d25ffe619d9cd5f776de3e150249cb5999&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;composetest_web_1&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;64a4f9398c244361312498f11dac1de41afc71916b2dd474a42d3441f264d26c&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:12:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.18.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;</span><br><span class="line">            &quot;com.docker.compose.network&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;com.docker.compose.project&quot;: &quot;composetest&quot;,</span><br><span class="line">            &quot;com.docker.compose.version&quot;: &quot;1.29.2&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、执行 docker-compose.yml 文件：对容器进行编排。</p>
<p>3）启动所有的服务。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Creating composetest_web_1 ...</span><br><span class="line">Creating composetest_redis_1 ...</span><br><span class="line">Creating composetest_web_1 ... done</span><br><span class="line">Creating composetest_redis_1 ... done</span><br></pre></td></tr></table></figure>

<p>启动后检查 images 发现出现 dockerfile 里面定义的镜像，同时</p>
<blockquote>
<p>那么这个容器名（<code>composetest_web_1、composetest_redis_1</code>）怎么来的呢？</p>
</blockquote>
<p>文件夹名：composetest</p>
<p>services 名称：web、redis</p>
<p>名称最后的数字 1 是<code>集群</code>的副本数量，现实项目中不可能只有一个实例，往往都是弹性的，以求达到高可用。</p>
<h2 id="Yaml-规则"><a href="#Yaml-规则" class="headerlink" title="Yaml 规则"></a>Yaml 规则</h2><p>​	Yaml 配置文件是 Docker Compose 的核心。主要可以分为三层：<code>版本</code>、<code>服务</code>、<code>其他配置</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.9&quot; 		# 版本</span><br><span class="line">services：	# 服务</span><br><span class="line">  web：</span><br><span class="line"><span class="meta prompt_">   # </span><span class="language-bash">服务配置</span></span><br><span class="line">   images：</span><br><span class="line">   bulid：</span><br><span class="line">   ports:</span><br><span class="line">   network：</span><br><span class="line">   depends_on:</span><br><span class="line">   ...</span><br><span class="line">  redis:</span><br><span class="line">   ...</span><br><span class="line">  mysql：</span><br><span class="line">   ...</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">其他配置：网络配置、数据卷配置、全局规则等</span></span><br><span class="line">networks:</span><br><span class="line">  frontend:</span><br><span class="line">  backend:</span><br><span class="line">volumes:</span><br><span class="line">  db-data:</span><br><span class="line">configs：</span><br></pre></td></tr></table></figure>

<p>参考文档：<code>https://docs.docker.com/compose/compose-file/compose-file-v3/</code>。</p>
<h2 id="WP博客测试"><a href="#WP博客测试" class="headerlink" title="WP博客测试"></a>WP博客测试</h2><p>以 WordPress 博客开源项目（<code>https://docs.docker.com/samples/wordpress/</code>）为例，实战部署测试。</p>
<p>1、创建一个项目文件夹：<code>/home/my_wordpress</code></p>
<p>2、创建 docker-compose.yaml 文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">版本</span></span><br><span class="line">version: &quot;3.9&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">服务</span>  </span><br><span class="line">services:</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">服务 db</span></span><br><span class="line">  db:</span><br><span class="line">    # 使用镜像 mysql:5.7</span><br><span class="line">    image: mysql:5.7</span><br><span class="line">    # 挂载数据卷，db_data 具体位置在下面其他配置处定义</span><br><span class="line">    volumes:</span><br><span class="line">      - db_data:/var/lib/mysql</span><br><span class="line">    # 总是开机重启</span><br><span class="line">    restart: always</span><br><span class="line">    # 环境配置</span><br><span class="line">    environment:</span><br><span class="line">      MYSQL_ROOT_PASSWORD: somewordpress</span><br><span class="line">      MYSQL_DATABASE: wordpress</span><br><span class="line">      MYSQL_USER: wordpress</span><br><span class="line">      MYSQL_PASSWORD: wordpress</span><br><span class="line">  </span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">服务 wordpress</span></span><br><span class="line">  wordpress:</span><br><span class="line">    # 依赖于 db 服务，即指定 db 服务先启动</span><br><span class="line">    depends_on:</span><br><span class="line">      - db</span><br><span class="line">    # 使用镜像 wordpress:latest</span><br><span class="line">    image: wordpress:latest</span><br><span class="line">    # 挂载数据卷，wordpress_data</span><br><span class="line">    volumes:</span><br><span class="line">      - wordpress_data:/var/www/html</span><br><span class="line">    # 端口映射到 8000</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;8000:80&quot;</span><br><span class="line">    restart: always</span><br><span class="line">    # 环境配置</span><br><span class="line">    environment:</span><br><span class="line">      WORDPRESS_DB_HOST: db</span><br><span class="line">      WORDPRESS_DB_USER: wordpress</span><br><span class="line">      WORDPRESS_DB_PASSWORD: wordpress</span><br><span class="line">      WORDPRESS_DB_NAME: wordpress</span><br><span class="line">      </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">其他设置</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">数据卷指定，此处不做持久化，只是单纯测试，因此不指定</span></span><br><span class="line">volumes:</span><br><span class="line">  db_data: &#123;&#125;</span><br><span class="line">  wordpress_data: &#123;&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>备注</strong>：</p>
<ul>
<li>docker 卷<code>db_data</code>并<code>wordpress_data</code>持久化 WordPress 对数据库的更新，以及已安装的主题和插件。</li>
<li>WordPress Multisite 仅适用于端口<code>80</code>和<code>443</code>。</li>
</ul>
</blockquote>
<p>3、构建项目</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up [-d]</span><br></pre></td></tr></table></figure>

<p>配置登陆信息后即可进入后台首页：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic1.imgdb.cn/item/63369ddd16f2c2beb16ca191.png"></p>
<h2 id="实战测试"><a href="#实战测试" class="headerlink" title="实战测试"></a>实战测试</h2><p>1、创建一个 Springboot 项目，导入  web 和 redis 依赖，同时创建测试使用的 controller：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">views</span> <span class="operator">=</span> redisTemplate.opsForValue().increment(<span class="string">&quot;views&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, World and Docker-Compose&quot;</span> + views;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、修改配置文件：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">8000</span></span><br><span class="line"><span class="attr">spring.redis.host</span>=<span class="string">redis</span></span><br></pre></td></tr></table></figure>

<p>3、编写 Dockerfile 脚本文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">FROM java:8</span><br><span class="line"></span><br><span class="line">COPY *.jar /app.jar</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">此处指定的优先级高于配置文件内部</span></span><br><span class="line">CMD [&quot;--server.port=8080&quot;]</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [&quot;java&quot;, &quot;-jar&quot;, &quot;/app.jar&quot;]</span><br></pre></td></tr></table></figure>

<p>4、编写 docker-compose.yml 文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">version: &#x27;3.8&#x27;</span><br><span class="line">services:</span><br><span class="line">  composedemo:</span><br><span class="line">    build: .</span><br><span class="line">    image: composedemo</span><br><span class="line">    depends_on:</span><br><span class="line">      - redis</span><br><span class="line">    ports:</span><br><span class="line">    - &quot;10001:8080&quot;</span><br><span class="line">  redis:</span><br><span class="line">    image: &quot;redis:alpine&quot;</span><br></pre></td></tr></table></figure>

<p>5、上传 jar 包、Dockerfile 文件、docker-compose.yml 文件到服务器指定目录：<code>/home/mycomposedemo</code>。</p>
<p>6、通过 docker-compose 启动项目：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up [-d]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">当项目需要重新部署打包重构镜像时：</span></span><br><span class="line">docker-compose up [-d] --build</span><br></pre></td></tr></table></figure>

<p>7、访问测试：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# curl localhost:10001/hello</span><br><span class="line">Hello, World and Docker-Compose1</span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# curl localhost:10001/hello</span><br><span class="line">Hello, World and Docker-Compose2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">远程浏览器用外网访问同样可行（10001 端口已开启）</span></span><br></pre></td></tr></table></figure>

<h1 id="Docker-Swarm"><a href="#Docker-Swarm" class="headerlink" title="Docker Swarm"></a>Docker Swarm</h1><blockquote>
<p>​		首先准备<code>四台</code>服务器，并且提前<code>安装 Docker 环境以及 Docker-Compose 环境</code>。<code>双主双从</code>集群（实际中最少三主）</p>
<table>
<thead>
<tr>
<th align="center">服务器IP</th>
<th align="center">服务器密码</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">8.142.92.222</td>
<td align="center">Lifunian7980</td>
<td align="center">leader</td>
</tr>
<tr>
<td align="center">39.103.191.179</td>
<td align="center">Lifunian7980</td>
<td align="center">manager</td>
</tr>
<tr>
<td align="center">120.55.57.73</td>
<td align="center">Lifunian7980</td>
<td align="center">worker</td>
</tr>
<tr>
<td align="center">180.76.226.31</td>
<td align="center">lishuang142!</td>
<td align="center">worker</td>
</tr>
</tbody></table>
</blockquote>
<p>Swarm 官方文档地址：<code>https://docs.docker.com/engine/swarm/</code>。Docker Engine 1.12 引入了 swarm 模式，使您能够创建由一个或多个 Docker 引擎组成的集群，称为 swarm。swarm 由一个或多个节点组成：在 swarm 模式下运行 Docker Engine 1.12 或更高版本的物理或虚拟机。</p>
<p>有两种类型的节点：<code>manager (管理节点)和 workers (工作节点)</code>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/06/19/kuangstudyf9fae70c-4de3-45d3-8a3a-de3434f85d38.png" alt="img"></p>
<p>根据上图可知：管理节点之间可以通信，工作都在管理节点上，使用 <code>Raft 一致性算法</code>。</p>
<h2 id="搭建集群"><a href="#搭建集群" class="headerlink" title="搭建集群"></a>搭建集群</h2><p>查看 swarm 帮助信息：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker swarm --help</span><br><span class="line">Usage:  docker swarm COMMAND</span><br><span class="line">Manage Swarm</span><br><span class="line">Commands:</span><br><span class="line">  ca          Display and rotate the root CA</span><br><span class="line">  init        Initialize a swarm</span><br><span class="line">  join        Join a swarm as a node and/or manager</span><br><span class="line">  join-token  Manage join tokens</span><br><span class="line">  leave       Leave the swarm</span><br><span class="line">  unlock      Unlock swarm</span><br><span class="line">  unlock-key  Manage the unlock key</span><br><span class="line">  update      Update the swarm</span><br><span class="line">Run &#x27;docker swarm COMMAND --help&#x27; for more information on a command.</span><br></pre></td></tr></table></figure>

<p>1、将主机服务器 docker 初始化进入 swarm：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker swarm init --advertise-addr 8.142.92.222</span><br><span class="line">Swarm initialized: current node (5vefz3g851f7b6i17nbjo2reb) is now a manager.</span><br><span class="line"></span><br><span class="line">To add a worker to this swarm, run the following command:</span><br><span class="line"></span><br><span class="line">    docker swarm join --token SWMTKN-1-1txhank8lmnwb4ocsv87gde0l537b958bkaasdgscrzu1w5hqf-987kduzk8e8ndu8e0b2f54lpc 8.142.92.222:2377</span><br><span class="line"></span><br><span class="line">To add a manager to this swarm, run &#x27;docker swarm join-token manager&#x27; and follow the instructions.</span><br></pre></td></tr></table></figure>

<p>由于使用的四台服务器不在一个私网的网段，因此需要<code>使用 公网 IP 地址</code>。</p>
<p>得到两个新的命令：（<code>添加节点</code>）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将工作节点加入到这个 swarm</span></span><br><span class="line">docker swarm join --token SWMTKN-1-1txhank8lmnwb4ocsv87gde0l537b958bkaasdgscrzu1w5hqf-987kduzk8e8ndu8e0b2f54lpc 8.142.92.222:2377</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加管理节点到这个 swarm</span></span><br><span class="line">docker swarm join-token manager</span><br></pre></td></tr></table></figure>

<p>2、将从机2 作为<code>工作节点</code>加入到 swarm</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@iZbp18eahm3m5ku28w2qyeZ ~]# docker swarm join --token SWMTKN-1-26qfjclcsbfe8vi5jnawnzda4tklrxkl5cidk5bb9dfbb8rzvf-2ove01vlyytwbhh9u0vux5xgl 8.142.92.222:2377</span><br><span class="line">This node joined a swarm as a worker.</span><br></pre></td></tr></table></figure>

<p>3、将 从机1 作为<code>主节点</code>加入到这个 swarm：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">8.142 主机获取主节点 token</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker swarm join-token manager</span><br><span class="line">To add a manager to this swarm, run the following command:</span><br><span class="line"></span><br><span class="line">    docker swarm join --token SWMTKN-1-1txhank8lmnwb4ocsv87gde0l537b958bkaasdgscrzu1w5hqf-41cw4wb6de0l8ba2oessfai0j 8.142.92.222:2377</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">从机1 执行此语句加入集群变成主节点</span></span><br><span class="line"> docker swarm join --token SWMTKN-1-26qfjclcsbfe8vi5jnawnzda4tklrxkl5cidk5bb9dfbb8rzvf-0qhzksjitnp8jnav170prnv9u 8.142.92.222:2377</span><br></pre></td></tr></table></figure>

<p>4、将从机 4 作为 <code>工作节点</code>加入到 swarm</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm join --token SWMTKN-1-26qfjclcsbfe8vi5jnawnzda4tklrxkl5cidk5bb9dfbb8rzvf-2ove01vlyytwbhh9u0vux5xgl 8.142.92.222:2377</span><br></pre></td></tr></table></figure>

<p>5、由于服务器限制，暂时无法解决不同网段的<code>网络联通</code>问题</p>
<p>​		目前出现的问题：<code>加入管理节点时报错，加入工作节点时没问题</code>。（防火墙、安全组已检查，端口已开放）</p>
<p>因此，此处暂时使用<code>一主两从</code>的集群方式来做测试：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查集群节点状态：一主两从，状态 Ready</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker node ls</span><br><span class="line">ID                            HOSTNAME                  STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION</span><br><span class="line">icmrv81c3nswe0vozo60bfqq8 *   iZ8vb0l7sqdpurpvy5e77xZ   Ready     Active         Leader           20.10.14</span><br><span class="line">6s0w9xkom9vsdn61m8isgy46e     iZ8vb45xejetxupwfn3mj8Z   Ready     Active                          20.10.17</span><br><span class="line">5ei1b070trmw23rkrmbqqvkgz     iZbp18eahm3m5ku28w2qyeZ   Ready     Active                          20.10.17</span><br></pre></td></tr></table></figure>

<h2 id="Raft-一致性协议"><a href="#Raft-一致性协议" class="headerlink" title="Raft 一致性协议"></a>Raft 一致性协议</h2><p>​		目前集群是<code>双主双从</code>模式，那么假设一个节点宕机，另外节点是否可用？</p>
<p><code>Raft 协议</code>：保证大多数节点存活才可以用，集群至少三台，则三台的话宕机一台即不可用。</p>
<p>测试：</p>
<p>1）假设一个管理节点宕机，发现另一台主节点不可用 &#x3D;&#x3D;&#x3D;&#x3D;&gt; 整个集群不可用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker node ls</span><br></pre></td></tr></table></figure>

<p>2）如果将从 docker节点 离开集群，集群信息会看到此节点 down 的状态。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">离开集群操作</span></span><br><span class="line">docker swarm leave</span><br></pre></td></tr></table></figure>

<p>3）再将工作节点转变成主节点加入集群 &#x3D;&#x3D;&#x3D;&gt; 三主一从后，再停掉一台管理节点，集群仍能够使用。</p>
<p><code>因此</code>：为了达到集群可用，若三个管理节点，必须 &gt; 1台存活的管理节点才可以正常使用。</p>
<h2 id="弹性集群"><a href="#弹性集群" class="headerlink" title="弹性集群"></a>弹性集群</h2><p>以前是通过 <code>docker run</code> 或是 <code>docker-compose up</code> 来启动容器，但是这都是<code>单机版</code>的。</p>
<p>现在使用 swarm 集群，就都变成了服务：<code>docker service</code>，模式变成了：容器 &#x3D;&#x3D;&#x3D;&#x3D;&gt; 服务（redis 服务） &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; 副本（redis 的10个副本）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker service</span><br><span class="line"></span><br><span class="line">Usage:  docker service COMMAND</span><br><span class="line"></span><br><span class="line">Manage services</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  create      Create a new service</span><br><span class="line">  inspect     Display detailed information on one or more services</span><br><span class="line">  logs        Fetch the logs of a service or task</span><br><span class="line">  ls          List services</span><br><span class="line">  ps          List the tasks of one or more services</span><br><span class="line">  rm          Remove one or more services</span><br><span class="line">  rollback    Revert changes to a service&#x27;s configuration</span><br><span class="line">  scale       Scale one or multiple replicated services</span><br><span class="line">  update      Update a service</span><br><span class="line"></span><br><span class="line">Run &#x27;docker service COMMAND --help&#x27; for more information on a command.</span><br></pre></td></tr></table></figure>

<p>包含功能：创建服务、动态扩展服务、动态更新发布 等。</p>
<p>目前比较火的<code>灰度发布(金丝雀发布)</code>便可以使用 docker 的 swarm 实现。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动对比</span></span><br><span class="line">docker run 		# 容器启动，不具备扩缩容器功能</span><br><span class="line">docker service	# 具有扩缩容器功能，滚动更新</span><br></pre></td></tr></table></figure>

<p>测试实现<code>动态扩缩容</code>：（注意下面的命令<code>在 swarm 集群中才可以使用</code>）</p>
<p>1）启动一个 nginx <code>服务</code>，检查状态。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动 nginx 服务，端口 8888</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker service create -p 10001:80 --name my-nginx nginx</span><br><span class="line">c2f1nm3t5sh6e2ue9xiysr37k</span><br><span class="line">overall progress: 1 out of 1 tasks </span><br><span class="line">1/1: running   [==================================================&gt;] </span><br><span class="line">verify: Service converged</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查启动的所有服务</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker service ls</span><br><span class="line">ID             NAME       MODE         REPLICAS   IMAGE          PORTS</span><br><span class="line">c2f1nm3t5sh6   my-nginx   replicated   1/1        nginx:latest   *:10001-&gt;80/tcp</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现该服务只有一个副本 1/1</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查 my-nginx 服务状态</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker service ps my-nginx</span><br><span class="line">ID             NAME         IMAGE          NODE                      DESIRED STATE   CURRENT STATE            ERROR     PORTS</span><br><span class="line">rbjcbq7ri9qw   my-nginx.1   nginx:latest   iZ8vb45xejetxupwfn3mj8Z   Running         Running 10 minutes ago</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看具体信息</span></span><br><span class="line">docker service inspect my-nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">寻找该副本具体位于哪个服务器的 docker 内，发现位于服务器2-工作节点？	=====&gt; 随机分配</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">突然增加访问量时，一个 nginx 不够用了，怎么办呢？</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更新服务，创建新的副本</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker service update --replicas 3 my-nginx</span><br><span class="line">my-nginx</span><br><span class="line">overall progress: 3 out of 3 tasks </span><br><span class="line">1/3: running   [==================================================&gt;] </span><br><span class="line">2/3: running   [==================================================&gt;] </span><br><span class="line">3/3: running   [==================================================&gt;] </span><br><span class="line">verify: Service converged</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">再次检查服务副本数，发现变成了 3，同时也是随机分配在了各个服务器上（本地测试是每个服务器上一个）</span></span><br><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker service ls</span><br><span class="line">ID             NAME       MODE         REPLICAS   IMAGE          PORTS</span><br><span class="line">c2f1nm3t5sh6   my-nginx   replicated   3/3        nginx:latest   *:10001-&gt;80/tcp</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">此时在远程通过IP:PORT 访问 nginx 进行测试：发现每个 IP 都可以直接访问到 nginx 的欢迎页面(注意开启安全组 10001 端口) =======&gt; 集群是一个整体</span></span><br></pre></td></tr></table></figure>

<p>根据上面情况测试：那么是不是可以直接扩展 10 个 nginx 副本呢？&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; <code>当然可以</code>。</p>
<p>那么如何减少副本数量呢？</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service update --replicas 1 my-nginx</span><br></pre></td></tr></table></figure>

<p>同时还可以通过 scale 来进行动态扩缩容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">扩容</span></span><br><span class="line">docker service scale my-nginx=10</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">缩容</span></span><br><span class="line">docker service scale my-nginx=1</span><br></pre></td></tr></table></figure>

<p>删除服务：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service rm 服务名/ID</span><br></pre></td></tr></table></figure>

<h2 id="Swarm-概念"><a href="#Swarm-概念" class="headerlink" title="Swarm 概念"></a>Swarm 概念</h2><p>​		Swarm：集群的管理和编排，利用 docker 可以初始化 swarm 集群，其他节点通过命令加入。（管理节点、工作节点）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/06/19/kuangstudy482fb06d-6be2-4ac5-8304-f9b1ed90f84f.png" alt="img"></p>
<p>1）<code>Node</code>：就是一个 docker 节点，多个节点组成一个网络集群。</p>
<p>2）<code>Service</code>：任务，可以在管理节点或者工作节点来运行，是 swarm 的核心，用户访问的就是 Service 。</p>
<p>3）<code>Task</code>：可以理解为一个个的副本，每个副本里面就跑着具体的容器。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/06/19/kuangstudy9954898a-3e89-4e12-b87c-0e4e67dbff20.png" alt="img"></p>
<blockquote>
<p>Swarm 运行机制和原理：命令 —-&gt; 管理节点 ——&gt; api ——–&gt; 调度 —–&gt; 工作节点（创建 Task 容器维护创建）</p>
<p>​		scheduler 调度器根据内部的算法和压力来对具体的副本进行分配（管理节点）</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/06/19/kuangstudy8a76dba3-b2ad-4b57-9e87-87b76329885f.png" alt="img"></p>
<h1 id="其他功能"><a href="#其他功能" class="headerlink" title="其他功能"></a>其他功能</h1><h2 id="Docker-Stack"><a href="#Docker-Stack" class="headerlink" title="Docker Stack"></a>Docker Stack</h2><p>​		docker-compose ：单机部署项目。而在集群中部署项目就需要使用 <code>Docker Stack</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">单机启动 wordpress</span></span><br><span class="line">docker-compose up -d wordpress.yaml</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">集群启动 wordpress，更像 k8s 的方式</span></span><br><span class="line">docker stack deploy wordpress.yaml</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">示例配置文件：</span></span><br><span class="line">version: &quot;3.9&quot;</span><br><span class="line">services:</span><br><span class="line">  service1:</span><br><span class="line">    image: &quot;registry.cn-guangzhou.aliyuncs.com/lengcz_pub/test1:1.0&quot;</span><br><span class="line">    deploy:</span><br><span class="line">      replicas: 2</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;8080:8080&quot;</span><br><span class="line"></span><br><span class="line">  service2:</span><br><span class="line">    image: &quot;registry.cn-guangzhou.aliyuncs.com/lengcz_pub/test2:1.0&quot;</span><br><span class="line">    deploy:</span><br><span class="line">      replicas: 4</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;8081:8081&quot;</span><br></pre></td></tr></table></figure>

<h2 id="Docker-Secret"><a href="#Docker-Secret" class="headerlink" title="Docker  Secret"></a>Docker  Secret</h2><p>​		<code>Docker Secret</code>：安全配置，密码加密，证书设置。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker secret --help</span><br><span class="line">Usage:  docker secret COMMAND</span><br><span class="line">Manage Docker secrets</span><br><span class="line">Commands:</span><br><span class="line">  create      Create a secret from a file or STDIN as content</span><br><span class="line">  inspect     Display detailed information on one or more secrets</span><br><span class="line">  ls          List secrets</span><br><span class="line">  rm          Remove one or more secrets</span><br><span class="line"></span><br><span class="line">Run &#x27;docker secret COMMAND --help&#x27; for more information on a command.</span><br></pre></td></tr></table></figure>

<h2 id="Docker-Config"><a href="#Docker-Config" class="headerlink" title="Docker Config"></a>Docker Config</h2><p>​		<code>Docker Config</code>：Docke 统一配置。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ8vb0l7sqdpurpvy5e77xZ ~]# docker config --help</span><br><span class="line"></span><br><span class="line">Usage:  docker config COMMAND</span><br><span class="line"></span><br><span class="line">Manage Docker configs</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  create      Create a config from a file or STDIN</span><br><span class="line">  inspect     Display detailed information on one or more configs</span><br><span class="line">  ls          List configs</span><br><span class="line">  rm          Remove one or more configs</span><br><span class="line"></span><br><span class="line">Run &#x27;docker config COMMAND --help&#x27; for more information on a command.</span><br></pre></td></tr></table></figure>





</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>Docker 的基本使用</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="http://localhost:4000/2022/05/20/%E8%BF%90%E7%BB%B4%E6%8A%80%E6%9C%AF/Docker%20%E5%9F%BA%E7%A1%80/">http://localhost:4000/2022/05/20/运维技术/Docker 基础/</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a" style="display: inline-block;width: 120px"><h>作者</h><div class="post-copyright-cc-info"><h>月の子豚小窝</h></div></div><div class="post-copyright-c" style="display: inline-block;width: 120px"><h>发布于</h><div class="post-copyright-cc-info"><h>2022-05-20</h></div></div><div class="post-copyright-u" style="display: inline-block;width: 120px"><h>更新于</h><div class="post-copyright-cc-info"><h>2022-11-12</h></div></div><div class="post-copyright-c" style="display: inline-block;width: 180px"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Docker/">Docker</a><a class="post-meta__tags" href="/tags/%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2/">项目部署</a></div><div class="post_share"><div class="social-share" data-image="https://w.wallhaven.cc/full/e7/wallhaven-e7dy9w.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn1.tianli0.top/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><link rel="stylesheet" href="/css/coin.css" media="defer" onload="this.media='all'"/><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">好想要糖糖呀</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/cur/wechat.png" target="_blank"><img class="post-qr-code-img" src="/cur/wechat.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/cur/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/cur/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></button></div><audio id="coinAudio" src="https://cdn.cbd.int/akilar-candyassets@1.0.36/audio/aowu.m4a"></audio><script defer="defer" src="/js/coin.js"></script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/05/20/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8A%80%E6%9C%AF/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%97%B4%E4%BB%B6/Redis%20%E5%9F%BA%E7%A1%80/"><img class="prev-cover" src="https://w.wallhaven.cc/full/we/wallhaven-weoe9q.jpg" onerror="onerror=null;src='https://bu.dusays.com/2022/09/01/63103d8f14652.webp'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Redis 基本使用</div></div></a></div><div class="next-post pull-right"><a href="/2022/05/20/%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/Nginx%20%E5%9F%BA%E7%A1%80/"><img class="next-cover" src="https://w.wallhaven.cc/full/1k/wallhaven-1k7ox3.jpg" onerror="onerror=null;src='https://bu.dusays.com/2022/09/01/63103d8f14652.webp'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Nginx 使用初探</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div><div class="comment-barrage"></div><link rel="stylesheet" href="/css/commentBarrage.css"/><script src="/js/commentBarrage.js"></script></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="fgx"><div class="avatar_img"><img style="border-radius:10px" src="https://pic.imgdb.cn/item/637b405e16f2c2beb1405fb3.jpg" onerror="this.onerror=null;this.src='https://bu.dusays.com/2021/10/13/096df1ddac262.gif'" alt="avatar"/></div><div class="author-info__description"></div><div class="rights"><div class="author-info__name">月の子豚小窝</div><div class="card-info-data site-data is-center"><a class="adiv" href="/archives/"><div class="headline">文章</div><div class="length-num">37</div></a><a class="adiv" href="/tags/"><div class="headline">标签</div><div class="length-num">49</div></a><a class="adiv" href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/lyxofficial" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://blog.csdn.net/weixin_44101108" target="_blank" title="CSDN"><i class="iconfont icon-csdn"></i></a><a class="social-icon" href="https://www.cnblogs.com/LYXOfficial" target="_blank" title="博客园"><i class="iconfont icon-RSS"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="订阅RSS源"><i class="fa fa-rss"></i></a><a class="social-icon" href="https://www.zhihu.com/people/lyx-29-86-4" target="_blank" title="知乎"><i class="iconfont icon-zhihu"></i></a><a class="social-icon" href="https://space.bilibili.com/369280472" target="_blank" title="bilibili"><i class="iconfont icon-bilibili"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content"><a href="http://localhost:4000">月の子豚小窝</a> 整改中......<br/>2022年的计划我完成了吗？</div><div class="bbTimeList container" id="bbTimeList"><div class="swiper-container swiper-no-swiping essay_bar_swiper_container" id="bbtalk" tabindex="-1"><div class="swiper-wrapper" id="bber-talk" onclick="window.open('/essay/','_self')"><div class="li-style swiper-slide">可以看看我的音乐哦, 耶✌️, 终于不会混乱🤪了</div><div class="li-style swiper-slide">遇见彩虹🌈吃定彩虹 [图片]</div><div class="li-style swiper-slide">ThreeJs API真多丫</div><div class="li-style swiper-slide"></div><div class="li-style swiper-slide">还是不开Pjax好啊😂</div></div></div></div></div><div class="card-widget card-history"><div class="card-content"><div class="item-headline"><i class="fas fa-clock fa-spin"></i><span>那年今日</span></div><div id="history-baidu" style="height: 100px;overflow: hidden;"><div class="history_swiper-container" id="history-container" style="width: 100%;height: 100%;"><div class="swiper-wrapper" id="history_container_wrapper" style="height:20px"></div></div></div></div></div><div class="card-widget card-calendar"><div class="card-content"><div class="item-headline"><i class="fas fa-calendar"></i><span>文章日历</span></div><div class="widget" id="calendar"></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">Docker 概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-%E6%9D%A5%E7%94%B1"><span class="toc-number">1.1.</span> <span class="toc-text">Docker 来由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-%E5%8E%86%E5%8F%B2"><span class="toc-number">1.2.</span> <span class="toc-text">Docker 历史</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-%E4%BD%9C%E7%94%A8"><span class="toc-number">1.3.</span> <span class="toc-text">Docker 作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DevOps"><span class="toc-number">1.4.</span> <span class="toc-text">DevOps</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-%E6%9E%B6%E6%9E%84"><span class="toc-number">1.5.</span> <span class="toc-text">Docker 架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HelloDocker-%E5%8E%9F%E7%90%86"><span class="toc-number">1.6.</span> <span class="toc-text">HelloDocker 原理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-%E4%BD%BF%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">Docker 使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%AE%E5%8A%A9%E4%BF%A1%E6%81%AF%E5%91%BD%E4%BB%A4"><span class="toc-number">2.1.</span> <span class="toc-text">帮助信息命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">2.2.</span> <span class="toc-text">镜像命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">2.3.</span> <span class="toc-text">容器命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E9%98%B6%E5%91%BD%E4%BB%A4"><span class="toc-number">2.4.</span> <span class="toc-text">进阶命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E8%BF%9B%E9%98%B6%E6%93%8D%E4%BD%9C"><span class="toc-number">2.5.</span> <span class="toc-text">容器进阶操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%B1%87%E6%80%BB"><span class="toc-number">2.6.</span> <span class="toc-text">命令汇总</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%9A%B4%E9%9C%B2%E9%97%AE%E9%A2%98"><span class="toc-number">2.7.</span> <span class="toc-text">端口暴露问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2-Nginx"><span class="toc-number">2.8.</span> <span class="toc-text">部署 Nginx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2-Tomcat"><span class="toc-number">2.9.</span> <span class="toc-text">部署 Tomcat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2-ES-%E5%92%8C-Kibana"><span class="toc-number">2.10.</span> <span class="toc-text">部署 ES 和 Kibana</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#portainer-%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-number">2.11.</span> <span class="toc-text">portainer 可视化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-%E9%95%9C%E5%83%8F"><span class="toc-number">3.</span> <span class="toc-text">Docker 镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86"><span class="toc-number">3.1.</span> <span class="toc-text">镜像加载原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%B1%82%E7%BB%93%E6%9E%84"><span class="toc-number">3.2.</span> <span class="toc-text">分层结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E4%BA%A4%E9%95%9C%E5%83%8F"><span class="toc-number">3.3.</span> <span class="toc-text">提交镜像</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">4.</span> <span class="toc-text">容器数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8D%B7%E4%BD%BF%E7%94%A8"><span class="toc-number">4.1.</span> <span class="toc-text">数据卷使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL-%E6%A1%88%E4%BE%8B"><span class="toc-number">4.2.</span> <span class="toc-text">MySQL 案例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%82%E8%BD%BD%E6%96%B9%E5%BC%8F"><span class="toc-number">4.3.</span> <span class="toc-text">挂载方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DockerFile-%E6%8C%82%E8%BD%BD"><span class="toc-number">4.4.</span> <span class="toc-text">DockerFile 挂载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AE%B9%E5%99%A8"><span class="toc-number">4.5.</span> <span class="toc-text">数据卷容器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DockerFile"><span class="toc-number">5.</span> <span class="toc-text">DockerFile</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#DockerFile-%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="toc-number">5.1.</span> <span class="toc-text">DockerFile 构建过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DockerFile-%E6%8C%87%E4%BB%A4"><span class="toc-number">5.2.</span> <span class="toc-text">DockerFile 指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%88%98-centos-%E9%95%9C%E5%83%8F"><span class="toc-number">5.3.</span> <span class="toc-text">实战 centos 镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%88%98-Tomcat-%E9%95%9C%E5%83%8F"><span class="toc-number">5.4.</span> <span class="toc-text">实战 Tomcat 镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E9%95%9C%E5%83%8F"><span class="toc-number">5.5.</span> <span class="toc-text">发布镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E5%88%B0-DockerHub"><span class="toc-number">5.5.1.</span> <span class="toc-text">发布到 DockerHub</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.5.2.</span> <span class="toc-text">发布到阿里云容器服务</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-%E7%BD%91%E7%BB%9C"><span class="toc-number">6.</span> <span class="toc-text">Docker 网络</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E5%AE%B9%E5%99%A8%E9%80%9A%E4%BF%A1"><span class="toc-number">6.1.</span> <span class="toc-text">主机容器通信</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E9%97%B4%E9%80%9A%E4%BF%A1"><span class="toc-number">6.2.</span> <span class="toc-text">容器间通信</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E4%BA%92%E8%81%94"><span class="toc-number">6.3.</span> <span class="toc-text">容器互联</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C"><span class="toc-number">6.4.</span> <span class="toc-text">自定义网络</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%81%94%E9%80%9A"><span class="toc-number">6.5.</span> <span class="toc-text">网络联通</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis-%E9%9B%86%E7%BE%A4"><span class="toc-number">7.</span> <span class="toc-text">Redis 集群</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Boot-%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85%E9%95%9C%E5%83%8F"><span class="toc-number">8.</span> <span class="toc-text">Boot 项目打包镜像</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-Compose"><span class="toc-number">9.</span> <span class="toc-text">Docker Compose</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-Compose"><span class="toc-number">9.1.</span> <span class="toc-text">安装 Compose</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B"><span class="toc-number">9.2.</span> <span class="toc-text">快速开始</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">9.3.</span> <span class="toc-text">执行流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Yaml-%E8%A7%84%E5%88%99"><span class="toc-number">9.4.</span> <span class="toc-text">Yaml 规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WP%E5%8D%9A%E5%AE%A2%E6%B5%8B%E8%AF%95"><span class="toc-number">9.5.</span> <span class="toc-text">WP博客测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%B5%8B%E8%AF%95"><span class="toc-number">9.6.</span> <span class="toc-text">实战测试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-Swarm"><span class="toc-number">10.</span> <span class="toc-text">Docker Swarm</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4"><span class="toc-number">10.1.</span> <span class="toc-text">搭建集群</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Raft-%E4%B8%80%E8%87%B4%E6%80%A7%E5%8D%8F%E8%AE%AE"><span class="toc-number">10.2.</span> <span class="toc-text">Raft 一致性协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%B9%E6%80%A7%E9%9B%86%E7%BE%A4"><span class="toc-number">10.3.</span> <span class="toc-text">弹性集群</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Swarm-%E6%A6%82%E5%BF%B5"><span class="toc-number">10.4.</span> <span class="toc-text">Swarm 概念</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%8A%9F%E8%83%BD"><span class="toc-number">11.</span> <span class="toc-text">其他功能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-Stack"><span class="toc-number">11.1.</span> <span class="toc-text">Docker Stack</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-Secret"><span class="toc-number">11.2.</span> <span class="toc-text">Docker  Secret</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-Config"><span class="toc-number">11.3.</span> <span class="toc-text">Docker Config</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/11/21/%E5%A5%87%E6%80%9D%E6%B7%AB%E5%B7%A7/Hexo%E9%AD%94%E6%94%B9%E8%AE%B0%E5%BD%95/" title="Hexo魔改日记"><img src="https://w.wallhaven.cc/full/x6/wallhaven-x6128o.jpg" onerror="this.onerror=null;this.src='https://bu.dusays.com/2022/09/01/63103d8f14652.webp'" alt="Hexo魔改日记"/></a><div class="content"><a class="title" href="/2022/11/21/%E5%A5%87%E6%80%9D%E6%B7%AB%E5%B7%A7/Hexo%E9%AD%94%E6%94%B9%E8%AE%B0%E5%BD%95/" title="Hexo魔改日记">Hexo魔改日记</a><time datetime="2022-11-21T12:35:28.011Z" title="发表于 2022-11-21 20:35:28">2022-11-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/20/%E5%A5%87%E6%80%9D%E6%B7%AB%E5%B7%A7/SpringBoot%E9%99%8D%E4%BD%8E%E7%89%88%E6%9C%AC%E9%97%AE%E9%A2%98/" title="SpringBoot 降低版本问题"><img src="https://w.wallhaven.cc/full/zy/wallhaven-zygeko.jpg" onerror="this.onerror=null;this.src='https://bu.dusays.com/2022/09/01/63103d8f14652.webp'" alt="SpringBoot 降低版本问题"/></a><div class="content"><a class="title" href="/2022/11/20/%E5%A5%87%E6%80%9D%E6%B7%AB%E5%B7%A7/SpringBoot%E9%99%8D%E4%BD%8E%E7%89%88%E6%9C%AC%E9%97%AE%E9%A2%98/" title="SpringBoot 降低版本问题">SpringBoot 降低版本问题</a><time datetime="2022-11-20T12:20:00.095Z" title="发表于 2022-11-20 20:20:00">2022-11-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/06/%E9%A1%B9%E7%9B%AE%E7%BB%83%E4%B9%A0/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%AE%A2%E5%8D%95%E6%9C%8D%E5%8A%A1/" title="谷粒商城-订单服务实现"><img src="https://w.wallhaven.cc/full/m9/wallhaven-m9873y.jpg" onerror="this.onerror=null;this.src='https://bu.dusays.com/2022/09/01/63103d8f14652.webp'" alt="谷粒商城-订单服务实现"/></a><div class="content"><a class="title" href="/2022/11/06/%E9%A1%B9%E7%9B%AE%E7%BB%83%E4%B9%A0/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%AE%A2%E5%8D%95%E6%9C%8D%E5%8A%A1/" title="谷粒商城-订单服务实现">谷粒商城-订单服务实现</a><time datetime="2022-11-06T14:42:44.735Z" title="发表于 2022-11-06 22:42:44">2022-11-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/03/%E9%A1%B9%E7%9B%AE%E7%BB%83%E4%B9%A0/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0/" title="谷粒商城-购物车逻辑实现"><img src="https://w.wallhaven.cc/full/m9/wallhaven-m9873y.jpg" onerror="this.onerror=null;this.src='https://bu.dusays.com/2022/09/01/63103d8f14652.webp'" alt="谷粒商城-购物车逻辑实现"/></a><div class="content"><a class="title" href="/2022/11/03/%E9%A1%B9%E7%9B%AE%E7%BB%83%E4%B9%A0/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0/" title="谷粒商城-购物车逻辑实现">谷粒商城-购物车逻辑实现</a><time datetime="2022-11-03T07:19:16.711Z" title="发表于 2022-11-03 15:19:16">2022-11-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/30/%E9%A1%B9%E7%9B%AE%E7%BB%83%E4%B9%A0/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81%E5%A4%84%E7%90%86/" title="谷粒商城-用户认证处理"><img src="https://w.wallhaven.cc/full/m9/wallhaven-m9873y.jpg" onerror="this.onerror=null;this.src='https://bu.dusays.com/2022/09/01/63103d8f14652.webp'" alt="谷粒商城-用户认证处理"/></a><div class="content"><a class="title" href="/2022/10/30/%E9%A1%B9%E7%9B%AE%E7%BB%83%E4%B9%A0/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81%E5%A4%84%E7%90%86/" title="谷粒商城-用户认证处理">谷粒商城-用户认证处理</a><time datetime="2022-10-30T02:15:21.954Z" title="发表于 2022-10-30 10:15:21">2022-10-30</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="social-icons"></div><div class="copyright">&copy;2020 - 2022 By 月の子豚小窝</div><div class="framework-info"><span class="footer-separator"> </span><a target="_blank" rel="noopener" href="https://hexo.io"><img src="https://img.shields.io/badge/Frame-Hexo-blue"/></a><span class="footer-separator"> </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly"><img src="https://img.shields.io/badge/Theme-Butterfly-informational"/></a><span class="footer-separator"> </span><a target="_blank" rel="noopener" href="https://vercel.app"><img src="https://img.shields.io/badge/Hosted-Vercel-success"/></a><span class="footer-separator"></span><a target="_blank" rel="noopener" href="https://tianli-blog.club/jsd/"><img src="https://img.shields.io/badge/CDN-TianliCDN-fff4c5"/></a><span class="footer-separator"></span><a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://img.shields.io/badge/CC-BY--NC--SA4.0-red"/></a><span class="footer-separator"></span><a target="_blank" rel="noopener" href="https://icp.gov.moe/?keyword=20222035"><img src="https://img.shields.io/badge/%E8%90%8CICP%E5%A4%87-20222035-ff69b4"/></a></div><div class="footer_custom_text" id="footer_custom_text">这个小破站已运行{y}年{d}天{s}时{min}分{sec}秒</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"></div><div id="rightside-config-show"><button id="translateLink" type="button" title="简繁转换">简</button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="to_comment" type="button" title="直达评论" onclick="FixedCommentBtn();"><i class="fas fa-comments"></i></button><a id="switch_commentBarrage" href="javascript:switchCommentBarrage();" title="开关弹幕"><i class="iconfont icon-danmu"></i></a><a id="opensettings" href="javascript:toggleWinbox();" title="博客设置"><i class="fa fa-cog"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div id="nav-music"><div id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()">播放音乐</div><meting-js id="1708664797" server="tencent" type="playlist" mutex="true" preload="none" theme="#ed709b" data-lrctype="0" order="random"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:window.location.href = window.location.origin;"><i class="fa-solid fa-house"></i></a></div><div class="rightMenu-group rightMenu-line rightMenuOther" id="menu-base1"><a class="rightMenu-item menu-link" href="/archives/"><i class="fa-solid fa-archive"></i><span>文章归档</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="fa-solid fa-folder-open"></i><span>文章分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="fa-solid fa-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>复制文本</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="iconfont icon-baidu"></i><span>百度搜索</span></a><a class="rightMenu-item" href="#post-comment" onclick="rmf.yinyong()"><i class="fa-solid fa-message"></i><span>引用文本评论</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><i class="fa fa-copy"></i><span>粘贴文本</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>保存图片</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>窗口预览</span></a><a class="rightMenu-item" href="javascript:rmf.click()"><i class="fa fa-arrows-alt"></i><span>全屏显示</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-music"><a class="rightMenu-item" href="javascript:rmf.musicSkipBack()"><i class="fas fa-backward"></i><span>上一首~</span></a><a class="rightMenu-item" href="javascript:rmf.musicSkipForward()"><i class="fas fa-forward"></i><span>下一首~</span></a><a class="rightMenu-item" id="menu-music-toggle" href="javascript:rmf.musicToggle()"><i class="fa-solid fa-pause"></i><span>暂停音乐</span></a><a class="rightMenu-item" href="javascript:rmf.copyMusicName()"><i class="fas fa-copy"></i><span>复制歌名</span></a></div><div class="rightMenu-group rightMenu-line" id="menu-base2"><a class="rightMenu-item" href="javascript:toRandomPost()"><i class="fa fa-paper-plane"></i><span>随便逛逛</span></a><a class="rightMenu-item" href="javascript:switchNightMode();"><i class="fa fa-moon"></i><span>昼夜切换</span></a><a class="rightMenu-item" href="javascript:rmf.translate();"><i class="iconfont icon-fanti"></i><span>繁简转换</span></a><div class="rightMenu-item" href="javascript:rmf.printPage();"><i class="fa-solid fa-print fa-fw"></i><span>打印页面</span></div><a class="rightMenu-item" href="javascript:window.location.href=&quot;/license/&quot;;"><i class="fa fa-info-circle"></i><span>版权声明</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();"><i class="fas fa-cog"></i><span>博客设置</span></a></div></div><div><script src="https://npm.elemecdn.com/vue@2.6.11"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn1.tianli0.top/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn1.tianli0.top/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn1.tianli0.top/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
    setTimeout(function(){document.getElementById('loading-box').classList.add("loadend")},700)
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'http://124.221.230.10:8888',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'http://124.221.230.10:8888',
      region: '',
      urls: [window.location.pathname],
      includeReply: true
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/gh/zhheo/twikoo@dev/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script><script>var gitcalendar = new Vue({
  el: '#gitcalendar',
  data: {
    simplemode: false,
    user: 'LYXOfficial',
    fixed: 'fixed',
    px: 'px',
    x: '',
    y: '',
    span1: '',
    span2: '',
    month: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
    monthchange: [],
    oneyearbeforeday: '',
    thisday: '',
    amonthago: '',
    aweekago: '',
    weekdatacore: 0,
    datacore: 0,
    total: 0,
    datadate: '',
    data: [],
    positionplusdata: [],
    firstweek: [],
    lastweek: [],
    beforeweek: [],
    thisweekdatacore: 0,
    mounthbeforeday: 0,
    mounthfirstindex: 0,
    crispedges: 'crispedges',
    thisdayindex: 0,
    amonthagoindex: 0,
    amonthagoweek: [],
    firstdate: [],
    first2date: [],
    montharrbefore: [],
    monthindex: 0,
    color: ['#ebedf0', '#f1f8ff', '#dbedff', '#c8e1ff', '#79b8ff', '#2188ff', '#0366d6', '#005cc5', '#044289', '#032f62', '#05264c']
  },
  methods: {
    selectStyle(data, event) {
      document.querySelector('.angle-wrapper').style.display = 'block'
      this.span1 = data.date;
      this.span2 = data.count;
      this.x = event.clientX - 100;
      this.y = event.clientY - 60
    },
    outStyle() {
      document.querySelector('.angle-wrapper').style.display = 'none'
    },
    thiscolor(x) {
      if (x === 0) {
        let i = parseInt(x / 2);
        return this.color[0]
      } else if (x < 2) {
        return this.color[1]
      } else if (x < 20) {
        let i = parseInt(x / 2);
        return this.color[i]
      } else {
        return this.color[9]
      }
    },
  }
});
var apiurl = 'gcapi.yisous.xyz' ? 'https://gcapi.yisous.xyz/api?' : 'https://githubapi.ryanchristian.dev/user/'
var githubapiurl = apiurl + gitcalendar.user;
//canvas绘图
function responsiveChart() {
  let c = document.getElementById("gitcanvas");
  if (c) {
    let cmessage = document.getElementById("gitmessage");
    let ctx = c.getContext("2d");
    c.width = document.getElementById("gitcalendarcanvasbox").offsetWidth;
    let linemaxwitdh = 0.96 * c.width / gitcalendar.data.length;
    c.height = 9 * linemaxwitdh;
    let lineminwitdh = 0.8 * linemaxwitdh;
    let setposition = {
      x: 0.02 * c.width,
      y: 0.025 * c.width
    };
    for (let week in gitcalendar.data) {
      weekdata = gitcalendar.data[week];
      for (let day in weekdata) {
        let dataitem = {
          date: "",
          count: "",
          x: 0,
          y: 0
        };
        gitcalendar.positionplusdata.push(dataitem);
        ctx.fillStyle = gitcalendar.thiscolor(weekdata[day].count);
        setposition.y = Math.round(setposition.y * 100) / 100;
        dataitem.date = weekdata[day].date;
        dataitem.count = weekdata[day].count;
        dataitem.x = setposition.x;
        dataitem.y = setposition.y;
        ctx.fillRect(setposition.x, setposition.y, lineminwitdh, lineminwitdh);
        setposition.y = setposition.y + linemaxwitdh
      };
      setposition.y = 0.025 * c.width;
      setposition.x = setposition.x + linemaxwitdh
    };
    ctx.font = "600  Arial";
    ctx.fillStyle = '#aaa';
    ctx.fillText("日", 0, 1.9 * linemaxwitdh);
    ctx.fillText("二", 0, 3.9 * linemaxwitdh);
    ctx.fillText("四", 0, 5.9 * linemaxwitdh);
    ctx.fillText("六", 0, 7.9 * linemaxwitdh);
    let monthindexlist = c.width / 24;
    for (let index in gitcalendar.monthchange) {
      ctx.fillText(gitcalendar.monthchange[index], monthindexlist, 0.7 * linemaxwitdh);
      monthindexlist = monthindexlist + c.width / 12
    };
    cmessage.onmousemove = function(event) {
      document.querySelector('.angle-wrapper').style.display = 'none'
    };
    c.onmousemove = function(event) {
      document.querySelector('.angle-wrapper').style.display = 'none'
      getMousePos(c, event);
    };

    function getMousePos(canvas, event) {
      var rect = canvas.getBoundingClientRect();
      var x = event.clientX - rect.left * (canvas.width / rect.width);
      var y = event.clientY - rect.top * (canvas.height / rect.height);
      //console.log("x:"+x+",y:"+y);
      for (let item of gitcalendar.positionplusdata) {
        let lenthx = x - item.x;
        let lenthy = y - item.y;
        //console.log(lenthx,lenthy);
        if (0 < lenthx && lenthx < lineminwitdh) {
          if (0 < lenthy && lenthy < lineminwitdh) {
            //console.log(item.date,item.count)
            document.querySelector('.angle-wrapper').style.display = 'block'
            gitcalendar.span1 = item.date;
            gitcalendar.span2 = item.count;
            gitcalendar.x = event.clientX - 100;
            gitcalendar.y = event.clientY - 60
          }
        }
        //if(0< x - item.x <lineminwitdh&&0< y - item.y <lineminwitdh){
        //console.log(item.count,item.date);
        //}
      }
    }
  }
}
//数据统计算法
function addlastmonth() {
  if (gitcalendar.thisdayindex === 0) {
    thisweekcore(52);
    thisweekcore(51);
    thisweekcore(50);
    thisweekcore(49);
    thisweekcore(48);
    gitcalendar.thisweekdatacore += gitcalendar.firstdate[6].count;
    gitcalendar.amonthago = gitcalendar.firstdate[6].date
  } else {
    thisweekcore(52);
    thisweekcore(51);
    thisweekcore(50);
    thisweekcore(49);
    thisweek2core();
    gitcalendar.amonthago = gitcalendar.first2date[gitcalendar.thisdayindex - 1].date
  }
};

function thisweek2core() {
  for (let i = gitcalendar.thisdayindex - 1; i < gitcalendar.first2date.length; i++) {
    gitcalendar.thisweekdatacore += gitcalendar.first2date[i].count
  }
};

function thisweekcore(index) {
  for (let item of gitcalendar.data[index]) {
    gitcalendar.thisweekdatacore += item.count
  }
};

function addlastweek() {
  for (let item of gitcalendar.lastweek) {
    gitcalendar.weekdatacore += item.count
  }
};

function addbeforeweek() {
  for (let i = gitcalendar.thisdayindex; i < gitcalendar.beforeweek.length; i++) {
    gitcalendar.weekdatacore += gitcalendar.beforeweek[i].count
  }
};

function addweek(data) {
  if (gitcalendar.thisdayindex === 6) {
    gitcalendar.aweekago = gitcalendar.lastweek[0].date;
    addlastweek()
  } else {
    lastweek = data.contributions[51];
    gitcalendar.aweekago = lastweek[gitcalendar.thisdayindex + 1].date;
    addlastweek();
    addbeforeweek()
  }
}

fetch(githubapiurl)
  .then(data => data.json())
  .then(data => {
    gitcalendar.data = data.contributions;
    gitcalendar.total = data.total;
    gitcalendar.first2date = gitcalendar.data[48];
    gitcalendar.firstdate = gitcalendar.data[47];
    gitcalendar.firstweek = data.contributions[0];
    gitcalendar.lastweek = data.contributions[52];
    gitcalendar.beforeweek = data.contributions[51];
    gitcalendar.thisdayindex = gitcalendar.lastweek.length - 1;
    gitcalendar.thisday = gitcalendar.lastweek[gitcalendar.thisdayindex].date;
    gitcalendar.oneyearbeforeday = gitcalendar.firstweek[0].date;
    gitcalendar.monthindex = gitcalendar.thisday.substring(5, 7) * 1;
    gitcalendar.montharrbefore = gitcalendar.month.splice(gitcalendar.monthindex, 12 - gitcalendar.monthindex);
    gitcalendar.monthchange = gitcalendar.montharrbefore.concat(gitcalendar.month);
    addweek(data);
    addlastmonth();
    responsiveChart();
  })
  .catch(function(error) {
    console.log(error);
  });

//手机版更换为svg绘制
if (document.getElementById("gitcalendarcanvasbox").offsetWidth < 500) {
  gitcalendar.simplemode = false
}

//当改变窗口大小时重新绘制canvas
window.onresize = function() {
  if (gitcalendar.simplemode) responsiveChart()
}

//解决滚动滑轮时出现的标签显示
window.onscroll = function() {
  if (document.querySelector('.angle-wrapper')) {
    document.querySelector('.angle-wrapper').style.display = 'none'
  }
};</script></div><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/katex@0.10.1/dist/katex.min.css"><script defer src="https://cdn1.tianli0.top/npm/katex@0.10.1/dist/katex.min.js"></script><script type="text/javascript" src="/js/noie.js"></script><script src="https://cdn1.tianli0.top/npm/leancloud-storage@4.13.1/dist/av-min.js"></script><script src="https://cdn1.tianli0.top/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script type="text/javascript" src="/js/rightmenu.js"></script><script type="text/javascript" src="/js/copy.js"></script><script type="text/javascript" src="/js/welcome.js"></script><script async defer src="/js/aplayer.js"></script><script type="text/javascript" src="https://cdn1.tianli0.top/npm/jquery@latest/dist/jquery.min.js"></script><script type="text/javascript" src="/js/resizeTop.js"></script><script type="text/javascript" src="/js/calendar.js"></script><script type="text/javascript" src="/js/languages.js"></script><script type="text/javascript" src="/js/browser.js"></script><script type="text/javascript" src="/js/smooth-scrolling.js"></script><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><script type="text/javascript" src="/js/sitetime.js"></script><script type="text/javascript" src="https://cdn1.tianli0.top/gh/LYXOfficial/LYXOfficial.github.io/js/seo.js"></script><script type="text/javascript" src="https://cdn1.tianli0.top/gh/LYXOfficial/LYXOfficial.github.io/js/heimu.js"></script><script src="/js/bbtalklunbo.js"></script><script src="/js/fps.js"></script><script async src="/js/diytitle.js"></script><script src="/js/settings.js"></script><script src="/js/owo.js"></script><script src="/js/welcomeconsole.js"></script><script src="https://f.zhheo.com/JS-Heo/bb/showbb_in_index.js" data-pjax="" defer=""></script><script data-pace-options='{ "restartOnRequestAfter":false,"eventLag":false}' src="https://cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><script src="https://cdn1.tianli0.top/npm/swiper/swiper-bundle.min.js"></script><script src="https://cdn1.tianli0.top/gh/LYXOfficial/LYXOfficial.github.io/js/baiduhistory.js"></script><script src="https://cdn.jsdelivr.net/gh/zhheo/twikoo@dev/dist/twikoo.all.min.js"></script><script src="/js/random.js"></script><script src="https://cdn1.tianli0.top/gh/LYXOfficial/LYXOfficial.github.io/js/lunar.js"></script><script src="/js/day.js"></script><script src="/js/nav.js"></script><script src="/js/cursor.js"></script><script src="/js/post_charts.js"></script><script type="text/javascript" src="/js/dianzan.js"></script><script type="text/javascript" src="/js/commentsCount.js"></script><script type="text/javascript" src="/js/latest.js"></script><script data-pjax defer src="/js/fixed_card_widget.js"></script><script type="text/javascript" src="https://cdn1.tianli0.top/npm/node-snackbar@latest/src/js/snackbar.min.js"></script><script data-pjax defer src="/js/fixed_comment.js"></script><script async type="text/javascript" src="/js/readPercent.js"></script><script src="/js/sun_moon.js" async></script><script src="/js/essay.js" async data-pjax></script><script data-pjax src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/js/swiper.min.js"></script><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="/js/meting_js.js"></script><script async data-pjax src="https://cdn.dusays.com/bsz.js"></script><div id="fixedcard-dashboard"><button class="fixedcard-activebtn" type="button" title="我的信息" onclick="FixedCardWidget(&quot;class&quot;,&quot;card-info&quot;,&quot;0&quot;)"><i class="fas fa-address-book"></i></button><button class="fixedcard-activebtn" type="button" title="公告" onclick="FixedCardWidget(&quot;class&quot;,&quot;card-announcement&quot;,&quot;0&quot;)"><i class="fas fa-bullhorn"></i></button><button class="fixedcard-activebtn" type="button" title="电子钟" onclick="FixedCardWidget(&quot;class&quot;,&quot;card-clock&quot;,&quot;0&quot;)"><i class="fa-solid fa-clock"></i></button><button class="fixedcard-activebtn" type="button" title="最新文章" onclick="FixedCardWidget(&quot;class&quot;,&quot;card-recent-post&quot;,&quot;0&quot;)"><i class="fas fa-history"></i></button><button class="fixedcard-activebtn" type="button" title="最新评论" onclick="FixedCardWidget(&quot;id&quot;,&quot;card-newest-comments&quot;,&quot;0&quot;)"><i class="fas fa-comment-dots"></i></button><button class="fixedcard-activebtn" type="button" title="文章日历" onclick="FixedCardWidget(&quot;class&quot;,&quot;card-calendar&quot;,&quot;0&quot;)"><i class="fas fa-calendar"></i></button><div class="fixedcard-user-avatar fixedcard-activebtn" onclick="RemoveFixedCardWidget()"><img class="fixedcard-user-avatar-img" src="https://pic.imgdb.cn/item/637b405e16f2c2beb1405fb3.jpg" title="月の子豚小窝"></div></div></div><div class="comment-barrage"></div><link rel="stylesheet" href="/css/commentBarrage.css"><script src="/js/commentBarrage.js"></script><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('fl') && (location.pathname ==='all'|| 'all' ==='all')){
    var parent = document.getElementById('fl');
    var child = '<div class="recent-post-item" style="width:100%;height: 100% !important;border-radius:12px"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="http://localhost:4000/categories/Java-开发/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📚 月のJava 源泉 (12)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="http://localhost:4000/categories/数据库技术/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🎮 月の数据库总结 (4)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="http://localhost:4000/categories/运维技术/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🐱‍👓 月のLinux遨游 (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="http://localhost:4000/categories/工具插件/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">👩‍💻 月の妙用小工具 (5)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="http://localhost:4000/categories/奇思淫巧/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📒 月の奇思淫巧 (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="http://localhost:4000/categories/项目练习/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">💡 月の个人项目 (12)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><a class="magnet_link_more"  href="http://localhost:4000/categories" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';
    console.log('已挂载magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(50% - 5px);background: #f2f2f2 !important;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: #dd8484 !important}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementsByClassName('swiper-div')[0];
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2022/06/20/数据库技术/MySQL 数据库/MySQL/" alt=""><img width="48" height="48" src="https://w.wallhaven.cc/full/k7/wallhaven-k7m65d.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-06-20</span><a class="blog-slider__title" href="2022/06/20/数据库技术/MySQL 数据库/MySQL/" alt="">MySQL 底层初探</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="2022/06/20/数据库技术/MySQL 数据库/MySQL/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2022/11/21/奇思淫巧/Hexo魔改记录/" alt=""><img width="48" height="48" src="https://w.wallhaven.cc/full/x6/wallhaven-x6128o.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-11-21</span><a class="blog-slider__title" href="2022/11/21/奇思淫巧/Hexo魔改记录/" alt="">Hexo魔改日记</a><div class="blog-slider__text">本文是在 Acryple 主题的基础上进行魔改</div><a class="blog-slider__button" href="2022/11/21/奇思淫巧/Hexo魔改记录/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2021/05/26/数据库技术/InfluxDB 数据库/InfluxDB数据库集群方案/" alt=""><img width="48" height="48" src="https://w.wallhaven.cc/full/qz/wallhaven-qz93rr.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-05-26</span><a class="blog-slider__title" href="2021/05/26/数据库技术/InfluxDB 数据库/InfluxDB数据库集群方案/" alt="">Influxdb 数据库集群方案</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="2021/05/26/数据库技术/InfluxDB 数据库/InfluxDB数据库集群方案/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2022/03/05/Java 开发/网络编程/Netty 进阶实战/" alt=""><img width="48" height="48" src="https://w.wallhaven.cc/full/x8/wallhaven-x8xo1d.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-03-05</span><a class="blog-slider__title" href="2022/03/05/Java 开发/网络编程/Netty 进阶实战/" alt="">Netty 进阶实战</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="2022/03/05/Java 开发/网络编程/Netty 进阶实战/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2022/05/30/Java 开发/Java 多线程/多线程和JUC编程/" alt=""><img width="48" height="48" src="https://w.wallhaven.cc/full/zy/wallhaven-zyxvqy.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-05-30</span><a class="blog-slider__title" href="2022/05/30/Java 开发/Java 多线程/多线程和JUC编程/" alt="">多线程和 JUC 编程</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="2022/05/30/Java 开发/Java 多线程/多线程和JUC编程/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2022/05/20/运维技术/Docker 基础/" alt=""><img width="48" height="48" src="https://w.wallhaven.cc/full/e7/wallhaven-e7dy9w.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-05-20</span><a class="blog-slider__title" href="2022/05/20/运维技术/Docker 基础/" alt="">Docker 的基本使用</a><div class="blog-slider__text">主要讲述 Docker、Docker0、Docker compose 的基本使用</div><a class="blog-slider__button" href="2022/05/20/运维技术/Docker 基础/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2022/05/21/运维技术/Linux 基础/" alt=""><img width="48" height="48" src="https://w.wallhaven.cc/full/k7/wallhaven-k7mww1.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-05-21</span><a class="blog-slider__title" href="2022/05/21/运维技术/Linux 基础/" alt="">Linux 的基本命令</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="2022/05/21/运维技术/Linux 基础/" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://cdn1.tianli0.top/npm/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://cdn1.tianli0.top/npm/hexo-butterfly-swiper/lib/swiper_init.js"></script><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = '5cb4f63e85c148a3bd7f49f81456f48c';
  var gaud_map_key = '334aebc0599a80601395fd75921efc43';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '112.982279,28.19409';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><script data-pjax src="https://unpkg.zhimg.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementsByClassName('gc')[0];
      var item_html = '<container><style>#git_container{min-height: 140px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></container>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('已挂载gitcalendar')
      }

    if( document.getElementsByClassName('gc')[0] && (location.pathname ==='/'|| '/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("gcapi.yisous.xyz/api?LYXOfficial",['#ebedf0', '#f1f8ff', '#dbedff', '#c8e1ff', '#79b8ff', '#2188ff', '#0366d6', '#005cc5', '#044289', '#032f62', '#05264c'],'LYXOfficial')
    }
  </script><!-- hexo injector body_end end --></body></html>